riot.tag2('tag-change-package-service','<div class="full-view-ss" id="changePackage"> <section class="content-wrapper Fix-error-section-main clearfix" if="{SelectPackageSection && !showWarning}"> <button type="button" class="payment-close icon-Close_M" onclick="{backpackage}"></button> <div class="Fix-error-heading"> <h2 class="master-head text-center"> {langTranslateApp.pkgChangePackage}</h2> <ul class="progressbar progress-change-package"> <li class="active plus"></li> <li></li> <li></li> </ul> </div> <h5 class="master-head sub-text-center">{langTranslateApp.changemessage1}</h5> <div class="Fix-error-section"> <div class="col-md-12"> <div class="d-flex relative align-items-center justify-content-between"><span class="arrows-Fix-error"></span></div> <div class="change-package-slider-new Fix-error-slider" style=""> <div class="smartcardItem {package.primaryService.productName}-package fix-package" each="{package in packageList}"> <label for="{package.SerialNumber}_radiobtn"> <div class="smartcard-section-top"> <div class="col-lg-6 col-sm-6 col-md-6 col-xs-6 decoder-img-left"><img if="{package.smartcardName !== \'DVSIUC\'}" src="/media/7655/explora-1.png"><span if="{package.smartcardName == \'DVSIUC\'}" class="icon icon-streaming-no-circle"></span></div> <div class="smartcard fix-smt col-lg-6 col-sm-6 col-md-6 col-xs-6"> {langTranslateApp.loginSmartcardNumber} <div class="number">{package.SerialNumber}</div> </div> <div class="clearfix"></div> </div> <div class="smartcard-section-bottom {\'package-details contents \' + ptDashSmallFontClass}"> <div class="col-lg-4 col-sm-4 col-md-4 col-xs-4 package-name three-section"><span>{langTranslateApp.loginPackage}</span><span class="second-span"><i class="icon-pack icon-{package.primaryService.productCode}"></i></div> <div class="col-lg-4 col-sm-4 col-md-4 col-xs-4 three-section"><span>{langTranslateApp.addon}</span><span class="second-span">{package.addonService}</span></div> <div class="col-lg-4 col-sm-4 col-md-4 col-xs-4 three-section"> <span>{langTranslateApp.accStatus}</span> <span class="second-span"> <img src="/media/8268/icon-tick.svg" class="icon-background-img" if="{package.primaryService.status == \'Active\'}"><span id="status" if="{dstvApp.language == \'English\'}">{package.primaryService.status}</span><span id="status" if="{dstvApp.language == \'Portuguese\' && package.primaryService.status == \'Active\'}">Activo</span><span id="status" if="{dstvApp.language == \'Portuguese\' && package.primaryService.status == \'Disconnected\'}">Desconectado</span> </span></div> <div class="clearfix"></div> </div> <div class="Get-now"><span class="selected-sc">{langTranslateApp.fixErrorSelectedSmartCard}</span><span class="unselected-sc">{langTranslateApp.fixErrorSelectedThisPackage}</span> <input class="package-input" id="{package.SerialNumber}_radiobtn" alt="{package.primaryService.status}" name="test" type="radio" style="position: absolute;" onchange="{OnPackageClick}" value="{package.SerialNumber}"><img src="/media/8268/icon-tick.svg" class="icon-background-img"></div> </label> </div> </div> </div> </div> <div class="errorCodeDiscriptions" if="{ContinueChangePackage}"><button id="fixErrorFixBtn" type="button" class="btn btn-fix-error text-uppercase change-btn" onclick="{OnContinueChangePackage}">{langTranslateApp.paymentsContinue}<span class="arrowNow"></span></button></div> </section> <section class="content-wrapper Change-package-section-main" id="changepackageModal" if="{enableChangePackageModel && !showWarning}"> <button type="button" class="payment-close icon-Close_M" onclick="{backpackage}"></button> <div class="modal-contents changePackModel"> <div class="Fix-error-heading"> <h2 class="master-head text-center" if="{isCurrDVSSmartcard}">{langTranslateApp.currentPackage}</h2> <h2 class="master-head text-center" if="{!isCurrDVSSmartcard}">Current Package</h2> <ul class="progressbar progress-change-package change"> <li class="active change"></li> <li class="active plus"></li> <li class="active"></li> </ul> </div> <div class="modal-body"> <div class="master-top-package-info"> <div class="main-top-package-info {dashSelectedPackageName}"> <div class="package-info-left col-lg-5 col-xs-5 col-sm-5 col-md-5 main"> <span class="icon-pack icon-{dashSelectedPackageCode}"></span> <img if="{isCurrDVSSmartcard}" src="/media/11918/streaming-icon.svg" alt="" class="blur live-stream-img main"></div> <div class="package-info-right {dashSelectedPackageName} col-lg-7 col-xs-7 col-sm-7 col-md-7"> <div class="backgroundimg"></div> <div class="smartcard"> {langTranslateApp.dashChangePackageSmartcardNumber} <div class="number">{dashSmartCardNumber}</div> </div> </div> </div> <div class="second-top-package-info PRWE36 col-lg-12 col-xs-12 col-sm-12 col-md-12 Premium W/Afr E36"> <div class="col-lg-4 col-xs-4 col-sm-4 col-md-4 second-top-first"> <div class="smartcard1 addons">{langTranslateApp.Addons}</div> <!--<div each="{currentAddOn in currentAddOns}" class="smartcard1 decoder-name add" if="{app.AddOnService && app.AddOnService.length > 0 && app.AddOnService != \'N/A\'}">{currentAddOn.CurrentPackageName}</div>--> <div each="{currentAddOn in currentAddOns}" class="smartcard1 decoder-name add" if="{app.AddOnService && app.AddOnService.length > 0 && app.AddOnService != \'N/A\'}">{currentAddOn.AddonNameToShow}</div> <div class="smartcard1 decoder-name add" if="{app.AddOnService && app.AddOnService.length > 0 && app.AddOnService == \'N/A\' && !isShowmaxActive}">N/A</div> <div if="{isShowmaxActive}" class="addon-showmax-status"><span class="showmax-text">SHOWMAX</span></div> </div> <div class="col-lg-4 col-xs-4 col-sm-4 col-md-4 second-top-second"> <div class="package-text-price">{langTranslateApp.dashChangePackageMonthlyPrice}</div> <div if="{!app.dualCurrencyApplicable}" class="package-price">{dstvApp.countrycurrency.toUpperCase()} {dashSelectedPackagePrice || 0.00}</div> <div if="{app.dualCurrencyApplicable}" class="package-price">{dstvApp.countrycurrency.toUpperCase()} {app.currentSmartcardPackage.primaryService.localPrice.amount || 0.00}</div> <div class="package-text-amount price-bten">{langTranslateApp.dashChangePackageAmountAvailable}</div> <div class="package-amount">{dstvApp.countrycurrency.toUpperCase()} {availableAccountBalance}</div> </div> <div class="col-lg-4 col-xs-4 col-sm-4 col-md-4 second-top-third"> <div class="smartcardStatus">{langTranslateApp.dashChangePackageStatus}</div> <div class="Status-info {dashSmartCardNumberStatus}"><img class="icon-background-img" src="/media/8268/icon-tick.svg" /><span class="icon-icon-warning"></span><span id="status" if="{dstvApp.language == \'English\'}">{dashSmartCardNumberStatus}</span><span id="status" if="{dstvApp.language == \'Portuguese\' && dashSmartCardNumberStatus == \'Active\'}">Activo</span><span id="status" if="{dstvApp.language == \'Portuguese\' && dashSmartCardNumberStatus == \'Disconnected\'}">Desconectado</span></div> </div> </div> </div> <div class="package-change-bottom-section"> <div class="accordion_container"> <div class="package-list-main-top"> <div class="accordian-pack accordion_head"> <span class="plusminus">+</span> <h2 class="acc-left"> {langTranslateApp.dashChangePackageSelectPackage} {langTranslateApp.dashChangePackageSelectPackageSubtext}</h2> </div> <div class="package-list accordion_body" style="display: none;"> <div class="package-item-descriptions"> <div class="packages-item" each="{package in packages}"> <label class="cp-lable main-packagelist-section col-lg-12 col-xs-12 col-sm-12 col-md-12" for="{package.PackageName}"> <div class="clearfix"></div> <div class="left-packagelist-section col-lg-5 col-xs-5 col-sm-5 col-md-5 main-stream"><input id="{package.PackageName}" type="radio" class="change-package-options" onclick="{OnPackageSelect}" name="selectedPackage" value="{package.PackageName}~{package.IsUpgradable}~{package.PackagePrice}" /> <span class="icon-pack icon-{package.PackageCode}"></span><img if="{isCurrDVSSmartcard}" src="/media/11918/streaming-icon.svg" alt="" class="blur live-stream-img main-stream"></div> <div class="right-packagelist-section {package.PackageName} col-lg-7 col-xs-7 col-sm-7 col-md-7 "> <div class="smat-text">{langTranslateApp.addOnPriceTitle}</div> <div if="{!app.dualCurrencyApplicable}" class="smat-number">{dstvApp.countrycurrency.toUpperCase()} {package.PackagePrice}<span class="pricePerMonth"> p/m</span></div> <div if="{app.dualCurrencyApplicable}" class="smat-number">{dstvApp.countrycurrency.toUpperCase()} {package.DualCurrencyPackagePrice}<span class="pricePerMonth"> p/m</span></div> </div> </label> <div class="clearfix"></div> <div class="change-package-description pay-package-dtls" id="{package.PackageName}" value="{package.PackageName}~{package.IsUpgradable}~{package.PackagePrice}"> <div class="bottom"> <div class="sub-bottom-section"> <span class="info-symbol"></span><span class="info">{langTranslateApp.dashChangePackageInfo}</span></div> <div><span> <a class="btn anim-btn btn-default change-btn" id="packageActionButton" style="" onclick="{GetChangePackage}"><span class="anim-span"></span>{langTranslateApp.nextButtonTitle}</a></span></div> </div> </div> </div> </div> </div> <a class="btn anim-btn btn-default change-btn" id="packageActionButton" style="display: none;"><span class="anim-span"></span>{langTranslateApp.nextButtonTitle}</a> <hr class="horizontal-line-one"> </div> <!--<div class="Add-list-main-top" if="{app.CardStatus == \'Active\'}">--> <div class="Add-list-main-top" if="{dashSmartCardNumberStatus == \'Active\' && !isCurrDVSSmartcard || (dashSmartCardNumberStatus == \'Active\' && isShomaxott && addOns.length>0)}"> <div class="accordian-pack accordion_head"> <span class="plusminus">+</span> <h2 class="acc-left"> {langTranslateApp.dashAddOns} {langTranslateApp.dashAddOnsSubtext}</h2> </div> <div class="package-list accordion_body" style="display: none;"> <div class="package-item-descriptions"> <div class="packages-item" each="{addOn in addOns}"> <label class="cp-lable main-packagelist-section col-lg-12 col-xs-12 col-sm-12 col-md-12 {addOn.AddOnName}" for="{addOn.AddOnName}"> <div class="clearfix"></div> <div class="left-packagelist-section col-lg-5 col-xs-5 col-sm-5 col-md-5 main-add-on"><input id="{addOn.AddOnName}" type="radio" class="change-package-options" onclick="{OnAddOnSelect}" name="selectedAddOn" value="{addOn.AddOnName}~{addOn.AddOnPrice}" /> <span class="icon-pack icon-{addOn.AddOnCode}"></span><img if="{isCurrDVSSmartcard}" src="/media/11918/streaming-icon.svg" alt="" class="blur live-stream-img main-add-on"></div> <div class="right-packagelist-section {addOn.AddOnName} col-lg-7 col-xs-7 col-sm-7 col-md-7 "> <div class="smat-text">{langTranslateApp.addOnPriceTitle}</div> <div if="{!app.dualCurrencyApplicable}" class="smat-number">{dstvApp.countrycurrency.toUpperCase()} {addOn.AddOnPrice}<span class="pricePerMonth"> p/m</span></div> <div if="{app.dualCurrencyApplicable}" class="smat-number">{dstvApp.countrycurrency.toUpperCase()} {addOn.DualCurrencyCurrentAddOnPrice}<span class="pricePerMonth"> p/m</span></div> </div> </label> <div class="clearfix"></div> <div class="change-package-description pay-package-dtls" id="{addOn.AddOnName}" value="{addOn.AddOnName}~{addOn.AddOnPrice}"> <div class="bottom"> <div class="sub-bottom-section"> <span class="info-symbol"></span><span class="info">{langTranslateApp.dashChangePackageInfo}</span></div> <div><span> <a class="btn anim-btn btn-default change-btn" id="packageActionButton" style="" onclick="{GetChangeAddOn}"><span class="anim-span"></span>{langTranslateApp.nextButtonTitle}</a></span></div> </div> </div> </div> </div> </div> <a class="btn anim-btn btn-default change-btn" id="addOnActionButton" style="display: none;"><span class="anim-span"></span>{langTranslateApp.nextButtonTitle}</a> <hr class="horizontal-line-second"> </div> </div> </div> </div> </div> </section> <section class="content-wrapper cost-summary-main" if="{enableCostSummary}"> <div class="" id="costSummary" style=""> <div class=""> <div class="modal-contents"> <div class="Fix-error-heading"> <h2 class="master-head text-center">{langTranslateApp.dashCostSummary}</h2> <ul class="progressbar progress-change-package change"> <li class="active change"></li> <li class="active plus change"></li> <li class="active changes white"></li> </ul> </div> <!-- <button type="button" class="close costSummaryClose" data-dismiss="modal"><i class="icon-Close_M"></i></button> --> <div class="modal-body"> <div class="package-selection"> <div class="back-package"> <div class="backcard lslide" style="width: 100%; display: inline-block;"> <div class="backcard-packageItem {dashSelectedPackageNameCostSummary} {dashSelectedPackageCode}"> <i class="icon-pack icon-{dashSelectedPackageCode}"></i> <div if="{isCurrDVSSmartcard}" class="blur-img"><img src="/media/11918/streaming-icon.svg" alt="" class="blur live-stream-img"><span class="icon icon-streaming-no-circle"></span></div> <div if="{!app.dualCurrencyApplicable}" class="backcardprice"> <span class="price-value">{dstvApp.countrycurrency.toUpperCase()} {dashSelectedPackagePrice}</span> <a href="/get-dstv/package/details/dstv-compact-plus" class="btn-package" target="_blank" tabindex="0" style="display: none;">{langTranslateApp.KnowMore}</a></div> <div if="{app.dualCurrencyApplicable}" class="backcardprice"> <span class="price-value">{dstvApp.countrycurrency.toUpperCase()} {dashSelectedPackageDualCurrencyPrice.amount}</span> <a href="/get-dstv/package/details/dstv-compact-plus" class="btn-package" target="_blank" style="display: none;" tabindex="0" style="display: none;">{langTranslateApp.KnowMore}</a></div> <div class="bottomBar"><span></span></div> <div class="backgroundimg"></div> </div> </div> </div> <img src="/media/7683/icon-back.svg" class="back-icon-img" /> <div class="selected-package"> <div class="backcard lslide"> <div class="backcard-packageItem {app.selectedCurrentPackageDetails.PackageCode}"> <i class="icon-pack icon-{app.selectedCurrentPackageDetails.PackageCode}"></i> <div if="{isCurrDVSSmartcard}" class="blur-img"><img src="/media/11918/streaming-icon.svg" alt="" class="blur live-stream-img"><span class="icon icon-streaming-no-circle"></span></div> <div if="{!app.dualCurrencyApplicable}" class="backcardprice"> <span class="price-value">{dstvApp.countrycurrency.toUpperCase()} {app.selectedCurrentPackageDetails.PackagePrice}</span> <a href="/get-dstv/package/details/dstv-compact-plus" class="btn-package" style="display: none;" target="_blank" tabindex="0">{langTranslateApp.KnowMore}</a> </div> <div if="{app.dualCurrencyApplicable}" class="backcardprice"> <span class="price-value">{dstvApp.countrycurrency.toUpperCase()} {app.selectedCurrentPackageDetails.DualCurrencyPackagePrice}</span> <a href="/get-dstv/package/details/dstv-compact-plus" class="btn-package" target="_blank" tabindex="0" style="display: none;">Know More </a> </div> <div class="bottomBar"><span>{langTranslateApp.dashSelectedPackage}</span><span><img src="/media/11100/tick-mark.svg" class="tick-mark"></img></span></div> <div if="{showmaxATBUpgrade || isShowmaxActive}" class="bottomBarShowmax"><span class="showmaxplus-icon"><img src="/media/10051/showmax-logo.svg"></span></div> <div class="backgroundimg"></div> </div> </div> </div> </div> <div class="cost-summery-title">{langTranslateApp.pkgCostSummary}</div> <!-- Hide the break down in case of local currency!--> <div class="cost-details row Pay-summary" if="{!app.dualCurrencyApplicable}"> <div class=""> <div class="Payment-showmax"> <div class="payment-summary-main"> <div class="Payment-summary-title"> <div class="overflow-quotes"> <div class="clearfix"></div> <div style="margin-bottom: 10px;"> <div class="quotes" style="padding-bottom: 5px;font-size: 16px; font-weight: 300;" if="{quoteData.Quote.Id}"> <span>{langTranslateApp.paymentSummaryQoute}</span> <span class="quote-number">{quoteData.Quote.Id}</span></div> <div class="quotes-details"> <div each="{lineItem, index in quoteData.Quote.LineItems}" class="hover"> <span class="Payment-heading-info main">{getNewPackageName(lineItem.InvoiceText)}  </span> <span class="holder-name title" style="margin-top:0px">{dstvApp.countrycurrency.toUpperCase()+" "+lineItem.Amount}</span> </div> </div> <div class="clearfix"></div> </div> <div class="clearfix"></div> <div style="margin-top:-20px"><br></div> </div> <div class="amount-details"><span class="Payment-heading-info">{langTranslateApp.paymentSummaryQouteTotal} </span> <span class="holder-name">{dstvApp.countrycurrency.toUpperCase()+" "+quoteData.Quote.QuoteAmount.toFixed(2)}</span></div> <div class="amount-details" style="border-top: none;border-bottom: 1px solid;"><span class="Payment-heading-info">{langTranslateApp.paymentSummaryACB} </span> <span class="holder-name">{dstvApp.countrycurrency.toUpperCase()+" "+quoteData.Quote.AccountBalance.toFixed(2)}</span></div> </div> </div> <div class="clearfix"></div> <div class="Payment-summary-bottom"><span class="total">{langTranslateApp.dashChangeEstimatedCost}</span><span class="heading-price"><span>{dstvApp.countrycurrency.toUpperCase()}</span> <span class="" id="txtval">{quoteData.Payment.Amount.toFixed(2) || 0.00}</span></span></div> </div> </div> </div> <div class="summery-details"> <p>{langTranslateApp.dashChangeInstruction}</p> <div class="cost-btn"><button type="button" class="pay-btn-cost" id="btnChangePackagePay" onclick="{ProcessPayment}">{langTranslateApp.dashProceedToPay}<span class="arrowNow"></span></button></div> </div> </div> </div> </div> </div> </section> <section class="content-wrapper cost-summary-main" if="{enableAddOnCostSummary}"> <div class="" id="costSummary" style=""> <div class="add-ons-flow"> <div class="modal-contents"> <div class="Fix-error-heading"> <h2 class="master-head text-center">{langTranslateApp.dashCostSummary}</h2> <ul class="progressbar progress-change-package change"> <li class="active change"></li> <li class="active plus change"></li> <li class="active changes white"></li> </ul> </div> <!--<button type="button" class="close costSummaryClose" data-dismiss="modal"><i class="icon-Close_M"></i></button> --> <div class="modal-body"> <div class="package-selection"> <div class="back-package"> <div class="backcard lslide" style="width: 100%; display: inline-block;"> <div class="backcard-packageItem {dashSelectedPackageNameCostSummary} {dashSelectedPackageCode}"> <i class="icon-pack icon-{dashSelectedPackageCode}"></i> <div if="{isCurrDVSSmartcard}" class="blur-img"><img src="/media/11918/streaming-icon.svg" alt="" class="blur live-stream-img"><span class="icon icon-streaming-no-circle"></span></div> <div if="{!app.dualCurrencyApplicable}" class="backcardprice"> <span class="price-value">{dstvApp.countrycurrency.toUpperCase()} {dashSelectedPackagePrice}</span> <a href="/get-dstv/package/details/dstv-compact-plus" class="btn-package" target="_blank" tabindex="0" style="display: none;">{langTranslateApp.KnowMore}</a></div> <div if="{app.dualCurrencyApplicable}" class="backcardprice"> <span class="price-value">{dstvApp.countrycurrency.toUpperCase()} {dashSelectedPackageDualCurrencyPrice.amount}</span> <a href="/get-dstv/package/details/dstv-compact-plus" class="btn-package" target="_blank" tabindex="0" style="display: none;">{langTranslateApp.KnowMore}</a></div> <div class="bottomBar"><span></span></div> <div class="backgroundimg"></div> </div> </div> </div> <img src="/media/11386/plus-sign-button.svg" class="back-icon-img" /> <div class="selected-package"> <div class="backcard lslide"> <div class="backcard-packageItem {app.selectedCurrentAddOnDetails.AddOnCode}"> <i class="icon-pack icon-{app.selectedCurrentAddOnDetails.AddOnCode}"></i> <div if="{isCurrDVSSmartcard}" class="blur-img"><img src="/media/11918/streaming-icon.svg" alt="" class="blur live-stream-img"><span class="icon icon-streaming-no-circle"></span></div> <div if="{!app.dualCurrencyApplicable}" class="backcardprice"><span class="price-value">{dstvApp.countrycurrency.toUpperCase()} {app.selectedCurrentAddOnDetails.AddOnPrice}</span><a href="/get-dstv/package/details/dstv-compact-plus" class="btn-package" style="display: none;" target="_blank" tabindex="0">{langTranslateApp.KnowMore}</a> </div> <div if="{app.dualCurrencyApplicable}" class="backcardprice"><span class="price-value">{dstvApp.countrycurrency.toUpperCase()} {app.selectedCurrentAddOnDetails.DualCurrencyCurrentAddOnPrice}</span> <a href="/get-dstv/package/details/dstv-compact-plus" class="btn-package" style="display: none;" target="_blank" tabindex="0" style="display: none;">Know More </a> </div> <div class="bottomBar"><span>{langTranslateApp.selectedAddon}</span><span><img src="/media/11100/tick-mark.svg" class="tick-mark"></img></span></div> <div class="backgroundimg"></div> </div> </div> </div> </div> <div class="cost-summery-title">{langTranslateApp.pkgCostSummary}</div> <!-- Hide the break down in case of local currency!--> <div class="cost-details row Pay-summary" if="{!app.dualCurrencyApplicable}"> <div> <div class="Payment-showmax"> <div class="payment-summary-main"> <div class="Payment-summary-title"> <div class="overflow-quotes"> <div class="clearfix"></div> <div style="margin-bottom: 10px;"> <div class="quotes" style="padding-bottom: 5px;font-size: 16px; font-weight: 300;" if="{quoteData.Quote.Id}"> <span>{langTranslateApp.paymentSummaryQoute}</span> <span class="quote-number">{quoteData.Quote.Id}</span></div> <div class="quotes-details"> <div each="{lineItem, index in quoteData.Quote.LineItems}" class="hover"> <span class="Payment-heading-info main">{getNewPackageName(lineItem.InvoiceText)} </span> <span class="holder-name title" style="margin-top:0px">{dstvApp.countrycurrency.toUpperCase()+" "+lineItem.Amount}</span> </div> </div> <div class="clearfix"></div> </div> <div class="clearfix"></div> <div style="margin-top:-20px"><br></div> </div> <div class="amount-details"><span class="Payment-heading-info">{langTranslateApp.paymentSummaryQouteTotal} </span> <span class="holder-name">{dstvApp.countrycurrency.toUpperCase()+" "+quoteData.Quote.QuoteAmount.toFixed(2)}</span></div> <div class="amount-details" style="border-top: none;border-bottom: 1px solid;"><span class="Payment-heading-info">{langTranslateApp.paymentSummaryACB} </span> <span class="holder-name">{dstvApp.countrycurrency.toUpperCase()+" "+quoteData.Quote.AccountBalance.toFixed(2)}</span></div> </div> </div> <div class="clearfix"></div> <div class="Payment-summary-bottom"><span class="total">{langTranslateApp.dashChangeEstimatedCost}</span><span class="heading-price"><span>{dstvApp.countrycurrency.toUpperCase()}</span> <span class="" id="txtval">{quoteData.Payment.Amount.toFixed(2) || 0.00}</span></span></div> </div> </div> </div> <div class="summery-details"> <p>{langTranslateApp.dashChangeInstruction}</p> <div class="cost-btn"><button type="button" class="pay-btn-cost" id="btnChangePackagePay" onclick="{ProcessPayment}">{langTranslateApp.dashProceedToPay}<span class="arrowNow"></span></button></div> </div> </div> </div> </div> </div> </section> <section class="content-wrapper change-package-success changePackageSuccessWrapper" id="successMessageModal" if="{IsChangePackageSuccess}"> <div class="modal-contents"> <div class="modal-body"> <div class="change_package_success"> <div class="change_package_success_header"> <div class="icon icon-success-checked"></div> </div> <div class="change_package_success_main"> </hr> <h6>{langTranslateApp.pkgSucess} <span>{app.newSelectedPackageName}</span></h6> <div class="backcard-packageItem {selectedPackageCode} "> <div class="dvs-icon-group dvs-smartcard" if="{isCurrDVSSmartcard}"><i class="icon-pack icon-{selectedPackageCode}"></i><span class="icon icon-streaming-no-circle"></span></div> <div class="dvs-icon-group dth-card" if="{!isCurrDVSSmartcard}"><i class="icon-pack icon-{selectedPackageCode}"></i></div> <div class="backcardprice"><span class="price-value">{dstvApp.countrycurrency.toUpperCase()} {newPackagePrice}</span></div> <div class="bottomBar">{langTranslateApp.pkgNewPackageTitle}</div> <div class="backgroundimg"></div> </div> </div> <div class="change_package_success_footer"> <p>{langTranslateApp.pkgNote} {pkgEffectiveDate}</p> <a if="{!showmaxChangePackageSuccess}" class="btn anim-btn btn-default view-chg-btn close" data-dismiss="modal" onclick="{goToDashboardUrl}"> {langTranslateApp.pkgViewChangesTitle} <span></span></a> <div class="success-showmax-msg-btn" if="{showmaxChangePackageSuccess}"> <a class="btn anim-btn btn-default btn-show-active" href="javascript:void(0)" onclick="{onAddShowmax}">{langTranslateApp.addShowmax}</a></div> </div> </div> </div> </div> </section> <section class="content-wrapper change-package-success" id="successMessageModal" if="{IsAddOnSuccess}"> <div class="modal-contents"> <div class="modal-header"> <!--<button type="button" class="close" data-dismiss="modal"><i class="icon-Close_M"></i></button>--> </div> <div class="modal-body"> <div class="alert-msg-success"> <div class=""> <span class="icon-icon-tick"></span><span class="pay-success-msg">{langTranslateApp.pkgSuccessMessageTitle}</span> <div class="backcard-packageItem {selectedAddOnCode}"> <i class="icon-pack icon-{selectedAddOnCode}"></i> <div if="{isCurrDVSSmartcard}" class="blur-img"><img src="/media/11918/streaming-icon.svg" alt="" class="blur live-stream-img"><span class="icon icon-streaming-no-circle"></span></div> <div class="backcardprice"><span if="{!app.dualCurrencyApplicable}" class="price-value">{dstvApp.countrycurrency.toUpperCase()} {newAddOnPrice}</span><span if="{app.dualCurrencyApplicable}" class="price-value">{dstvApp.countrycurrency.toUpperCase()} {app.selectedCurrentAddOnDetails.DualCurrencyCurrentAddOnPrice}</span></div> <div class="bottomBar">{langTranslateApp.pkgNewPackageTitle}</div> <div class="backgroundimg"></div> </div> <div class="date-area"> <div class="date-sec"><span class="date-text">{langTranslateApp.pkgEffectiveDateTitle}</span><span class="date-no">{pkgEffectiveDate}</span></div> </div> <a if="{!showmaxChangePackageSuccess}" class="btn anim-btn btn-default view-chg-btn close" data-dismiss="modal" onclick="{goToDashboardUrl}"> {langTranslateApp.pkgViewChangesTitle}</a> <div class="success-showmax-msg-btn" if="{showmaxChangePackageSuccess}"> <a class="btn anim-btn btn-default btn-show-active" href="javascript:void(0)" onclick="{onAddShowmax}">{langTranslateApp.addShowmax}</a></div> </div> </div> </div> </div> </section> <section class="content-wrapper change-package-error-msg" id="errorMessageModal" if="{IsErrorMessage}"> <button type="button" class="payment-close icon-Close_M" onclick="{backpackage}"></button> <div class="modal-contents"> <div class="modal-header"> <!--<button type="button" class="close" data-dismiss="modal"><i class="icon-Close_M"></i></button>--> </div> <div class="modal-body"> <div class="alert-msg"> <div class=""><span if="{!app.deadlineTime}" class="icon-icon-warning"></span><span if="{!app.deadlineTime}" class="error-wrong-msg">{langTranslateApp.pkgErrorMessageTitle}</span><span if="{!app.deadlineTime}" class="error-note">{langTranslateApp.pkgErrorMessageDescription}</span><span if="{app.deadlineTime}" class="response-icon" style="font-size:5em"></span><br><span if="{app.deadlineTime}" class="error-wrong-msg">{langTranslateApp.pkgErrorMessageDescription}</span><a href="javascript:void(0)" onclick="{onErrorClose}" class="btn anim-btn btn-default ok-btn close" data-dismiss="modal">{langTranslateApp.menuClose}</a></div> </div> </div> </div> </section> <section class="content-wrapper change-package-error-msg" id="errorMessageModal" if="{IsAddOnErrorMessage}"> <button type="button" class="payment-close" onclick="{backpackage}">X</button> <div class="modal-contents"> <div class="modal-header"> <!--<button type="button" class="close" data-dismiss="modal"><i class="icon-Close_M"></i></button>--> </div> <div class="modal-body"> <div class="alert-msg"> <div class=""><span if="{!app.deadlineTime}" class="icon-icon-warning"></span><span if="{!app.deadlineTime}" class="error-wrong-msg">{langTranslateApp.pkgErrorMessageTitle}</span><span if="{!app.deadlineTime}" class="error-note">{langTranslateApp.pkgErrorMessageDescription}</span><span if="{app.deadlineTime}" class="response-icon" style="font-size:5em"></span><br><span if="{app.deadlineTime}" class="error-wrong-msg">{langTranslateApp.pkgErrorMessageDescription}</span><a href="javascript:void(0)" onclick="{onErrorClose}" class="btn anim-btn btn-default ok-btn close" data-dismiss="modal">{langTranslateApp.menuClose}</a></div> </div> </div> </div> </section> <section class="content-wrapper change-package-notification-msg" id="notificationMeg" if="{IsSrqPendingMsg}"> <button type="button" class="payment-close icon-Close_M" onclick="{backpackage}"></button> <div class="modal-contents"> <div class="modal-header"></div> <div class="modal-body"> <div class="notify-area"> <div class="notify-sec"><span class="icon-icon-warning icon-notify"></span><span class="msg-text-notify">{langTranslateApp.pkgNotificationTitle}</span><span class="notify-msg">{langTranslateApp.pkgSRQNotificationMessage}</span></div> <div class="notify-close-btn"><a href="javascript:void(0)" onclick="{onErrorClose}" class="btn anim-btn btn-default notify-close" data-dismiss="modal">{langTranslateApp.menuClose}</a></div> </div> </div> </div> </section> <section class="content-wrapper change-package-repeating-request-msg" id="repeatRequestMsg" if="{IsRepeatRequestMsg}"> <div class="modal-contents"> <div class="modal-headers"><button type="button" class="close" data-dismiss="modal"><i class=" icon-Close_M"></i></button></div> <div class="modal-body"> <div class="notify-area"> <div class="notify-sec"><span class="icon-icon-warning icon-notify"></span><span class="msg-text-notify">{langTranslateApp.pkgNotificationTitle}</span><span class="notify-msg">{langTranslateApp.pkgRepeatedRequestMessage}</span></div> <div class="notify-close-btn"><a class="btn anim-btn btn-default notify-close" data-dismiss="modal">{langTranslateApp.menuClose}</a></div> </div> </div> </div> </section> <div id="upgradeDowngradeWarning" if="{IsShowmaxWarningMsg}"> <div class="modal-contents"> <div class="modal-header"><button type="button" class="close" data-dismiss="modal"><i class=" icon-Close_M"></i></button></div> <div class="modal-body"> <div class="container-fluid main-section downgradeSection"> <div class="popup showmaxPopup"> <img src="/media/10049/layer1-2x.png" class="showmax-icon"> <h2 class="activesuccessheading">{langTranslateApp.showmaxBilling}</h2> <img src="/media/10056/billing-icon.svg" class="icon-downgrade"> <div class="downgradeInfo"><span>{langTranslateApp.showmaxDowngradingMessage}<br> {langTranslateApp.showmaxCostMessage}</span></div> <div class="downgradeQues"><span>{langTranslateApp.showmaxDowngradeMessage}</span></div> <div class="showmaxInfoArea"> <a href="javascript:void(0)" onclick={onCancelShowmax}><span class="backicon"><span class="backword">{langTranslateApp.showmaxCancelButton}</span><img src="/media/10057/bill-showmax-icon.svg"></span></a> <a href="javascript:void(0)" onclick={onChangePackage}><span class="cancle-icon"><span class="confirmword">{langTranslateApp.showmaxContinueDowngrade}</span><span class="downarrow"></span></span></a></div> </div> </div> </div> </div> </div> <div id="cpoverlay"> <div class="cv-spinner"> <span class="cpspinner"></span></div> </div> <section class="content-wrapper Fix-error-section-main clearfix" style="padding-top:60px" if="{showWarning}"> <div class="Fix-error-content-section"> <button type="button" class="payment-close icon-Close_M" onclick="{backpackage}"></button> <div class="Fix-error-package"> <div class="Fix-error-package-Error-Code"> <div class="smartcardStatusPending"> <div class="textDisconnected"> <span class="icon-icon-Disconnected" style="font-size: 70px;display: flex;justify-content: center;margin-bottom: 30px;"></span><span class="main-disc" if="{state == \'pending-package\'}">{langTranslateApp.dashFixErrorTitlePending}</span> <p class="errorCodeDesc" if="{state == \'pending-package\'}">{langTranslateApp.fixerrorPendingNote}</p> <span class="main-disc" if="{state == \'noservice-package\'}">{langTranslateApp.dashNoServiceMessage1}</span> <p class="errorCodeDesc" if="{state == \'noservice-package\'}">{langTranslateApp.transHistoryPlease +langTranslateApp.dashNoServiceMessage2 + langTranslateApp.dashNoServiceMessage3}</p> </div> </div> </div> </div> </div> </section></div>','','',function(opts){var self=this;let upgradePackageUrl=dstvApp.EnableSecurityAuth?`${dstvApp.SecurityAuthBaseUrl}/apichangepackage/api/v1/ChangePackage/Upgrade`:`${dstvApp.DSOUpgradePackageURL}`;let downgradePackageUrl=dstvApp.EnableSecurityAuth?`${dstvApp.SecurityAuthBaseUrl}/apichangepackage/api/v1/ChangePackage/Downgrade`:`${dstvApp.DSODowngradePackageURL}`;let linkAddOnUrl=dstvApp.EnableSecurityAuth?`${dstvApp.SecurityAuthBaseUrl}/apichangepackage/api/v1/ChangePackage/LinkAddOn`:`${dstvApp.DSOLinkAddOnsURL}`;let retryQuotesUrl=`${dstvApp.DSORetryQuotesURL}`;self.newWin='';self.showmaxChangePackageSuccess=false;self.enableNextButton=true;var selectedPackageValue='';var selectedPackage='';var isUpgradeCheck='';self.isShowmaxActive=false;self.IsChangePackageSuccess=false;self.IsErrorMessage=false;self.IsShowmaxWarningMsg=false;self.IsSrqPendingMsg=false;self.IsRepeatRequestMsg=false;self.enableAddOnCostSummary=false;self.IsAddOnSuccess=false;self.IsAddOnErrorMessage=false;self.packageList=[];self.SelectPackageSection=true;self.ContinueChangePackage=false;self.IsSingleSmartCard=false;self.isShowMaxApplicable=dstvApp.showmaxATBcountryList.includes(dstvApp.countryabbreviation);self.preventDuplicateFlag=false;self.arrayDualCurrencyContries=[];self.arrayDualCurrencies=[];self.isShomaxott=dstvApp.dvsShowmaxCountries.includes(dstvApp.countryabbreviation)
self.paymentSummaryCurrency=dstvApp.countrycurrency.toUpperCase()
for(var i=0;i<dstvApp.DualCurrenciesList.length;i++){var split=dstvApp.DualCurrenciesList[i].split("-");self.arrayDualCurrencyContries.push(split[0]);self.arrayDualCurrencies.push(split[1]);}
if(dstvApp.DualCurrency&&dstvApp.DualCurrencyCountryList.includes(dstvApp.countryabbreviation)){if(app.dualCurrencyApplicable!==undefined&&app.dualCurrencyApplicable&&!self.notDualCurrency){dstvApp.countrycurrency=self.arrayDualCurrencies[0];self.paymentSummaryCurrency='USD';}}
if(app.noServicesLoaded){self.showWarning=true;self.state='noservice-package'}
if(app.smartcards&&app.smartcards.length==1)
self.isPending=app.currentSmartcardPackage.primaryService&&app.currentSmartcardPackage.primaryService.status.toLowerCase()=='pending';if(self.isPending){self.showWarning=true;self.state='pending-package'}
self.backfix=function(){window.HandleActiveTab('showAccount')}
self.on('before-mount',function(){});self.on('mount',function(){if(app.isVIVR&&!app.showmaxUpgradeReq){$($('.footer-menu-navigation-icons')[0]).find('a:not(.active-tab)').hide();$($('.footer-menu-navigation-icons')[1]).find('a:not(.active-tab)').hide();$('.main-menu').find('ul>li>a').parent().show();$('.main-menu').find('ul>li>a:not(.active-tab)').parent().hide();self.enableChangePackageModel=false;self.SelectPackageSection=false;self.ViewSubscription();}
else{if(app.showmaxUpgradeReq&&self.opts.showmaxATBUpgrade===undefined){return;}
if(self.opts.showmaxATBUpgrade||opts.showmaxATBUpgrade||opts.changePackage||opts.linkMovieAddon){self.InitializeChangePackage();}
if(app.smartcards&&app.smartcards.length==1){self.InitializeChangePackage();}
$('#premiumStatusSection').hide();self.CreateToken();self.InitializePackageSliders();jcf.replaceAll();jcf.refreshAll();self.update();}});self.ViewSubscription=function(){console.log('Login : ViewSubscription Using URL started...')
let url=dstvApp.DSOAPIUrl+`/apiviewsubscription/api/v1/Subscription?country=${dstvApp.country}&customerNumber=${app.customernumber}&BusinessUnit=${dstvApp.businessunit}&Channel=${dstvApp.channel}`
if(!self.token){site.factory.GetJWT().then(function(token){self.token=token;site.factory.Get(url,self.token,self.ViewSubscriptionSuccess,self.ViewSubscriptionError);})}
else site.factory.Get(url,self.token,self.ViewSubscriptionSuccess,self.ViewSubscriptionError);}
self.ViewSubscriptionSuccess=function(data){console.log('Login : ViewSubscription completed before login');console.log('Account : ViewSubscription completed')
app.viewSubscriptionResponse=data;app.forceReload=false;self.packages=data.map((package)=>{if(package.smartcardNumber==app.smartcard)
app.viewingDaysLeft=package.viewingDaysLeft
if(package.services!==null){if(package.services.length>1)
package.services=package.services.sort(function(x,y){return x.psnr-y.psnr})
primaryService=package.services.filter((service)=>{serviceName=service.serviceName.split('-');if(service.serviceName.includes('-')){serviceName=service.serviceName.split('-');}
else if(service.serviceName.toUpperCase().includes('SHOWMAX')){serviceName[0]=service.serviceName.toUpperCase().trim().substring(0,7).trim();serviceName[1]=service.serviceName.toUpperCase().trim().substring(15,7).trim();}
service.productCode=serviceName[0].trim();let pckNameArray=packageName=serviceName[1].toLowerCase().replace('dstv','').trim().split(' ')
service.productName=pckNameArray[0];service.productName+=packageName[1]=='plus'?'plus':'';service.productName=service.productName.replace("'","");service.hideAddonLinkClass=service.status=="Active"?'':' visibility-hidden';currentPackageFullName=service.serviceName;return service.type=='Principal'});if(primaryService.length>1)
primaryService=primaryService.filter((service)=>{return service.status=='Active'})
primaryService=primaryService[0];if(primaryService!=undefined||primaryService!=null){app.CardStatus=primaryService.status;app.MonthlyPrice=primaryService.price;app.ProductCode=primaryService.productCode;app.currentPackageFullName=primaryService.serviceName;if(dstvApp.DualCurrencyCountryList.includes(dstvApp.countryabbreviation))
app.MonthlyPriceDualCurrency=primaryService.localPrice?primaryService.localPrice.amount:null;}
addonServiceList=package.services.filter((service)=>{return(service.type=='Addon'||service.description.includes('Add-on')||service.description.includes('add-on'))&&service.status=='Active'});addonService=package.services.filter((service)=>{return(service.type=='Addon'||service.description.includes('Add-on')||service.description.includes('add-on'))&&service.status=='Active'});addonService=addonService[0]?(addonService[0].serviceName||addonService[0].description):'N/A';app.AddOnService=addonService;app.SmartCardNumber=package.smartcardNumber;app.addonServiceListForSubscription=addonServiceList;window.SessionSave("app",app);}
return{SerialNumber:package.smartcardNumber,smartcardName:package.smartcardName,primaryService:primaryService,addonService:addonService,Status:package.Status,psnr:package.psnr,serviceId:package.serviceId,isPrimarySmartcard:package.isPrimarySc,isXtraView:package.isXtraView,isDvsSc:self.isDvsSc};})
app.smartcards=self.packages;self.selectedPackage=app.smartcards.find(s=>s.SerialNumber==app.smartcard);app.currentSmartcardPackage=app.smartcards.filter(x=>x.SerialNumber==app.smartcard)[0];if(self.selectedPackage.primaryService){self.resetBackgroundColor();jcf.replaceAll();self.InitializeChangePackage();}else{self.showWarning=true;self.state='noservice-package';self.update();}
window.getAvailableShowmaxContent();window.LoadShowMaxDetails();window.getOrCreateSubscription();}
self.ViewSubscriptionError=function(err){console.log('Login : ViewSubscription completed with error');console.log(err);}
self.backpackage=function(){if(app.isVIVR){window.close();return;}
window.HandleActiveTab('showAccount')}
self.CreateToken=function(){site.factory.GetJWT().then(function(token){self.token=token;});};self.OnPackageClick=function(e){$(this).first('.bottomBar.pricebar .Get-now').addClass('hideRadio');self.errorCodeDiscriptions=false;self.smartcardStatusDiscriptions=false;self.errorCodeSectionInitialize=true;self.selectedPackage=e.item.package;if(self.selectedPackage.primaryService&&(self.selectedPackage.primaryService.status.toLowerCase()=='disconnected'||self.selectedPackage.primaryService.status.toLowerCase()=='suspended')){self.errorCodeDiscriptions=false;self.errorCodeSectionInitialize=false;self.smartcardStatusDiscriptions=true;}
if(self.selectedPackage.primaryService.status.toLowerCase()=="pending"){self.smartcardStatusPending=true;self.errorCodeSectionInitialize=false;}
self.ContinueChangePackage=true;self.resetBackgroundColor();jcf.replaceAll();self.update();}
self.resetBackgroundColor=function(){var elements=document.getElementsByClassName('options');for(var i=0;i<elements.length;i++){elements[i].style.backgroundColor="";}}
self.OnContinueChangePackage=function(data){self.InitializeChangePackage();}
self.InitializeChangePackage=function(data){self.enableChangePackageModel=true;self.SelectPackageSection=false;if(app.accountsInfo&&app.accountsInfo[0]&&app.accountsInfo[0].AccountBalance){self.availableAccountBalance=app.accountsInfo.filter(d=>d.AccountType=='DStvRes')[0].AccountBalance.Value;if(app.dualCurrencyApplicable&&dstvApp.DualCurrencyCountryList.includes(dstvApp.countryabbreviation))
self.availableAccountBalance=app.accountsInfo.filter(d=>d.AccountType=='DStvRes')[0].AccountBalance.LocalPrice.Amount.toString();}
else{self.availableAccountBalance='NA';}
self.update();if(self.opts.showmaxATBUpgrade||opts.showmaxATBUpgrade){self.showmaxATBUpgrade=true;$('#showmaxModel').modal('hide');}
if(!opts.showmodal&&opts.showAlert){self.enableChangePackageModel=false;$('#errorMessageModal').modal('show');self.update();}
$("#cpoverlay").fadeIn(300);if(opts.showmaxATBUpgrade||opts.changePackage||opts.linkMovieAddon||opts.premiumStatusUpgrade){filteredSmartcard=app.smartcards.filter(sc=>sc.SerialNumber==app.smartcard);primaryService=filteredSmartcard?filteredSmartcard[0].primaryService:null;self.dashSelectedPackageCode=primaryService?primaryService.productCode:null;self.dashSelectedPackageName=primaryService?primaryService.serviceName:null;self.dashSelectedPackageNameCostSummary=primaryService?primaryService.serviceName.split("-")[1]:null;self.dashSmartCardNumber=app.smartcard;self.dashSmartCardNumberStatus=primaryService?primaryService.status:null;}
else if(app.smartcards&&app.smartcards.length==1){self.dashSelectedPackageCode=app.currentPackageFullName?app.currentPackageFullName.split('-')[0].trim():'';self.dashSelectedPackageName=app.currentPackageFullName;self.dashSelectedPackageNameCostSummary=app.currentPackageFullName?app.currentPackageFullName.split('-')[1].trim():'';self.dashSmartCardNumber=app.SmartCardNumber;self.dashSmartCardNumberStatus=app.smartcards[0].primaryService?app.smartcards[0].primaryService.status:null;self.IsSingleSmartCard=true;self.enableChangePackageModel=true;self.update();}
else{self.dashSelectedPackageCode=self.selectedPackage.primaryService.productCode;self.dashSelectedPackageName=self.selectedPackage.primaryService.serviceName;self.dashSelectedPackageNameCostSummary=self.selectedPackage.primaryService.serviceName.split("-")[1];self.dashSmartCardNumber=self.selectedPackage.SerialNumber;self.dashSmartCardNumberStatus=self.selectedPackage.primaryService.status;}
try{self.dashSelectedPackageDetails=app.smartcards.filter(sc=>sc.SerialNumber==self.dashSmartCardNumber).filter(ps=>ps.primaryService.productCode==self.dashSelectedPackageCode);self.dashSelectedPackagePrice=self.dashSelectedPackageDetails[0].primaryService.price;self.dashSelectedPackageDualCurrencyPrice=self.dashSelectedPackageDetails[0].primaryService.localPrice;app.dashCurrentPackageDetails=self.dashSelectedPackageDetails;}
catch(e){console.log(e);$("#cpoverlay").fadeOut(300);}
self.isPending=self.dashSmartCardNumberStatus&&self.dashSmartCardNumberStatus.toLowerCase()=='pending';if(self.isPending){self.showWarning=true;self.state='pending-package'}
self.filteredAddOnServiceList=app.viewSubscriptionResponse.filter(sc=>sc.smartcardNumber==self.dashSmartCardNumber)[0].services.filter((service)=>{return!service.serviceName.toUpperCase().includes('SHOWMAX')&&(service.type=='Addon'||service.description.includes('Add-on')||service.description.includes('add-on'));});self.isCurrDVSSmartcard=self.dashSelectedPackageDetails[0].smartcardName=='DVSIUC'
if(self.filteredAddOnServiceList&&self.filteredAddOnServiceList.length>0){self.CurrentAddOnsList=self.filteredAddOnServiceList.filter(d=>d.status=='Active')
self.currentAddOns=self.CurrentAddOnsList.map((currentAddOn)=>{return{CurrentPackageCode:currentAddOn.serviceName.split(' ')[0],CurrentPackageName:currentAddOn.serviceName,CurrentAddOnPrice:currentAddOn.price,AddOnDualCurrency:currentAddOn.localPrice?currentAddOn.localPrice.currency:null,DualCurrencyCurrentAddOnPrice:currentAddOn.localPrice?currentAddOn.localPrice.amount:null,AddonNameToShow:currentAddOn.serviceName.split(' ')[0].toUpperCase().includes('MOVIE')?'DStv Movie Add-on':currentAddOn.serviceName}})
if(self.currentAddOns&&self.currentAddOns.length>0)
app.AddOnService=self.currentAddOns;}
if(app.loggedin&&!app.noServicesLoaded){let url=`${dstvApp.SecurityAuthBaseUrl}${dstvApp.DSOChangePackageURL}?searchCust=${app.customernumber}`;;var reqBody={"businessUnit":dstvApp.businessunit,"channel":dstvApp.channel,"country":dstvApp.country,"packageName":self.dashSelectedPackageName};if((opts.smartcard&&opts.packageName)||opts.showmaxATBUpgrade||opts.changePackage){self.dashSelectedPackageCode=opts.packageName.split('-')[0].trim();self.dashSelectedPackageName=opts.packageName.split('-')[1].trim();self.dashSmartCardNumber=opts.smartcard;reqBody.packageName=opts.packageName;}
self.update();if(!self.preventDuplicateFlag){if(dstvApp.EnableSecurityAuth){url=`${dstvApp.SecurityAuthBaseUrl}${dstvApp.DSOChangePackageURL}?searchCust=${app.customernumber}`;site.factory.Post(url,reqBody,null,self.onChangePackageSuccess,self.onChangePackageError,false,false,false,true);}
else{site.factory.GetJWT().then(function(token){self.token=token;site.trigger('getpostdata',url,'POST','application/json',"Bearer "+self.token,'',reqBody,'',self.onChangePackageSuccess,self.onChangePackageError);})}
self.preventDuplicateFlag=true;}}}
self.OnPackageSelect=function(e){self.selectedCurrentPackage=e.item.package;app.selectedCurrentPackageDetails=self.selectedCurrentPackage;self.selectedCurrentPackageValue=e.currentTarget.value;window.dataLayer=window.dataLayer||[];window.dataLayer.push({event:'eec.productClickGetnow',ecommerce:{click:{actionField:{list:'Self Service'},products:[{id:app.selectedCurrentPackageDetails.PackageCode,name:app.selectedCurrentPackageDetails.PackageDesc.toLowerCase().replaceAll(new RegExp('dStv|bouquet|add-on|e36|is20|standalone|e/afr|w/afr| ','gi'),'').trim(),price:self.selectedCurrentPackage.PackagePrice.toString(),brand:'DStv',category:'DP Change Package',variant:'',position:''}]}}});self.update();}
self.OnAddOnSelect=function(e){self.selectedCurrentAddOn=e.item.addOn;app.selectedCurrentAddOnDetails=self.selectedCurrentAddOn;self.selectedCurrentAddOnValue=e.currentTarget.value;$('.progressbar li:nth-child(2)').addClass("change");$('.progressbar li:nth-child(3)').addClass("changes");window.dataLayer=window.dataLayer||[];window.dataLayer.push({event:'eec.productClickGetnow',ecommerce:{click:{actionField:{list:'Self Service'},products:[{id:self.selectedCurrentAddOn.AddOnCode,name:self.selectedCurrentAddOn.AddOnDesc.toLowerCase().replaceAll(new RegExp('dStv|bouquet|add-on|e36|is20|standalone|e/afr|w/afr| ','gi'),'').trim(),price:self.selectedCurrentAddOn.AddOnPrice.toString(),brand:'DStv',category:'DP Add-on',variant:'',position:''}]}}});self.update();}
self.GetChangePackage=function(e){selectedPackageValue=self.selectedCurrentPackageValue;selectedPackageAddon=self.selectedCurrentPackageValue.split('-')[0].trim();selectedPackage=selectedPackageValue.split('~')[0].trim();currentPackageValue=app.currentPackageFullName;currentPackage=currentPackageValue.split('-')[0].trim();self.filteredAddOnServiceList=app.viewSubscriptionResponse.filter(sc=>sc.smartcardNumber==self.dashSmartCardNumber)[0].services.filter((service)=>{return service.serviceName.toUpperCase().includes('MOVIE BUNDLE ADD-ON')&&(service.type=='Addon'||service.description.includes('Movie Bundle Add-on'));});if(self.filteredAddOnServiceList&&self.filteredAddOnServiceList.length>0)
{self.CurrentAddOnsList=self.filteredAddOnServiceList.filter(d=>d.status=='Disconnect Pending Reconnect')}
if(self.CurrentAddOnsList&&self.CurrentAddOnsList.length>0)
{self.currentPackageUpgradeList=["COMPS20","ACSSS20","ACSSE36","COFAMS20","COFAME36","COMPLS20","COMPLE36","COMPE36","NNJ1E36","NNJ2E36","PTFAME36","LITBOTIS20","GWALLE36","LITGHE36","LITKEE36","MINIBS20","LITNBS20","LUME36","LITZAMIS20","LITZAME36"]
self.selectedPackageUpgradeRestrictList=["PRMS20","PREE36","COMPLS20","COMPLE36","PREFRNSE36","PREASIE36","PRWE36","ASIAE36","PRWFRNSE36","PRWASIE36","ASIA1S20","PORTS20"]
if(self.currentPackageUpgradeList.includes(currentPackage)&&self.selectedPackageUpgradeRestrictList.includes(selectedPackageAddon))
{site.factory.ShowModelPopup('success','',langTranslateApp.incorrectMovieAddonStatus,'',false,true,true,true);return;}
self.currentPackageDowngradeList1=["COMPLS20","COMPLE36"]
self.selectedPackageDowngradeRestrictList1=["NLTESE36","COMPE36","COMPS20","NNJ1E36","NNJ2E36","ASIAE36","LITGHE36","COFAME36","COFAMS20","ACSSE36","ACSSS20","ASIA1S20","LITBOTIS20","GWALLE36","LITKEE36","BASEE36","MINIBS20","LITNBS20","POAE36","LITZAMIS20","PORTS20","LITES20"]
if(self.currentPackageDowngradeList1.includes(currentPackage)&&self.selectedPackageDowngradeRestrictList1.includes(selectedPackageAddon))
{site.factory.ShowModelPopup('success','',langTranslateApp.incorrectMovieAddonStatus,'',false,true,true,true);return;}
self.currentPackageDowngradeList2=["COMPS20","COMPE36","MINIBS20"]
self.selectedPackageDowngradeRestrictList2=["NLTESE36","ASIAE36","LITGHE36","ASIA1S20","LITBOTIS20","GWALLE36","LITKEE36","LITNBS20","POAE36","LITZAMIS20","PORTS20","LITES20"]
if(self.currentPackageDowngradeList2.includes(currentPackage)&&self.selectedPackageDowngradeRestrictList2.includes(selectedPackageAddon))
{site.factory.ShowModelPopup('success','',langTranslateApp.incorrectMovieAddonStatus,'',false,true,true,true);return;}
self.currentPackageDowngradeList3=["COFAME36","COFAMS20","NNJ2E36"]
self.selectedPackageDowngradeRestrictList3=["NLTESE36","ASIAE36","LITGHE36","ASIA1S20","LITBOTIS20","GWALLE36","LITKEE36","BASEE36","LITNBS20","POAE36","LITZAMIS20","PORTS20","LITES20"]
if(self.currentPackageDowngradeList3.includes(currentPackage)&&self.selectedPackageDowngradeRestrictList3.includes(selectedPackageAddon))
{site.factory.ShowModelPopup('success','',langTranslateApp.incorrectMovieAddonStatus,'',false,true,true,true);return;}
self.currentPackageDowngradeList4=["ACSSE36","ACSSS20","NNJ1E36"]
self.selectedPackageDowngradeRestrictList4=["NLTESE36","ASIAE36","LITGHE36","ASIA1S20","LITBOTIS20","GWALLE36","LITKEE36","BASEE36","LITNBS20","POAE36","LITZAMIS20","PORTS20","LITES20"]
if(self.currentPackageDowngradeList4.includes(currentPackage)&&self.selectedPackageDowngradeRestrictList4.includes(selectedPackageAddon))
{site.factory.ShowModelPopup('success','',langTranslateApp.incorrectMovieAddonStatus,'',false,true,true,true);return;}}
isUpgradeCheck=selectedPackageValue.split('~')[1].trim();self.newPackagePrice=selectedPackageValue.split('~')[2].trim();if(app.dualCurrencyApplicable){self.newPackagePrice=app.selectedCurrentPackageDetails.DualCurrencyPackagePrice;}
self.currency=dstvApp.countrycurrency.toUpperCase();self.selectedPackageCode=selectedPackage.split('-')[0].trim();app.newSelectedPackageName=selectedPackage.split('-')[1].trim();app.currentSelectedPackage=selectedPackage;if(e.item.package.PackageCode=="LITNBS20"){app.newSelectedPackageName=`Lite Namibia Bouquet IS20`}
var countryArray=dstvApp.newPackageNamesApplicable.find(p=>p[dstvApp.countryabbreviation])
if(countryArray){if(Object.keys(countryArray[dstvApp.countryabbreviation]).includes(self.selectedPackageCode))
app.newSelectedPackageName=countryArray[dstvApp.countryabbreviation][self.selectedPackageCode]}
window.SessionSave('app',app);$('.progressbar li:nth-child(2)').addClass("change");$('.progressbar li:nth-child(3)').addClass("changes");self.update();let isPremium=self.selectedPackageCode.includes('PR')&&!self.selectedPackageCode.includes('PREPRTS')&&!self.selectedPackageCode.includes('PRWPRTSE36')
self.showmaxProductDetails=app.viewSubscriptionResponse.filter(sc=>sc.smartcardNumber==self.dashSmartCardNumber)[0].services.filter((service)=>{return service.type=='ThirdParty'&&service.serviceName.toUpperCase().includes('SHOWMAX');});if(self.showmaxProductDetails&&self.showmaxProductDetails.length>0&&self.showmaxProductDetails[0].status.toUpperCase()=='ACTIVE'&&!isPremium&&isUpgradeCheck!=='true'){$("#cpoverlay").fadeOut(300);self.enableChangePackageModel=false;self.IsShowmaxWarningMsg=true;self.update();}
else{self.onChangePackage();}}
self.GetChangeAddOn=function(e){$("#cpoverlay").fadeIn(300);selectedAddOnValue=self.selectedCurrentAddOnValue;selectedAddOn=selectedAddOnValue.split('~')[0].trim();self.newAddOnPrice=selectedAddOnValue.split('~')[1].trim();self.currency=dstvApp.countrycurrency.toUpperCase();app.currentSelectedPackage=selectedAddOn;self.update();if(selectedAddOn.toUpperCase().includes('SHOWMAX')){self.newSelectedAddOnName=selectedAddOn;self.isShowmaxActive=true;self.parent.HandleActiveTab("showMore");riot.mount('tag-showmax-atb',{activateShowmaxAddOn:true,smartcardFromAddonReq:self.dashSmartCardNumber,showComponent:true});return;}
self.selectedAddOnCode=selectedAddOn.split('-')[0].trim();app.newSelectedAddOnName=selectedAddOn.split('-')[1].trim();app.currentSelectedAddOn=selectedAddOn;if(self.selectedAddOnCode&&dstvApp.movieAddonProductCodes)
self.isMovieAddOnSelected=dstvApp.movieAddonProductCodes.includes(self.selectedAddOnCode);window.SessionSave('app',app);self.update();var reqBodyLinkAddOn={"businessUnit":dstvApp.businessunit,"channel":dstvApp.channel,"country":dstvApp.country,"smartCardNumber":self.dashSmartCardNumber,"customerNumber":app.customernumber,"addOnProducts":[selectedAddOn]};if(dstvApp.EnableSecurityAuth){site.factory.Post(linkAddOnUrl,reqBodyLinkAddOn,null,self.onLinkAddOnSuccess,self.onLinkAddOnError,false,false,true,true);}
else site.trigger('getpostdata',linkAddOnUrl,'POST','application/json',"Bearer "+self.token,'',reqBodyLinkAddOn,'',self.onLinkAddOnSuccess,self.onLinkAddOnError);self.enableNextButton=false;self.update();}
self.onChangePackage=function(){self.IsShowmaxWarningMsg=false;$('.changePackModel').show();$('#changepackageModal').modal('show');$("#cpoverlay").fadeIn(300);self.reqBodyUpgradeDowngrade={"businessUnit":dstvApp.businessunit,"channel":dstvApp.channel,"country":dstvApp.country,"smartCardNumber":self.dashSmartCardNumber,"customerNumber":app.customernumber,"toPackageName":selectedPackage};app.packageUpgradeDowngradeReq=self.reqBodyUpgradeDowngrade;window.SessionSave('app',app);if(isUpgradeCheck==='true'){if(dstvApp.EnableSecurityAuth){site.factory.Post(upgradePackageUrl,self.reqBodyUpgradeDowngrade,null,self.onUpgradeDowngradeSuccess,self.onUpgradeDowngradeError,false,false,true,true);}
else site.trigger('getpostdata',upgradePackageUrl,'POST','application/json',"Bearer "+self.token,'',self.reqBodyUpgradeDowngrade,'',self.onUpgradeDowngradeSuccess,self.onUpgradeDowngradeError);}
else{if(dstvApp.EnableSecurityAuth){site.factory.Post(downgradePackageUrl,self.reqBodyUpgradeDowngrade,null,self.onUpgradeDowngradeSuccess,self.onUpgradeDowngradeError,false,false,true,true);}
else site.trigger('getpostdata',downgradePackageUrl,'POST','application/json',"Bearer "+self.token,'',self.reqBodyUpgradeDowngrade,'',self.onUpgradeDowngradeSuccess,self.onUpgradeDowngradeError);}
self.enableNextButton=false;self.update();}
self.onChangePackageSuccess=function(data){if(dstvApp.country.toLowerCase()=="sierra leone"){data.splice(data.findIndex(p=>p.name.includes('FRN11E36')),1)
data.splice(data.findIndex(p=>p.name.includes('MFRNSE36')),1)}
console.log('Package : Call Change Package API Success')
document.body.scrollTop=0;document.documentElement.scrollTop=0;$("#cpoverlay").fadeOut(300);app.showmaxUpgradeReq=false;window.SessionSave("app",app);filteredPackages=data.filter(d=>d.isAddOn===false).reverse();self.filteredShowmaxAddOn=data.filter(d=>d.isAddOn===true&&d.name.toUpperCase().includes('SHOWMAX'));if(self.filteredShowmaxAddOn&&self.filteredShowmaxAddOn.length>0){self.filteredShowmaxAddOn=self.filteredShowmaxAddOn[0];}
self.packages=filteredPackages.map((package)=>{return{PackageCode:package.name.split(' ')[0],PackageName:package.name,PackageDesc:package.description,IsUpgradable:package.isUpgrade.toString(),PackageCurrency:package.price.currency,PackagePrice:package.price.value,DualCurrencyPackageCurrency:package.localPrice?package.localPrice.currency:null,DualCurrencyPackagePrice:package.localPrice?package.localPrice.amount:null,}})
var pkgImpressionArr=[];self.packages.forEach(package=>{var impression={};impression.id=package.PackageCode;impression.name=package.PackageDesc.toLowerCase().replaceAll(new RegExp('dStv|bouquet|add-on|w/afr|is20|standalone|e/afr|e36| ','gi'),'').trim();impression.category="DP Change Package";impression.list="Self Service";pkgImpressionArr.push(impression);});self.pkgImpressionArr=pkgImpressionArr;if(opts.showmaxUpgrade||self.showmaxATBUpgrade||opts.showmaxATBUpgrade||opts.changePackage||opts.premiumStatusUpgrade){if(opts.premiumStatusUpgrade){self.packages=self.packages.filter(x=>x.PackageName.includes('PR')||x.PackageName.includes('BU'));}
else{self.packages=self.packages.filter(x=>x.PackageName.includes('PR')).filter(x=>!x.PackageName.includes('PREPRTS')).filter(x=>!x.PackageName.includes('PRWPRTSE36'));}}
self.showmaxProductDetails=app.viewSubscriptionResponse.filter(sc=>sc.smartcardNumber==self.dashSmartCardNumber)[0].services.filter((service)=>{return service.type=='ThirdParty'&&service.serviceName.toUpperCase().includes('SHOWMAX');});if(self.showmaxProductDetails&&self.showmaxProductDetails.length>0){self.showmaxProductDetails=self.showmaxProductDetails[0];if(self.showmaxProductDetails.status.toUpperCase()=='ACTIVE'){self.isShowmaxActive=true;}}
self.packagesCount=self.packages.length;if(self.packagesCount>2){$("#expandchangePackage").show();}else{$('.package-list').css('height','auto');}
filteredAddOns=data.filter(d=>d.isAddOn===true);if(filteredAddOns.length>0&&self.filteredAddOnServiceList&&self.filteredAddOnServiceList.length>0){$.each(self.filteredAddOnServiceList,function(i,item){filteredAddOns=filteredAddOns.filter(d=>d.id!=self.filteredAddOnServiceList[i].serviceId);});}
if(self.isShowmaxActive||!self.isShowMaxApplicable){filteredAddOns=filteredAddOns.filter(d=>!d.name.toUpperCase().includes('SHOWMAX'));}
self.addOns=filteredAddOns.map((addOn)=>{return{AddOnCode:addOn.name.split(' ')[0],AddOnName:addOn.name,AddOnDesc:addOn.description,AddOnCurrency:addOn.price.currency,AddOnPrice:addOn.price.value,AddOnDualCurrency:addOn.localPrice?addOn.localPrice.currency:null,DualCurrencyCurrentAddOnPrice:addOn.localPrice?addOn.localPrice.amount:null}})
var addOnImpressionArr=[];self.addOns.forEach(addOn=>{var impression={};impression.id=addOn.AddOnCode;impression.name=addOn.AddOnDesc.toLowerCase().replaceAll(new RegExp('dStv|bouquet|add-on|w/afr|is20|standalone|e/afr|e36| ','gi'),'').trim();impression.category="DP Add-on";impression.list="Self Service";addOnImpressionArr.push(impression);});self.addOnImpressionArr=addOnImpressionArr;if(opts.linkMovieAddon){self.addOns=self.addOns.filter(x=>x.AddOnName.includes('MOVIE'));}
self.addOnsCount=filteredAddOns.length;self.update();$("#cpoverlay").fadeOut(300);var isRadioChecked=$("input:radio[name='selectedPackage']").is(":checked");if(self.packagesCount>0&&(opts.showmaxUpgrade||self.showmaxATBUpgrade||opts.showmaxATBUpgrade||opts.changePackage||opts.premiumStatusUpgrade)){$('.Add-list-main-top').hide();$(".package-list-main-top .accordion_head").click();setTimeout(function(){$('input:radio[name="selectedPackage"]')[0].click();},500);}
$('.pay-package-dtls').hide();$('.change-package-options').click(function(){$('.pay-package-dtls').hide();$(this).closest('.main-packagelist-section').next(".clearfix").next(".pay-package-dtls").slideDown("fast");});$(".package-list-main-top .accordion_head").unbind('click');$(".Add-list-main-top .accordion_head").unbind('click');$(".package-list-main-top .accordion_head").click(function(){window.dataLayer=window.dataLayer||[];window.dataLayer.push({event:'eec.productImpressionGetnow',ecommerce:{impressions:pkgImpressionArr}});if($('.accordion_body').is(':visible')){$(".accordion_body").slideUp(300);$(".plusminus").text('+');$('.horizontal-line-one').show();$('.horizontal-line-second').show();}
if($(this).next(".accordion_body").is(':visible')){$(this).next(".accordion_body").slideUp(300);$(this).children(".plusminus").text('+');$('.horizontal-line-one').show();$('.horizontal-line-second').show();}else{$(this).next(".accordion_body").slideDown(300);$(this).children(".plusminus").text('-');$('.horizontal-line-one').hide();$('.horizontal-line-second').show();}});$(".Add-list-main-top .accordion_head").click(function(){window.dataLayer=window.dataLayer||[];window.dataLayer.push({event:'eec.productImpressionGetnow',ecommerce:{impressions:addOnImpressionArr}});if($('.accordion_body').is(':visible')){$(".accordion_body").slideUp(300);$(".plusminus").text('+');$('.horizontal-line-second').show();$('.horizontal-line-one').show();}
if($(this).next(".accordion_body").is(':visible')){$(this).next(".accordion_body").slideUp(300);$(this).children(".plusminus").text('+');$('.horizontal-line-second').show();$('.horizontal-line-one').show();}else{$(this).next(".accordion_body").slideDown(300);$(this).children(".plusminus").text('-');$('.horizontal-line-second').hide();$('.horizontal-line-one').show();}});if(self.packagesCount>0&&(opts.showmaxUpgrade||self.showmaxATBUpgrade||opts.showmaxATBUpgrade||opts.changePackage||opts.premiumStatusUpgrade)){$(".package-list-main-top .accordion_head").click();$('input:radio[name="selectedPackage"]')[0].click();}
if(self.addOns.length>0&&(opts.linkMovieAddon)){$('.package-list-main-top').hide();$(".Add-list-main-top .accordion_head").click();setTimeout(function(){$('input:radio[name="selectedAddOn"]')[0].click();},1000);}
$(document).ready(function(){$('<div class="overlayBottom"> <span id="expandchangePackage" style="display:none;"> <img src="/media/7681/icon-up-3.png" width="30px"></span></div>').insertAfter(".span.main-packagelist-section:last-of-type");$('#expandchangePackage').click(function(){$('.package-list').toggleClass('fullHeight');$('#changepackageModal').animate({scrollTop:$(document).height()},'slow');});});self.update();if(app.isVIVR&&!self.showmaxATBUpgrade){$(".package-list-main-top .accordion_head").trigger('click');setTimeout(function(){$('input:radio[name="selectedPackage"]')[0].click();},500);}}
self.InitializePackageSliders=function(){self.packageList=app.smartcards.filter(x=>x.primaryService);if(self.packageList){self.packageList.map(package=>{if(package.addonService.toUpperCase().includes('MOVIE')){package.addonService='DStv Movie Add-on';}})}
self.update();$('.change-package-slider-new').not('.slick-initialized').slick({appendArrows:'.arrows-Fix-error',dots:false,infinite:false,nextArrow:'<span class="slick-next slick-arrow arrowColor" aria-label="Next" style="transform: translateY(-50%) rotate(180deg) !important; height:30px !important; width:30px !important; line-height:30px !important; top:auto !important;"></span>',prevArrow:'<span class="slick-prev slick-arrow arrowColor" aria-label="Previous" style="transform: translateY(-50%) rotate(0deg) !important; height:30px !important; width:30px !important; line-height:30px !important; top:-11px !important;"></span>',slidesToShow:3,slidesToScroll:1,autoplay:false,arrows:true,speed:500,responsive:[{breakpoint:1024,settings:{slidesToShow:3,slidesToScroll:2,infinite:true,}},{breakpoint:925,settings:{slidesToShow:2,slidesToScroll:1,infinite:true,}},{breakpoint:600,settings:{slidesToShow:1,slidesToScroll:1,}},{breakpoint:480,settings:{slidesToShow:1,slidesToScroll:1,}}]});};self.onChangePackageError=function(err){console.log('Change Pacakge : error while changing the package')
document.body.scrollTop=0;document.documentElement.scrollTop=0;$("#cpoverlay").fadeOut(300);app.showmaxUpgradeReq=false;window.SessionSave("app",app);if(err.responseJSON&&ShowGenericError(err.responseJSON.StatusCode)){$(".error-note").html(`${langTranslateApp.genericTechnicalIssueMsg1} <u><a class="payments_errContactUs" href="${dstvApp.ContactUsURL}" onclick="{window.RedirectTargetOrgin}" target="blank">${langTranslateApp.subMenuContactUs}</a></u> ${langTranslateApp.genericTechnicalIssueMsg2}`);}
function ShowGenericError(errStatusCode){return errStatusCode==500||errStatusCode==400||errStatusCode==412||errStatusCode==424;}}
self.onChangePackage=function(){self.IsShowmaxWarningMsg=false;self.enableChangePackageModel=true;$("#cpoverlay").fadeIn(300);self.reqBodyUpgradeDowngrade={"businessUnit":dstvApp.businessunit,"channel":dstvApp.channel,"country":dstvApp.country,"smartCardNumber":self.dashSmartCardNumber,"customerNumber":app.customernumber,"toPackageName":selectedPackage};app.packageUpgradeDowngradeReq=self.reqBodyUpgradeDowngrade;window.SessionSave('app',app);if(isUpgradeCheck==='true'){if(dstvApp.EnableSecurityAuth){site.factory.Post(upgradePackageUrl,self.reqBodyUpgradeDowngrade,null,self.onUpgradeDowngradeSuccess,self.onUpgradeDowngradeError,false,false,true,true);}
else site.trigger('getpostdata',upgradePackageUrl,'POST','application/json',"Bearer "+self.token,'',self.reqBodyUpgradeDowngrade,'',self.onUpgradeDowngradeSuccess,self.onUpgradeDowngradeError);}
else{if(dstvApp.EnableSecurityAuth){site.factory.Post(downgradePackageUrl,self.reqBodyUpgradeDowngrade,null,self.onUpgradeDowngradeSuccess,self.onUpgradeDowngradeError,false,false,true,true);}
else site.trigger('getpostdata',downgradePackageUrl,'POST','application/json',"Bearer "+self.token,'',self.reqBodyUpgradeDowngrade,'',self.onUpgradeDowngradeSuccess,self.onUpgradeDowngradeError);}
self.enableNextButton=false;self.update();}
self.onUpgradeDowngradeSuccess=function(data){document.body.scrollTop=0;document.documentElement.scrollTop=0;console.log('Package : Call Upgrade/Downgrade API Success')
if(data){if(data.effectiveDate==null){self.pkgEffectiveDate=self.formatEffectiveDate(new Date());}
else{self.pkgEffectiveDate=self.formatEffectiveDate(new Date(data.effectiveDate));}}
$("#cpoverlay").fadeOut(300);self.enableChangePackageModel=false;self.enableCostSummary=false;self.IsChangePackageSuccess=true;if(self.showmaxATBUpgrade||opts.showmaxATBUpgrade){self.showmaxChangePackageSuccess=true;}
else{}
riot.mount('tag-dashboard-package-section');app.forceReload=true;window.dataLayer=window.dataLayer||[];window.dataLayer.push({event:'eec.productDetail',ecommerce:{click:{actionField:{list:'Self service'},products:[{id:app.selectedCurrentPackageDetails?app.selectedCurrentPackageDetails.PackageCode:app.selectedCurrentAddOnDetails.AddOnCode,name:app.selectedCurrentPackageDetails?app.selectedCurrentPackageDetails.PackageDesc.toLowerCase().replaceAll(new RegExp('dStv|bouquet|add-on|w/afr|is20|standalone|e/afr|e36| ','gi'),'').trim():app.selectedCurrentAddOnDetails.AddOnDesc.toLowerCase().replaceAll(new RegExp('dStv|bouquet|add-on|w/afr|is20|standalone|e/afr|e36| ','gi'),'').trim(),price:app.selectedCurrentPackageDetails?app.selectedCurrentPackageDetails.PackagePrice.toString():app.selectedCurrentAddOnDetails.AddOnPrice.toString(),brand:'DStv',category:'DP Change Package',variant:''}]}}});self.update();}
self.onUpgradeDowngradeError=function(err){document.body.scrollTop=0;document.documentElement.scrollTop=0;console.log('Upgrade/Downgrade Pacakge : error while upgrading/downgrading the package')
$("#cpoverlay").fadeOut(300);if(err.responseJSON.StatusCode==424){$("#cpoverlay").fadeIn(300);var reqBodyRetryQuotes={"businessUnit":dstvApp.businessunit,"channel":dstvApp.channel,"country":dstvApp.country,"smartCardNumber":app.SmartCardNumber,"products":[self.dashSelectedPackageName,app.currentSelectedPackage]};site.trigger('getpostdata',retryQuotesUrl,'POST','application/json',"Bearer "+self.token,'',reqBodyRetryQuotes,'',self.onRetryQuotesSuccess,self.onRetryQuotesError);self.enableCostSummary=false;self.enableChangePackageModel=false;self.update();$(".error-note").html(`${langTranslateApp.genericTechnicalIssueMsg1} <u><a class="payments_errContactUs" href="${dstvApp.ContactUsURL}" onclick="{window.RedirectTargetOrgin}" target="blank">${langTranslateApp.subMenuContactUs}</a></u> ${langTranslateApp.genericTechnicalIssueMsg2}`);}
else if(err.responseJSON.StatusCode==402){var res=err.responseJSON.Message.split('\\');res=JSON.parse(res);self.PerformPaymentBreakdown(res)
self.dueAmount=res.Payment.Amount;self.currency=res.Payment.Currency;self.DualCurrency=res.LocalCurrency?res.LocalCurrency.Currency:null;self.DualCurrencydueAmount=res.LocalCurrency?res.LocalCurrency.Amount:null;self.message=res.ResponseMessage;if(self.isShowmaxActive||opts.showmaxATBUpgrade){self.onGetNewShowmaxPrice();}
self.enableChangePackageModel=false;self.enableCostSummary=true;$('.progressbar li:nth-child(2)').addClass("change");$('.progressbar li:nth-child(3)').addClass("changes");window.dataLayer=window.dataLayer||[];window.dataLayer.push({event:'eec.productDetail',ecommerce:{click:{actionField:{list:'Self service'},products:[{id:app.selectedCurrentPackageDetails?app.selectedCurrentPackageDetails.PackageCode:app.selectedCurrentAddOnDetails.AddOnCode,name:app.selectedCurrentPackageDetails?app.selectedCurrentPackageDetails.PackageDesc.toLowerCase().replaceAll(new RegExp('dStv|bouquet|add-on|w/afr|is20|standalone|e/afr|e36| ','gi'),'').trim():app.selectedCurrentAddOnDetails.AddOnDesc.toLowerCase().replaceAll(new RegExp('dStv|bouquet|add-on|w/afr|is20|standalone|e/afr|e36| ','gi'),'').trim(),price:app.selectedCurrentPackageDetails?app.selectedCurrentPackageDetails.PackagePrice.toString():app.selectedCurrentAddOnDetails.AddOnPrice.toString(),brand:'DStv',category:'DP Change Package',variant:''}]}}});self.update();}
else if(err.responseJSON.StatusCode==417){self.enableCostSummary=false;self.enableChangePackageModel=false;self.IsSrqPendingMsg=true;self.update();if(site.env=='QA')
site.factory.CaptureFeedback('DSTVCHANGEPACKAGE_'+app.customernumber);}
else if(err.responseJSON.StatusCode==208){self.enableCostSummary=false;self.enableChangePackageModel=false;self.enableAddOnCostSummary=true;self.update();if(site.env=='QA')
site.factory.CaptureFeedback('DSTVCHANGEPACKAGE_'+app.customernumber);}
else{console.log(err.responseJSON.Message);self.enableCostSummary=false;self.enableChangePackageModel=false;self.IsErrorMessage=true;self.update();if(err.responseJSON&&ShowGenericError(err.responseJSON.StatusCode)){$(".error-note").html(`${langTranslateApp.genericTechnicalIssueMsg1} <u><a class="payments_errContactUs" href="${dstvApp.ContactUsURL}" onclick="{window.RedirectTargetOrgin}" target="blank">${langTranslateApp.subMenuContactUs}</a></u> ${langTranslateApp.genericTechnicalIssueMsg2}`);}
function ShowGenericError(errStatusCode){return errStatusCode==500||errStatusCode==400||errStatusCode==412||errStatusCode==424;}
if(!app.deadlineTime){let delay=5*60*1000;self.date=new Date();app.deadlineTime=self.date.setTime(self.date.getTime()+delay);window.SessionSave("app",app);}
if(site.env=='QA')
site.factory.CaptureFeedback('DSTVCHANGEPACKAGE_'+app.customernumber);self.update();}}
self.PerformPaymentBreakdown=function(quoteData){self.quoteData=quoteData;if(self.quoteData&&self.quoteData.Quote&&self.quoteData.Quote.LineItems)
self.quoteData.Quote.LineItems.sort((x,y)=>x.Id<y.Id?-1:1)
self.update()}
self.onRetryQuotesSuccess=function(data){console.log('Package : Call Retry Quotes API Success')
if(data){self.pkgEffectiveDate=self.formatEffectiveDate(new Date(data.effectiveDate));}
self.update();$("#cpoverlay").fadeOut(300);self.enableChangePackageModel=false;self.enableCostSummary=false;self.IsChangePackageSuccess=true;self.update();}
self.onRetryQuotesError=function(err){console.log('Retry Quotes  : error while retrying Quotes ')
$("#cpoverlay").fadeOut(300);if(err.responseJSON.StatusCode==402){var res=err.responseJSON.Message.split('\\');res=JSON.parse(res);self.PerformPaymentBreakdown(res)
self.dueAmount=res.Payment.Amount;self.currency=res.Payment.Currency;self.DualCurrency=res.PaymentInLocalCurrency.Currency;self.DualCurrencydueAmount=res.PaymentInLocalCurrency.Amount;self.message=res.ResponseMessage;self.update();self.enableChangePackageModel=false;self.enableCostSummary=true;}
else{console.log(err.responseJSON.Message);self.enableCostSummary=false;self.enableChangePackageModel=false;$('#errorMessageModal').modal('show');self.IsErrorMessage=true;self.update();if(err.responseJSON&&ShowGenericError(err.responseJSON.StatusCode)){$(".error-note").html(`${langTranslateApp.genericTechnicalIssueMsg1} <u><a class="payments_errContactUs" href="${dstvApp.ContactUsURL}" onclick="{window.RedirectTargetOrgin}" target="blank">${langTranslateApp.subMenuContactUs}</a></u> ${langTranslateApp.genericTechnicalIssueMsg2}`);}
function ShowGenericError(errStatusCode){return errStatusCode==500||errStatusCode==400||errStatusCode==412||errStatusCode==424;}}
self.update();}
self.onLinkAddOnSuccess=function(data){document.body.scrollTop=0;document.documentElement.scrollTop=0;console.log('Add On : Call LinkAddOn API Success');$("#cpoverlay").fadeOut(300);if(data){if(data.effectiveDate==null){self.pkgEffectiveDate=self.formatEffectiveDate(new Date());}
else{self.pkgEffectiveDate=self.formatEffectiveDate(new Date(data.effectiveDate));}}
self.enableCostSummary=false;self.enableChangePackageModel=false;self.IsAddOnSuccess=true;window.dataLayer=window.dataLayer||[];window.dataLayer.push({event:'eec.productDetail',ecommerce:{click:{actionField:{list:'Self Service'},products:[{id:app.selectedCurrentAddOnDetails?app.selectedCurrentAddOnDetails.AddOnCode:'',name:app.selectedCurrentAddOnDetails?app.selectedCurrentAddOnDetails.AddOnDesc.toLowerCase().replaceAll(new RegExp('dStv|bouquet|add-on|w/afr|is20|standalone|e/afr|e36| ','gi'),'').trim():'',price:app.selectedCurrentAddOnDetails?app.selectedCurrentAddOnDetails.AddOnPrice.toString():'',brand:'DStv',category:'DP Add-on',variant:''}]}}});self.update();app.currentSelectedAddon=undefined;app.forceReload=true;site.factory.CaptureFeedback('DSTVCHANGEPACKAGE_'+app.customernumber);}
self.onLinkAddOnError=function(err){document.body.scrollTop=0;document.documentElement.scrollTop=0;console.log('Link Add On : error while linking Add On to your package');$("#cpoverlay").fadeOut(300);if(err.responseJSON.StatusCode==424){$("#cpoverlay").fadeIn(300);var reqBodyRetryQuotes={"businessUnit":dstvApp.businessunit,"channel":dstvApp.channel,"country":dstvApp.country,"smartCardNumber":app.SmartCardNumber,"products":[self.dashSelectedPackageName,app.currentSelectedPackage]};site.trigger('getpostdata',retryQuotesUrl,'POST','application/json',"Bearer "+self.token,'',reqBodyRetryQuotes,'',self.onRetryQuotesAddonSuccess,self.onRetryQuotesAddonError);self.enableCostSummary=false;self.enableChangePackageModel=false;self.update();$(".error-note").html(`${langTranslateApp.genericTechnicalIssueMsg1} <u><a class="payments_errContactUs" href="${dstvApp.ContactUsURL}" onclick="{window.RedirectTargetOrgin}" target="blank">${langTranslateApp.subMenuContactUs}</a></u> ${langTranslateApp.genericTechnicalIssueMsg2}`);}
else if(err.responseJSON.StatusCode==402){var res=err.responseJSON.Message.split('\\');res=JSON.parse(res);self.PerformPaymentBreakdown(res)
self.dueAmount=res.Payment.Amount;self.currency=res.Payment.Currency;self.DualCurrency=res.LocalCurrency?res.LocalCurrency.Currency:null;self.DualCurrencydueAmount=res.LocalCurrency?res.LocalCurrency.Amount:null;self.message=res.ResponseMessage;self.enableChangePackageModel=false;self.enableAddOnCostSummary=true;window.dataLayer=window.dataLayer||[];window.dataLayer.push({event:'eec.productDetail',ecommerce:{click:{actionField:{list:'Self service'},products:[{id:app.selectedCurrentAddOnDetails?app.selectedCurrentAddOnDetails.AddOnCode:'',name:app.selectedCurrentAddOnDetails?app.selectedCurrentAddOnDetails.AddOnDesc.toLowerCase().replaceAll(new RegExp('dStv|bouquet|add-on|w/afr|is20|standalone|e/afr|e36| ','gi'),'').trim():'',price:app.selectedCurrentAddOnDetails?app.selectedCurrentAddOnDetails.AddOnPrice.toString():'',brand:'DStv',category:'DP Add-on',variant:''}]}}});self.update();}
else if(err.responseJSON.StatusCode==208){self.enableAddOnCostSummary=false;self.enableChangePackageModel=false;self.IsRepeatRequestMsg=true;self.update();if(site.env=='QA')
site.factory.CaptureFeedback('DSTVCHANGEPACKAGE_'+app.customernumber);}
else{console.log(err.responseJSON.Message);self.enableAddOnCostSummary=false;self.enableChangePackageModel=false;self.IsAddOnErrorMessage=true;self.update();if(err.responseJSON&&ShowGenericError(err.responseJSON.StatusCode)){$(".error-note").html(`${langTranslateApp.genericTechnicalIssueMsg1} <u><a class="payments_errContactUs" href="${dstvApp.ContactUsURL}" onclick="{window.RedirectTargetOrgin}" target="blank">${langTranslateApp.subMenuContactUs}</a></u> ${langTranslateApp.genericTechnicalIssueMsg2}`);}
function ShowGenericError(errStatusCode){return errStatusCode==500||errStatusCode==400||errStatusCode==412||errStatusCode==424;}
if(!app.deadlineTime){let delay=5*60*1000;self.date=new Date();app.deadlineTime=self.date.setTime(self.date.getTime()+delay);window.SessionSave("app",app);}
app.forceReload=true;if(site.env=='QA')
site.factory.CaptureFeedback('DSTVCHANGEPACKAGE_'+app.customernumber);}
app.currentSelectedAddon=undefined;}
self.onRetryQuotesAddonSuccess=function(data){console.log('Addon : Call Retry Quotes API Success')
if(data){self.pkgEffectiveDate=self.formatEffectiveDate(new Date(data.effectiveDate));}
self.update();$("#cpoverlay").fadeOut(300);self.enableChangePackageModel=false;self.enableAddOnCostSummary=false;self.IsAddOnSuccess=true;self.update();}
self.onRetryQuotesAddonError=function(err){console.log('Retry Quotes  : error while retrying Quotes for Addon')
$("#cpoverlay").fadeOut(300);if(err.responseJSON.StatusCode==402){var res=err.responseJSON.Message.split('\\');res=JSON.parse(res);self.PerformPaymentBreakdown(res)
self.dueAmount=res.Payment.Amount;self.currency=res.Payment.Currency;self.DualCurrency=res.LocalCurrency?res.LocalCurrency.Currency:null;self.DualCurrencydueAmount=res.LocalCurrency?res.LocalCurrency.Amount:null;self.message=res.ResponseMessage;self.enableChangePackageModel=false;self.enableAddOnCostSummary=true;self.update();}
else{console.log(err.responseJSON.Message);self.enableAddOnCostSummary=false;self.enableChangePackageModel=false;$('#errorMessageModal').modal('show');self.IsErrorMessage=true;self.update();if(err.responseJSON&&ShowGenericError(err.responseJSON.StatusCode)){$(".error-note").html(`${langTranslateApp.genericTechnicalIssueMsg1} <u><a class="payments_errContactUs" href="${dstvApp.ContactUsURL}" onclick="{window.RedirectTargetOrgin}" target="blank">${langTranslateApp.subMenuContactUs}</a></u> ${langTranslateApp.genericTechnicalIssueMsg2}`);}
function ShowGenericError(errStatusCode){return errStatusCode==500||errStatusCode==400||errStatusCode==412||errStatusCode==424;}}
self.update();}
self.formatEffectiveDate=function formatDate(date){var monthNames=["January","February","March","April","May","June","July","August","September","October","November","December"];var day=date.getDate();var monthIndex=date.getMonth();var year=date.getFullYear();return day+' '+monthNames[monthIndex]+' '+year;}
self.goToDashboardUrl=function(e){if(app.isVIVR){window.close();return;}
app.forceReload=true;app.currentSelectedAddon=undefined;app.currentSelectedPackage=undefined;window.HandleActiveTab("showAccount");self.update();site.factory.CaptureFeedback('DSTVCHANGEPACKAGE_'+app.customernumber);}
self.onErrorClose=function(){if(app.isVIVR){window.close();return;}
self.IsErrorMessage=false;self.IsAddOnErrorMessage=false;self.enableChangePackageModel=true;app.currentSelectedAddon=undefined;app.currentSelectedPackage=undefined;app.forceReload=true;window.HandleActiveTab("showAccount");self.update();}
self.update();self.ProcessPayment=function(){window.dataLayer=window.dataLayer||[];window.dataLayer.push({event:'eec.addToCart',ecommerce:{add:{products:[{id:app.selectedCurrentPackageDetails?app.selectedCurrentPackageDetails.PackageCode:app.selectedCurrentAddOnDetails.AddOnCode,name:app.selectedCurrentPackageDetails?app.selectedCurrentPackageDetails.PackageDesc.toLowerCase().replaceAll(new RegExp('dStv|bouquet|add-on|w/afr|is20|standalone|e/afr|e36| ','gi'),'').trim():app.selectedCurrentAddOnDetails.AddOnDesc.toLowerCase().replaceAll(new RegExp('dStv|bouquet|add-on|w/afr|is20|standalone|e/afr|e36| ','gi'),'').trim(),price:app.selectedCurrentPackageDetails?app.selectedCurrentPackageDetails.PackagePrice.toString():app.selectedCurrentAddOnDetails.AddOnPrice.toString(),brand:'DStv',category:'DP Change Package',variant:'',quantity:1}]}}});if(dstvApp.NoOnlinePaymentCountryList.includes(dstvApp.countryabbreviation)){if(dstvApp.configPackagesCountryList.includes(dstvApp.countryabbreviation)){self.waystopayURL=dstvApp.languageAbbreviation=='pt'?dstvApp.dstvUrl+window.culture+'/pagar/como-pagar/':dstvApp.dstvUrl+window.culture+'/pay/how-to-pay/';}else{self.waystopayURL=window.culture+(dstvApp.languageAbbreviation=='pt'?'/formas-de-pagamento':'/ways-to-pay');}
window.RedirectTargetOrgin(e,self.waystopayURL);}
else{$("#cpoverlay").fadeIn(300);self.enableChangePackageModel=false;self.enableCostSummary=false;self.enableAddOnCostSummary=false;if(self.opts.showmaxATBUpgrade||opts.showmaxATBUpgrade){window.HandleActiveTab("showPayment");riot.mount('tag-dashboard-payments',{showmaxChangePackagePayment:true,amount:self.dueAmount,dualCurrencyAmount:self.DualCurrencydueAmount});}
else if(opts.changePackage||opts.premiumStatusUpgrade){window.HandleActiveTab("showPayment");riot.mount('tag-dashboard-payments',{changePackagePayment:true,amount:self.dueAmount,dualCurrencyAmount:self.DualCurrencydueAmount});}
else if(opts.linkMovieAddon||self.isMovieAddOnSelected){window.HandleActiveTab("showPayment");riot.mount('tag-dashboard-payments',{movieAddonPayment:true,amount:self.dueAmount,dualCurrencyAmount:self.DualCurrencydueAmount});}
else{self.update();try{self.parent.HandleActiveTab("showPayment");}
catch(e){window.HandleActiveTab("showPayment");}
riot.mount('tag-dashboard-payments',{changePackagePayment:true,amount:self.dueAmount,dualCurrencyAmount:self.DualCurrencydueAmount});}}}
self.onGetNewShowmaxPrice=function(){$("#cpoverlay").fadeIn(300);let url=`${dstvApp.DSOChangePackageURL}?searchCust=${app.customernumber}`;var reqBody={"businessUnit":dstvApp.businessunit,"channel":dstvApp.channel,"country":dstvApp.country,"packageName":selectedPackage};site.trigger('getpostdata',url,'POST','application/json',"Bearer "+self.token,'',reqBody,'',self.onChangePackageSuccess,self.onChangePackageError);}
self.onCancelShowmax=function(){$('#changepackageModal').modal('hide');window.HandleActiveTab('showMore');riot.mount('tag-showmax-atb',{changePackageCancelShowmax:true,showComponent:true});}
self.onAddShowmax=function(){$('#changepackageModal').modal('hide');window.HandleActiveTab('showMore');riot.mount('tag-showmax-atb',{changePackageAddShowmax:true,showComponent:true});}
self.ExtractPackageNameWithoutCode=function(name){if(name.includes('-'))
return name.split('-')[1].trim();return name.trim();}
self.getNewPackageName=function(dateString){self.showpackageName=dstvApp.packages.filter((e,i)=>{return dateString.includes(e.properties.Name)})
let countryArray=dstvApp.newPackageNamesApplicable.find(p=>p[dstvApp.countryabbreviation])
if(countryArray){self.selectedPackageCode=self.showpackageName[0].properties.Code
var wordsToRemove=['Compact','Compact Pluse','Family','Access'];let expStr=wordsToRemove.join("|");if(Object.keys(countryArray[dstvApp.countryabbreviation]).includes(self.selectedPackageCode)){return dateString.replace(new RegExp('\\b('+expStr+')\\b','gi'),'  ').replace(/\s{2,}/," "+dstvApp.newPackageNamesApplicable[0].rw[self.selectedPackageCode].split(' ')[0]+" ");}
return dateString}else{return dateString}}});