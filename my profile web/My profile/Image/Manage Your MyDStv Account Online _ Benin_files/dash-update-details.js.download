riot.tag2('tag-update-user-details','<div if="{showUpdateDetails && !showMore}" class="update-details-wrapper content-wrapper main-top-Details-info clearfix"> <div class="update-details-inner"> <div class="update-details-top text-center"> <h2>{langTranslateApp.updateMyDetails}</h2> <div class="update-photo-wrapper"> <div class="profile-photo-box"> <div class="profile-photo-box-inner"><img src="/media/11090/user-default.jpg" alt="Profile Photo" /></div> <a href="javascript:void(0)" class="photo-edit-icon"> <span class="pic-edit"> <img src="/media/8619/materialicon-1.svg" class="pic-edit-icon" /></span> </a> </div> </div> <h3>{app.customername}</h3> </div> <div class="details_coloums clearfix"> <span class="address_details_coloums address-col active" onclick="{showAddressDetails}">{langTranslateApp.updateDetailsAddress}</span> <span class="contact_details_coloums contact-col" onclick="{showContactDetails}">{langTranslateApp.updateContactDetails}</span> </div> <div class="clearfix"></div> <div class="update-details-section"> <form class="update-details-form"> <span id="invalidpostalCodeMsg" style="display: none;" class="invalidpostalCodeMsgRed">{langTranslateApp.dashPleaseupdateYourAddress}</span> <a href="javascript:void(0)" onclick={onEditIconClick}> <span class="details_edit"> <img src="/media/8619/materialicon-1.svg" class="details_edit_iocn" /> </span> </a> <div class="details-rows"> <div class="details-coloum"> <span class="details-coloum-label">{langTranslateApp.updateHouseNumber}</span> <input type="text" name="address" value=" " class="details-coloum-value" readonly="readonly" id="housenumber" /></div> </div> <div class="details-rows"> <div class="details-coloum"> <span class="details-coloum-label">{langTranslateApp.updateStreetName}:</span> <input type="text" name="streetaddress" value="****" class="details-coloum-value" readonly id="streetname" onkeyup="{OnKeyUp}" /></div> </div> <div class="details-rows"> <div class="details-coloum"> <span class="details-coloum-label">{langTranslateApp.updateProvince}: *</span> <span class="details-coloum-value"> <select id="update-province" name="province" class="form-control jcf-hidden" disabled="true" onChange="{OnProvinceChange}"> <option value="">{langTranslateApp.updateSelectProvince}</option> <option each="{province, index in app.locationProvinceList}" value="{province.name}" selected="{ app.customerCurrentProvinceId[0].id === province.id }">{province.name}</option> </select> </span> </div> </div> <div class="details-rows"> <div class="details-coloum"> <span class="details-coloum-label">{langTranslateApp.updateCity}: *</span> <span class="details-coloum-value"> <select id="update-city" name="city" class="form-control jcf-hidden" disabled="disabled" onChange="{OnCityChange}"> <option value="">{langTranslateApp.updateSelectCity}</option> <option each="{city, index in app.locationCityList}" value="{city.name}" selected="{ app.customerCurrentCityId[0].id === city.id }">{city.name}</option> </select> </span> </div> </div> <div class="details-rows"> <div class="details-coloum"> <span class="details-coloum-label">{langTranslateApp.updateSuburb}: *</span> <span class="details-coloum-value"> <select id="update-suburb" name="suburb" class="form-control jcf-hidden" disabled="disabled" onChange="{OnSuburbChange}"> <option value="">{langTranslateApp.updateSelectSuburb}</option> <option each="{suburb, index in app.locationSuburbList}" value="{suburb.name}" selected="{ app.customerCurrentSuburbId[0].id === suburb.id }">{suburb.name}</option> </select> </span> </div> </div> <div class="details-rows"> <div class="details-coloum"> <span class="details-coloum-label">{langTranslateApp.updatePostalCode}:</span> <input type="text" name="postalcodeaddress" value="{app.postalcode}" class="details-coloum-value" disabled="disabled" id="postalcode" readonly="readonly" onkeyup="{OnKeyUp}" /></div> </div> <div class="details-rows"> <div class="details-coloum"> <span class="details-coloum-label">{langTranslateApp.updateCountry}:</span> <span class="details-coloum-value"> <input type="text" name="countryaddress" value="{app.country}" class="details-coloum-value" disabled="disabled" id="country" readonly="readonly" /> </span> </div> </div> <div style="clear: both;"></div> </form> <div class="text-contact-gray"><span class="contact-link-text">{langTranslateApp.updateGreyedOut} <a href="{GetContactPageLink()}" onclick="{window.RedirectTargetOrgin}">{langTranslateApp.updateGreyedOut1}</a> {langTranslateApp.updateGreyedOut2} </span></div> </div> <div class="contact-details-section" style="display: none;"> <form class="contact-details-form"> <a href="javascript:void(0)" onclick={onContactEditIconClick}> <span class="contact_edit"> <img src="/media/8619/materialicon-1.svg" class="details_edit_iocn" /> </span> </a> <div class="contact-rows"> <div class="contact-coloum"> <span class="contact-coloum-label">{langTranslateApp.updateTitle}:</span> <input type="text" name="title" value="Mr" class="contact-coloum-value" id="contactupdatetitle" readonly="readonly" /></div> </div> <div class="contact-rows"> <div class="contact-coloum"> <span class="contact-coloum-label">{langTranslateApp.accName}</span> <input type="text" name="name" value="***" class="contact-coloum-value" id="contactname" readonly="readonly" /></div> </div> <div class="contact-rows"> <div class="contact-coloum"> <span class="contact-coloum-label">{langTranslateApp.updateSurname}</span> <input type="text" name="surname" value="OLAROTIMI" class="contact-coloum-value" id="contactupdatesurname" readonly="readonly" /></div> </div> <div class="contact-rows"> <div class="contact-coloum"> <span class="contact-coloum-label">{langTranslateApp.updateEmail} *</span> <input type="email" autocomplete="off" name="email" value="abc@dummy.com" class="contact-coloum-value" maxlength="50" id="contactupdateemail" readonly="readonly" /></div> </div> <div class="details-rows"> <div class="contact-coloum"> <span class="contact-coloum-label en-dash-edit-small-font">{langTranslateApp.updateMobileNumber}: *</span> <input type="tel" name="mobilenumber" value="" maxlength="10" class="contact-coloum-value" id="contactupdatemobilenumber" onkeypress={checkIsNumeric} readonly /></div> </div> <div style="display:none" class="details-row  "> <div class="contact-coloum"> <span class="contact-coloum-label en-dash-edit-small-font">{langTranslateApp.updateHomeNumber}</span> <input type="tel" name="homenumber" class="contact-coloum-value" maxlength="10" id="contactupdatehometel" onkeypress={checkIsNumeric} readonly="readonly" /></div> </div> <div style="display:none"  class="details-rows"> <div class="contact-coloum"> <span class="contact-coloum-label en-dash-edit-small-font">{langTranslateApp.updateWorkNumber}</span> <input type="tel" name="worknumber" value="234567" class="contact-coloum-value" maxlength="10" onkeypress={checkIsNumeric} id="contactupdateworktel" readonly /></div> </div> <div class="details-rows"> <div class="contact-coloum" style="display: none;"> <span class="contact-coloum-label">{langTranslateApp.updateFaxNumber}</span> <input type="tel" name="faxnumber" value="****" class="contact-coloum-value" maxlength="14" id="contactupdatefaxtel" onkeypress={checkIsNumeric} readonly /></div> </div> <div style="clear: both;"></div> </form> <div class="text-contact-gray"><span class="contact-link-text">{langTranslateApp.updateGreyedOut} <a href="{GetContactPageLink()}" onclick="{window.RedirectTargetOrgin}" >{langTranslateApp.updateGreyedOut1}</a> {langTranslateApp.updateGreyedOut2} </span></div> </div> <div class="details_btn"><button type="button" class="cancel_details_btn" onclick={onCancelUpdateDetailsButtonClick} value="Validate">{langTranslateApp.updateCancel}<span class="arrowNow cancel"></span></button><button type="button" class="save_details_btn" onclick={onSaveDetailsButtonClick} value="Validate" disabled>{langTranslateApp.updateSave}<span class="arrowNow"></span></button></div> </div> <div if="{showUpdateDetailsSuccess}" class="payment-wrapper"> <div class="payment-main-sections success"> <div class="icon-img-common"></div> </div> <div class="response-end success"> <h5 class="payment-heading text-uppercase heading">{langTranslateApp.dashMyDetailsUpdate}</h5> <h5 class="payment-heading text-uppercase"><b>{langTranslateApp.payStatusSuccess}</b></h5> <div style="padding: 20px;" class="AwarenessInfoArea"> <div class="awareness-sub-text"> <b>{langTranslateApp.dashThankyouForbeingAwesome}</b> </div> </div> </div> <div class="Wrapper-white"> <p class="footer-info">{langTranslateApp.dashReceivedUpdateChanges}</p> <button id="continue" class="awareness-activate-btn" onclick={OnUpdateDetailsClose}> <span>{langTranslateApp.paymentsContinue}</span><span class="anim-span"></span><i class="fa fa-long-arrow-right pull-right" style="line-height:25px; font-size:larger;"></i></button> </div> </div> <div if="{showUpdateDetailsFailure}" class="payment-wrapper"> <div class="payment-main-sections failed"> <div class="icon-img-common"></div> </div> <div class="response-end failed"> <h5 class="payment-heading text-uppercase">{langTranslateApp.dashMyDetailsUpdate}</h5> <h5 class="payment-heading text-uppercase"><b>{langTranslateApp.dashboardRequestUnsuccessful}</b></h5> <div style="padding: 20px;" class="AwarenessInfoArea"> <div class="awareness-sub-text">{langTranslateApp.dashPersonalDetails}</div> <div class="dppinnerwrap details">{showError}</div> </div> <button id="retry" class="awareness-activate-btn" onclick={onRetry}> <span>{langTranslateApp.dashboardRetry}</span><span class="anim-span"></span><i class="fa fa-refresh pull-right" style="line-height:25px; font-size:larger;"></i></button> </div> </div> <div if="{genericError}" class=""><span class="icon-icon-warning"></span> <span class="error-wrong-msg">{langTranslateApp.paymentErrorMessageTitle}</span><span class="error-note">{langTranslateApp.genericTechnicalIssueMsg1}<u><a href="{dstvApp.ContactUsURL}" onclick="{window.RedirectTargetOrgin}" target="blank" > {langTranslateApp.subMenuContactUs}</a></u>{langTranslateApp.genericTechnicalIssueMsg2}</span><a href="javascript:void(0)" onclick="{onRetry}" class="btn anim-btn btn-default ok-btn close" data-dismiss="modal">{langTranslateApp.menuClose}</a></div> <div class="" style="z-index: 9999;" if="{updating}"> <div class="fix-errors-loader-bg"> <div class="loading-loader loading"> <div class="col-sm-12 text-center white"> <div class="spinner white"></div> <div class="loading-message">{langTranslateApp.dashProcessing}</div> </div> </div> </div> </div><div class="otp-screen-wrapper text-center"><h1>{langTranslateApp.otpHeader}</h1><h3>{langTranslateApp.otpHeaderDescription} <strong>{mobNoEndwith}</strong></h3><p>{langTranslateApp.otpincorrectMob}<br>{langTranslateApp.otptryMobno} <a href=# onclick="{onClickHere}"><strong>{langTranslateApp.optclickhere}</strong></a>.<div class=otp-verify-box><h4>{langTranslateApp.otpDescriptionHeader}</h4><form class=otp-form><div class="mb-2 otp-group"><input id=otpBox1 maxlength=1 onkeydown="{IsValidOTP}" type="number"> <input id=otpBox2 maxlength=1 onkeydown="{IsValidOTP}" type="number"> <input id=otpBox3 maxlength=1 onkeydown="{IsValidOTP}" type="number"> <input id=otpBox4 maxlength=1 onkeydown="{IsValidOTP}" type="number"></div><p id="otperror" class="mb-2 text-danger" style="font-weight:700;"></p><div class="mb-4 verify-otp-btn"><button class="btn btn-blue"id=verifyOtp type=button disabled="{!enableSend}" onclick="{onVerifyOTP}">{langTranslateApp.otpverify}</button></div><p><strong>{langTranslateApp.otpnotReceived}</strong><br><span>{langTranslateApp.otptimermsg} {resendTimer} {langTranslateApp.otpsec}.</span><div><button class="btn btn-blue" id=resendOtp type=button onclick="{onRetryOTP}"   disabled="{!enableRetry}">{langTranslateApp.otpresend}</button></div></form></div></div></div>','','',function(opts){var self=this;let surname=app.customername;let smartcard=app.smartcard;let customerNumber=app.customernumber;let mobileNumberTxt='#contactupdatemobilenumber';let homeTelephoneTxt='#contactupdatehometel';let workTelephoneTxt='#contactupdateworktel';let faxNumberTxt='#contactupdatefaxtel';let contactUpdateDetailsTxt='#contactupdateemail';self.ptDashEditSmallFontClass=dstvApp.languageAbbreviation+"-dash-edit-small-font";self.updating=false;self.genericError=false;self.showUpdateDetailsFailure=false;self.showUpdateDetailsSuccess=false;self.enableRetry=false
self.enableSend=false
app.generateOTP=false;app.updateContactwithOTP=undefined;self.mobNoEndwith=876;self.email="P***l@gmail.com";sessionStorage.setItem('hashToken',null);self.resendTimer=0;$('.cancel_details_btn').addClass('active');self.on('before-mount',function(){if(opts.showComponent){self.showUpdateDetails=true;$('.airtime-wrapper').hide();$('tag-more-service').hide();}
else
self.showUpdateDetails=false;});self.on('mount',function(){$(".otp-screen-wrapper").hide();self.updating=true;self.update();if(self.showUpdateDetails){console.log('Update Details: Rendering Started...')
self.GenerateToken();}
if(app.loggedin){self.primaryAddress=_.filter(app.customerDetails.ListOfAddress,function(address){return address.IsPrimary===true;});$('.main-top-Details-info input').next(".red").remove();$('.main-top-Details-info select').next(".red").remove();$(".details_edit").click(function(){$('.update-details-section').addClass('active');$('.main-top-Details-info').addClass('active');$('.contact-details-section').addClass('active');$('.main-top-Details-info').addClass('active');});$(".contact_edit").click(function(){$('.contact-details-section').addClass('active');$('.main-top-Details-info').addClass('active');$('.update-details-section').addClass('active');$('.main-top-Details-info').addClass('active');});$(".contacts .cta.blue").click(function(){$('.main-top-Details-info').removeClass('hidden');$('#UpdatefailedModal').css('display','none');$('#UpdateSuccessModal').css('display','none');});$('#contactupdatemobilenumber').on('change keyup',function(){var sanitized=$(this).val().replace(/[^0-9]/g,'');$(this).val(sanitized);});$('#contactupdatehometel').on('change keyup',function(){var sanitized=$(this).val().replace(/[^0-9]/g,'');$(this).val(sanitized);});$('#contactupdateworktel').on('change keyup',function(){var sanitized=$(this).val().replace(/[^0-9]/g,'');$(this).val(sanitized);});$('#contactupdatefaxtel').on('change keyup',function(){var sanitized=$(this).val().replace(/[^0-9]/g,'');$(this).val(sanitized);});$('#contactupdatemobilenumber').keyup(function(){$('#contactupdatemobilenumber').next(".red").remove();});$('#contactupdatehometel').keyup(function(){$('#contactupdatehometel').next(".red").remove();});$('#contactupdateworktel').keyup(function(){$('#contactupdateworktel').next(".red").remove();});$('#contactupdateemail').keyup(function(){$('#contactupdateemail').next(".red").remove();});}
if(opts.airtimeUpdateDetails){self.showContactDetails();}});self.OnProvinceChange=function(e){$('#update-province').next(".red").remove();$('#invalidpostalCodeMsg').next(".red").remove();console.log('Update Details : Province changed');let selectedProvinceName=e.currentTarget.value;self.log(selectedProvinceName);app.customerCurrentProvinceId=_.filter(app.locationProvinceList,function(province){return province.name.toLowerCase()===selectedProvinceName.toLowerCase();});$('#update-city').val('');$('#update-suburb').val('');$('#postalcode').val('');app.locationSuburbList=[]
app.locationCityList=_.map(app.customerCurrentProvinceId,'cityList')[0];if(selectedProvinceName.toLowerCase()=="addis ababa"&&dstvApp.countryabbreviation=="et"){$('#update-city').parent().parent().parent().hide()
langTranslateApp.updateProvince="Region"
langTranslateApp.updateCity="Zone"
langTranslateApp.updateSuburb="Sub city"
langTranslateApp.updatePleaseSelectProvince="Please select region"
langTranslateApp.updatePleaseSelectCity="Please select zone"
langTranslateApp.updatePleaseSelectSuburb="Please select sub city"
langTranslateApp.updateSelectProvince="Select Region"
langTranslateApp.updateSelectCity="Select Zone"
langTranslateApp.updateSelectSuburb="Select Sub City"
self.OnCityChange(e)}else if(dstvApp.countryabbreviation=="et"){$('#update-city').parent().parent().parent().show()
langTranslateApp.updateProvince="Region"
langTranslateApp.updateCity="Zone"
langTranslateApp.updateSuburb="City"
langTranslateApp.updatePleaseSelectProvince="Please select region"
langTranslateApp.updatePleaseSelectCity="Please select zone"
langTranslateApp.updatePleaseSelectSuburb="Please select city"
langTranslateApp.updateSelectProvince="Select Region"
langTranslateApp.updateSelectCity="Select Zone"
langTranslateApp.updateSelectSuburb="Select City"}
self.update();jcf.replaceAll();self.update();}
self.OnCityChange=function(e){$('#update-city').next(".red").remove();$('#invalidpostalCodeMsg').next(".red").remove();self.log('city changed');let selectedCityName=e.currentTarget.value;self.log(selectedCityName);app.customerCurrentCityId=_.filter(app.locationCityList,function(city){return city.name.toLowerCase()===selectedCityName.toLowerCase();});$('#update-suburb').val('');app.locationSuburbList=_.map(app.customerCurrentCityId,'suburbList')[0];jcf.replaceAll();self.update();}
self.OnSuburbChange=function(e){$('#update-suburb').next(".red").remove();$("#postalcode").next(".red").remove();$('#invalidpostalCodeMsg').next(".red").remove();self.log('suburb changed');let selectedSuburbName=e.currentTarget.value;self.log(selectedSuburbName);app.customerCurrentSuburbId=_.filter(app.locationSuburbList,function(suburb){return suburb.name.toLowerCase()===selectedSuburbName.toLowerCase();});app.locationPostalCode=_.map(app.customerCurrentSuburbId,'postalCode')[0];self.update();$('#postalcode').val(app.locationPostalCode);self.update();}
self.showAddressDetails=function(){console.log("Update Details:  Opening Address section");$(".update-details-section").show();$(".contact-details-section").hide();$('.address_details_coloums').addClass('active');$('.contact_details_coloums').removeClass('active');}
self.showContactDetails=function(){console.log("Update Details:  Opening Contact section");$(".update-details-section").hide();$(".contact-details-section").show();$('.contact_details_coloums').addClass('active');$('.address_details_coloums').removeClass('active');}
self.sucessGetLocation=function(data){console.log('Location : Location loaded');self.updating=false;app.customerPrimaryAddress=_.filter(app.customerDetails.ListOfAddress,function(address){return address.IsPrimary===true;});if(app.customerPrimaryAddress&&app.customerPrimaryAddress.length==0&&app.customerDetails.ListOfAddress){app.customerPrimaryAddress=app.customerDetails.ListOfAddress;app.customerPrimaryAddress[0].IsPrimary=true;app.customerPrimaryAddress[0].country=dstvApp.country;}
else if(!app.customerDetails.ListOfAddress)
app.customerPrimaryAddress=[{Type:"Physical",HouseNumber:"",BuildingNumber:"",BuildingName:"",Street:"",Suburb:"",City:"",country:dstvApp.country,PostCode:"",Province:"",PostBoxNumber:"",IsPrimary:true,Floor:"",IsBillingAddress:false}];app.TempCustomerPrimaryAddress=app.customerPrimaryAddress;let customerCurrentProvinceName=app.customerPrimaryAddress[0].province;customerCurrentsuburbName=app.customerPrimaryAddress[0].subUrb;app.locationProvinceList=_.map(data,function(province){return{id:province.id,name:province.name,cityList:province.cityList};});app.customerCurrentProvinceId=_.filter(app.locationProvinceList,function(province){return province.name.toLowerCase()===customerCurrentProvinceName.toLowerCase();});let customerCurrentCityName=app.customerPrimaryAddress[0].city;app.locationCityList=_.map(app.customerCurrentProvinceId,'cityList')[0];app.customerCurrentCityId=_.filter(app.locationCityList,function(city){return city.name.toLowerCase()===customerCurrentCityName.toLowerCase();});app.locationSuburbList=_.map(app.customerCurrentCityId,'suburbList')[0];app.customerCurrentSuburbId=_.filter(app.locationSuburbList,function(suburb){return suburb.name.toLowerCase()===customerCurrentsuburbName.toLowerCase();});app.customerPrimaryAddress[0].province.toLowerCase()=="addis ababa"&&dstvApp.countryabbreviation=="et"?$('#update-city').parent().parent().parent().hide():$('#update-city').parent().parent().parent().show()
if(app.customerPrimaryAddress[0].province.toLowerCase()=="addis ababa"&&dstvApp.countryabbreviation=="et"){$('#update-city').parent().parent().parent().hide()
langTranslateApp.updateProvince="Region"
langTranslateApp.updateCity="Zone"
langTranslateApp.updateSuburb="Sub city"
langTranslateApp.updatePleaseSelectProvince="Please select region"
langTranslateApp.updatePleaseSelectCity="Please select zone"
langTranslateApp.updatePleaseSelectSuburb="Please select sub city"
langTranslateApp.updateSelectProvince="Select Region"
langTranslateApp.updateSelectCity="Select Zone"
langTranslateApp.updateSelectSuburb="Select Sub City"}else if(dstvApp.countryabbreviation=="et"){$('#update-city').parent().parent().parent().show()
langTranslateApp.updateProvince="Region"
langTranslateApp.updateCity="Zone"
langTranslateApp.updateSuburb="City"
langTranslateApp.updatePleaseSelectProvince="Please select region"
langTranslateApp.updatePleaseSelectCity="Please select zone"
langTranslateApp.updatePleaseSelectSuburb="Please select city"
langTranslateApp.updateSelectProvince="Select Region"
langTranslateApp.updateSelectCity="Select Zone"
langTranslateApp.updateSelectSuburb="Select City"}
self.update();jcf.replaceAll();self.Initializedatabinding();};self.errorGetLocation=function(error){console.log('Location : Error in pulling location details');self.updating=false;console.log(error);};self.GenerateToken=function(){console.log('Location : Pulling location details...');self.updating=true;if(dstvApp.EnableSecurityAuth){let url=`${dstvApp.SecurityAuthBaseUrl}apiupdatecontactdetails/api/v1/UpdateContactDetails/GetLocations?country=${dstvApp.country}&BusinessUnit=${dstvApp.businessunit}&Channel=${dstvApp.channel}`;site.factory.Get(url,null,self.sucessGetLocation,self.errorGetLocation,false,false,true);}else{site.factory.GetJWT().then(function(token){self.token=token;let url=`${dstvApp.DSOAPIUrl}apiupdatecontactdetails/api/v1/UpdateContactDetails/GetLocations?country=${dstvApp.country}&BusinessUnit=${dstvApp.businessunit}&Channel=${dstvApp.channel}`;site.factory.Get(url,self.token,self.sucessGetLocation,self.errorGetLocation);})}};self.Initializedatabinding=function(){console.log('Fetching Details : Details...')
$('.main-top-Details-info input').next(".red").remove();$('.main-top-Details-info select').next(".red").remove();$('.contact-details-section').removeClass('active');$('.update-details-section').removeClass('active');$('.update-details-section select').attr('disabled',true);$('.contact-details-section input').attr('readonly',true);$('.update-details-section input').attr('readonly',true);if(app.customerCurrentSuburbId.length>0){if(app.customerDetails.ListOfAddress[0].postalCode!=app.customerCurrentSuburbId[0].postalCode){$('#invalidpostalCodeMsg').css({'display':'block'});}else{$('#invalidpostalCodeMsg').css({'display':'none'});}}
setTimeout(function(){$('#housenumber').val(app.customerPrimaryAddress[0].houseNumber);$('#postalcode').val(app.customerPrimaryAddress[0].postalCode);$('#streetname').val(app.customerPrimaryAddress[0].streetName);$('#country').val(app.customerPrimaryAddress[0].country);$('#update-province').val(app.customerCurrentProvinceId[0].name);$('#contactname').val(app.customercontactdetails.FirstName);$('#contactupdateemail').val(app.customercontactdetails.EmailAddress);$('#contactupdatetitle').val(app.customercontactdetails.Title);$('#contactupdatemobilenumber').val(app.customercontactdetails.MobileTel);$('#contactupdatehometel').val(app.customercontactdetails.HomeTel);$('#contactupdatefaxtel').val(app.customercontactdetails.FaxTel);$('#contactupdateworktel').val(app.customercontactdetails.WorkTel);$('#contactupdatesurname').val(app.customercontactdetails.Surname);if(app.customerCurrentSuburbId.length>0){if(app.customerDetails.ListOfAddress[0].postalCode!=app.customerCurrentSuburbId[0].postalCode){$('#invalidpostalCodeMsg').css({'display':'block'});}else{$('#invalidpostalCodeMsg').css({'display':'none'});}}
riot.update();self.update();jcf.refreshAll();},100)
console.log("fetching details completed....");};self.OnUpdateDetailsClose=function(){console.log('cancel editing on Modal Close..');if(opts.airtimeUpdateDetails){self.showUpdateDetails=false;window.HandleActiveTab("showMore")
riot.mount('tag-buy-airtime',{showComponent:true,showNotice:false});return;}
self.updating=false;self.showUpdateDetailsSuccess=false;self.update();$('.save_details_btn').attr('disabled',true);$(".update-details-inner").show();self.Initializedatabinding();onEditIconClickCount=0;$('.contact-details-section').removeClass('active');$('.update-details-section').removeClass('active');$('.main-top-Details-info').removeClass('active');$('.update-details-section select').attr('disabled',true);$('.update-details-section input').attr('readonly',true);$('.contact-details-section input').attr('readonly',true);$('#housenumber').val(app.TempCustomerPrimaryAddress[0].HouseNumber);$('#postalcode').val(app.TempCustomerPrimaryAddress[0].PostCode);$('#streetname').val(app.TempCustomerPrimaryAddress[0].Street);$('#country').val(app.TempCustomerPrimaryAddress[0].Country);$('#contactname').val(app.customercontactdetails.FirstName);$('#contactupdateemail').val(app.customercontactdetails.EmailAddress);$('#contactupdatetitle').val(app.customercontactdetails.Title);$('#contactupdatemobilenumber').val(app.customercontactdetails.MobileTel);$('#contactupdatehometel').val(app.customercontactdetails.HomeTel);$('#contactupdatefaxtel').val(app.customercontactdetails.FaxTel);$('#contactupdateworktel').val(app.customercontactdetails.WorkTel);$('#contactupdatesurname').val(app.customercontactdetails.Surname);$('.main-top-Details-info input').next(".red").remove();$('.main-top-Details-info select').next(".red").remove();let customerCurrentProvinceName=app.TempCustomerPrimaryAddress[0].Province,customerCurrentsuburbName=app.TempCustomerPrimaryAddress[0].Suburb;app.customerCurrentProvinceId=_.filter(app.locationProvinceList,function(province){return province.name.toLowerCase()===customerCurrentProvinceName.toLowerCase();});let customerCurrentCityName=app.TempCustomerPrimaryAddress[0].City;app.locationCityList=_.map(app.customerCurrentProvinceId,'cityList')[0];app.customerCurrentCityId=_.filter(app.locationCityList,function(city){return city.name.toLowerCase()===customerCurrentCityName.toLowerCase();});app.locationSuburbList=_.map(app.customerCurrentCityId,'suburbList')[0];app.customerCurrentSuburbId=_.filter(app.locationSuburbList,function(suburb){return suburb.name.toLowerCase()===customerCurrentsuburbName.toLowerCase();});self.update();riot.update();jcf.refreshAll();}
self.GetContactPageLink=function(){if(site.env=='PROD'&&dstvApp.SelfServiceEnabledCountries.includes(dstvApp.countryabbreviation)){return `https://eazy.dstv.com/${dstvApp.languageAbbreviation}/${dstvApp.countryabbreviation}/contact`}
else{return window.culture+langTranslateApp.subMenuContactUsLink;}}
self.log=function(action){if(typeof action=='string')
console.log(`Update Details : ${action}`);else
console.log(action);}
var onEditIconClickCount=0;self.onEditIconClick=function(e){console.log('Update Details : On Edit Click')
onEditIconClickCount=onEditIconClickCount+1;if(onEditIconClickCount==1){$('.save_details_btn').attr('disabled',false);if(app.customerCurrentSuburbId.length>0){if(app.customerDetails.ListOfAddress[0].postalCode!=app.customerCurrentSuburbId[0].postalCode){let selectedProvinceName="";self.log(selectedProvinceName);app.customerCurrentProvinceId=_.filter(app.locationProvinceList,function(province){return province.name.toLowerCase()===selectedProvinceName.toLowerCase();});$('#update-province').val('');$('#update-city').val('');$('#update-suburb').val('');$('#postalcode').val('');$('#streetname').val('');app.locationSuburbList=[]
app.locationCityList=_.map(app.customerCurrentProvinceId,'cityList')[0];jcf.replaceAll();self.update();}}else{}}
$('.update-details-section input').attr('readonly',false);$('.update-details-section select').attr('disabled',false);$('#housenumber').focus();$('.contact-details-section input').attr('readonly',false);$('#contactupdatetitle').attr('disabled',true);$('#contactname').attr('disabled',true);$('#contactupdatesurname').attr('disabled',true);};self.onContactEditIconClick=function(e){console.log('Update Details: onContactEditIconClick')
onEditIconClickCount=0;$('.save_details_btn').attr('disabled',false);$('.contact-details-section input').attr('readonly',false);$(contactUpdateDetailsTxt).focus();$('#contactupdatetitle').attr('disabled',true);$('#contactname').attr('disabled',true);$('#contactupdatesurname').attr('disabled',true);$('.update-details-section input').attr('readonly',false);$('.update-details-section select').attr('disabled',false);};self.onRetryUpdateDetailsButtonClick=function(e){$('.main-top-Details-info').removeClass('hidden');self.updating=false;onEditIconClickCount=0;$('.contact-details-section').removeClass('active');$('.update-details-section').removeClass('active');$('.main-top-Details-info').removeClass('active');$('.update-details-section select').attr('disabled',true);$('.update-details-section input').attr('readonly',true);$('.contact-details-section input').attr('readonly',true);$('#housenumber').val(app.customerPrimaryAddress[0].houseNumber);$('#postalcode').val(app.customerPrimaryAddress[0].postCode);$('#streetname').val(app.customerPrimaryAddress[0].streetName);$('#country').val(app.customerPrimaryAddress[0].country);$('#contactname').val(app.customercontactdetails.FirstName);$('#contactupdateemail').val(app.customercontactdetails.EmailAddress);$('#contactupdatetitle').val(app.customercontactdetails.Title);$('#contactupdatemobilenumber').val(app.customercontactdetails.MobileTel);$('#contactupdatehometel').val(app.customercontactdetails.HomeTel);$('#contactupdatefaxtel').val(app.customercontactdetails.FaxTel);$('#contactupdateworktel').val(app.customercontactdetails.WorkTel);$('#contactupdatesurname').val(app.customercontactdetails.Surname);$('#contactupdatemobilenumber').next(".red").remove();$('#contactupdateemail').next(".red").remove();let customerCurrentProvinceName=app.customerPrimaryAddress[0].province,customerCurrentsuburbName=app.customerPrimaryAddress[0].subUrb;app.customerCurrentProvinceId=_.filter(app.locationProvinceList,function(province){return province.name.toLowerCase()===customerCurrentProvinceName.toLowerCase();});let customerCurrentCityName=app.customerPrimaryAddress[0].city;app.locationCityList=_.map(app.customerCurrentProvinceId,'cityList')[0];app.customerCurrentCityId=_.filter(app.locationCityList,function(city){return city.name.toLowerCase()===customerCurrentCityName.toLowerCase();});app.locationSuburbList=_.map(app.customerCurrentCityId,'suburbList')[0];app.customerCurrentSuburbId=_.filter(app.locationSuburbList,function(suburb){return suburb.name.toLowerCase()===customerCurrentsuburbName.toLowerCase();});self.update();jcf.refreshAll();}
self.onCancelUpdateDetailsButtonClick=function(e){console.log('Update Details: canceling editing..');self.showUpdateDetails=false;if(opts.airtimeUpdateDetails){window.HandleActiveTab("showMore")
riot.mount('tag-buy-airtime',{showComponent:true,showNotice:false});}else{self.root._tag.parent.HandleActiveTab('showMore')
$('tag-more-service').show();}};self.validateAll=function(){let errors=[],emailaddress=$('#contactupdateemail').val(),address=$(mobileNumberTxt).val();mobiNumeber=$(mobileNumberTxt).val();homeNumber=$(homeTelephoneTxt).val();workNumber=$(workTelephoneTxt).val();if(address.length==0||!checkIsDigit(address)){errors.push({msg:langTranslateApp.updateInvalidMobile,error:true,fieldId:'#contactupdatemobilenumber',});$(mobileNumberTxt).focus();}
if(!ValidateEmail(emailaddress)){errors.push({msg:langTranslateApp.updateInvalidEmail,error:true,fieldId:'#contactupdateemail',});$(contactUpdateDetailsTxt).focus();}
errors=validateMobiHomeWorkNumber(mobiNumeber,dstvApp.countryCode,errors,true,false,false);if(!$("#update-province").val())
errors.push({msg:langTranslateApp.updatePleaseSelectProvince,error:true,fieldId:'#update-province'})
if(!$("#update-city").val())
errors.push({msg:langTranslateApp.updatePleaseSelectCity,error:true,fieldId:'#update-city'})
if(!$("#update-suburb").val())
errors.push({msg:langTranslateApp.updatePleaseSelectSuburb,error:true,fieldId:'#update-suburb'})
if(app.customerDetails.ListOfAddress[0].postalCode==$("#postalcode").val()){if(app.customerCurrentSuburbId.length>0){if(app.customerDetails.ListOfAddress[0].postalCode!=app.customerCurrentSuburbId[0].postalCode){errors.push({msg:"",error:true,fieldId:'#postalcode'});$(".update-details-section").show();$(".contact-details-section").hide();}else{}}
else{}}
else{}
return errors;};function checkIsDigit(valueTocheck){var numberRegex=/^[+-]?\d+(\.\d+)?([eE][+-]?\d+)?$/;return numberRegex.test(valueTocheck);}
function ValidateEmail(email){var expr=/^([\w-\.]+)@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.)|(([\w-]+\.)+))([a-zA-Z]{2,4}|[0-9]{1,3})(\]?)$/;return expr.test(email);};function validateMobiHomeWorkNumber(number,countryCode,errors,isMobiNumber,isHomeNumber,isWorkNumber){var fieldIdTxt='';if(isMobiNumber){fieldIdTxt='#contactupdatemobilenumber';}else if(isHomeNumber){fieldIdTxt='#contactupdatehometel';}else if(isWorkNumber){fieldIdTxt='#contactupdateworktel';}else{}
if(number.length<7||number.length>10){errors.push({msg:langTranslateApp.updateInvalidMobileWorkHomeNumberLength,error:true,fieldId:fieldIdTxt,});app.generateOTP=false;return errors;}else{if(isMobiNumber){var numberType=isMobileNumber(number,countryCode,isMobiNumber,isHomeNumber,isWorkNumber);if(!numberType.includes("Mobile")){errors.push({msg:langTranslateApp.updateInvalidMobile,error:true,fieldId:fieldIdTxt,});app.generateOTP=false;return errors;}else{return errors;}}else{var numberType=isMobileNumber(number,countryCode,isMobiNumber,isHomeNumber,isWorkNumber);if(!numberType.includes("Mobile")&&!numberType.includes("Fixed Line")){if(isHomeNumber){errors.push({msg:langTranslateApp.updateInvalidHome,error:true,fieldId:fieldIdTxt,});}else if(isWorkNumber){errors.push({msg:langTranslateApp.updateInvalidWork,error:true,fieldId:fieldIdTxt,});}else{return errors;}}
else{return errors;}}}
return errors;}
function isMobileNumber(number,countryCode,isMobiNumber,isHomeNumber,isWorkNumber){var phoneUtil=i18n.phonenumbers.PhoneNumberUtil.getInstance();var regionCode=phoneUtil.getRegionCodeForCountryCode(countryCode);var phNumber=phoneUtil.parseAndKeepRawInput(number,regionCode);if(phoneUtil.isValidNumber(phNumber)){var PNT=i18n.phonenumbers.PhoneNumberType;var numberType=phoneUtil.getNumberType(phNumber);if(numberType==PNT.MOBILE){return "Mobile";}else if(numberType==PNT.FIXED_LINE){return "Number is Fixed Line."}else if(numberType==PNT.FIXED_LINE_OR_MOBILE){return "Number is Fixed Line or Mobile";}else if(numberType==PNT.UNKNOWN){return "Unknown Number. Please enter valid number.";}else{return langTranslateApp.updateInvalidMobile;}}else{if(isMobiNumber){return langTranslateApp.updateInvalidMobile;}else if(isHomeNumber){return langTranslateApp.updateInvalidHome;}else{return langTranslateApp.updateInvalidWork;}
$(mobileNumberTxt).focus();}}
self.onSaveDetailsButtonClick=function(e){console.log('Update Details : Updating...');let errors=self.validateAll();if(errors.length!=0){if(errors[0].fieldId=="#update-province"||errors[0].fieldId=="#update-city"||errors[0].fieldId=="#update-suburb"){self.showAddressDetails();}
else if(errors[0].fieldId=="#contactupdateemail"||errors[0].fieldId=="#contactupdatemobilenumber"){self.showContactDetails();if(errors[0].fieldId=="#contactupdateemail")
$(contactUpdateDetailsTxt).focus();else
$(mobileNumberTxt).focus();}
console.log('error.length',errors.length);console.log('Update Details: Error validation failed');let error=errors[0];errors.forEach(function(error){if($(error.fieldId).closest('div').find('.red').length==0){$(error.fieldId).after('<div class="red">'+error.msg+'</div>');}});return false;}
else{self.updating=true;let houseNumber=$('#housenumber').val(),city=$('#update-city').val(),postalCode=$('#postalcode').val(),streetName=$('#streetname').val(),suburb=$('#update-suburb').val(),addressType=$('#email').val(),floor=$('#email').val(),province=$('#update-province').val(),buildingName=$('#buildingname').val(),buildingNumber=$('#buildingnumber').val(),email=$('#contactupdateemail').val(),faxnumber=$(faxNumberTxt).val(),worknumber=$(workTelephoneTxt).val(),homenumber=$(homeTelephoneTxt).val(),number=$(mobileNumberTxt).val();let listOfPhoneNumber=[];let mobile=self.RemoveCountryCode($(mobileNumberTxt).val().trim())
let fax=self.RemoveCountryCode($(faxNumberTxt).val().trim())
let work=self.RemoveCountryCode($(workTelephoneTxt).val().trim())
let home=self.RemoveCountryCode($(homeTelephoneTxt).val().trim())
if(mobile)listOfPhoneNumber.push({phoneType:"Mobile",countryCode:dstvApp.countryCode,number:mobile});let listOfAddress=[{addressType:"physical",houseNumber:houseNumber,floor:"",streetName:streetName,buildingNumber:"",buildingName:"",subUrb:suburb,city:city,province:province,postalCode:postalCode}]
let data={email:email,listOfPhoneNumber:listOfPhoneNumber,listOfAddress:listOfAddress};if((app.generateOTP||$('#contactupdatemobilenumber').val()!=app.customercontactdetails.MobileTel)&&!dstvApp.noOTPcountry.includes(dstvApp.countryabbreviation)){app.generateOTP=true;app.updateContactwithOTP=data;self.generateOrVerifyOTP(app.generateOTP);return;}
console.log('CustomerNumber : not null');if(dstvApp.EnableSecurityAuth){let url=`${dstvApp.SecurityAuthBaseUrl}apiupdatecontactdetails/api/v1/UpdateContactDetails/UpdateCustomerProfile?country=${dstvApp.country}&BusinessUnit=${dstvApp.businessunit}&Channel=${dstvApp.channel}&customernumber=${app.customernumber}&smartcardnumber=${app.smartcard}`;site.factory.Put(url,data,null,self.onUpdateUserDetailsSuccess,self.onUpdateUserDetailsFailure,true,true);}else{let url=`${dstvApp.DSOAPIUrl}apiupdatecontactdetails/api/v1/UpdateContactDetails/UpdateCustomerProfile?country=${dstvApp.country}&BusinessUnit=${dstvApp.businessunit}&Channel=${dstvApp.channel}&customernumber=${app.customernumber}&smartcardnumber=${app.smartcard}`;site.factory.Put(url,data,self.token,self.onUpdateUserDetailsSuccess,self.onUpdateUserDetailsFailure);}}};self.onCustomerNumberNull=function(){self.log('Failed to update details');self.updating=false;self.log('Customer number not found');app.json_response="Customer number not found";$('.contact-details-section').removeClass('active');$('.update-details-section').removeClass('active');$('.main-top-Details-info').removeClass('active');self.update();if(site.env=='QA')
site.factory.CaptureFeedback('DSTVUPDATEDETAILS_'+app.customernumber);};self.onUpdateUserDetailsSuccess=function(data){console.log('Update Details: Details successfully Updated');document.body.scrollTop=0;document.documentElement.scrollTop=0;self.updating=false;$(".otp-group>input").val('');self.enableSend=false;$(".otp-screen-wrapper").hide();sessionStorage.setItem('hashToken',null);$('#updateDetailsModel').addClass('success');self.showUpdateDetailsSuccess=true;$(".update-details-inner").hide();app.customerPrimaryAddress[0].houseNumber=data.listOfAddress[0].houseNumber;app.customerPrimaryAddress[0].streetName=data.listOfAddress[0].streetName;app.customerPrimaryAddress[0].postalCode=data.listOfAddress[0].postalCode;app.customerCurrentProvinceId[0].name=data.listOfAddress[0].province;app.customerCurrentCityId[0].name=data.listOfAddress[0].city;app.customerCurrentSuburbId[0].name=data.listOfAddress[0].subUrb;app.customerPrimaryAddress[0].subUrb=data.listOfAddress[0].subUrb;app.customerPrimaryAddress[0].city=data.listOfAddress[0].city;app.customerPrimaryAddress[0].province=data.listOfAddress[0].province;app.TempCustomerPrimaryAddress[0].Province=data.listOfAddress[0].province;app.customercontactdetails.EmailAddress=data.email;app.customercontactdetails.FirstName=data.firstName;app.customercontactdetails.Surname=data.surname;app.customercontactdetails.MobileTel=$(mobileNumberTxt).val();app.customercontactdetails.FaxTel=$(faxNumberTxt).val();app.customercontactdetails.WorkTel=$(workTelephoneTxt).val();app.customercontactdetails.HomeTel=$(homeTelephoneTxt).val();window.SessionSave("app",app)
self.update();riot.update();if(!opts.airtimeUpdateDetails)
site.factory.CaptureFeedback('DSTVUPDATEDETAILS_'+app.customernumber);};self.onUpdateUserDetailsFailure=function(error){console.log('Update Details: Failed to update details');document.body.scrollTop=0;document.documentElement.scrollTop=0;self.updating=false;$(".otp-group>input").val('');self.enableSend=false
$(".otp-screen-wrapper").hide();sessionStorage.setItem('hashToken',null);self.log(error)
self.showUpdateDetailsFailure=true;self.showError=error.responseJSON.Message;let handelErrormsg="D002 - You have reached the maximum usage limit for the same email address. Please enter a new alternate email address. Application level fault has occured. Please do not re-submit this message."
if(error.responseJSON&&error.responseJSON.StatusCode==404&&error.responseJSON.Message.includes("CMProxyHelper")){self.genericError=false;}else if(error.responseJSON&&error.responseJSON.StatusCode==500&&!error.responseJSON.Message.includes(handelErrormsg)){self.genericError=true;self.showUpdateDetailsFailure=false;}
else if(error.responseJSON&&error.responseJSON.StatusCode==500&&error.responseJSON.Message.includes(handelErrormsg)){self.showError=langTranslateApp.exccedEmail;}
else if(error.responseJSON&&error.responseJSON.StatusCode==412){self.genericError=false;self.showError=langTranslateApp.exccedMobnumber;}
else{}
$('#updateDetailsModel').addClass('failure');$(".update-details-inner").hide();$('.contact-details-section').removeClass('active');$('.update-details-section').removeClass('active');$('.main-top-Details-info').removeClass('active');self.update();if(site.env=='QA'&&!opts.airtimeUpdateDetails)
site.factory.CaptureFeedback('DSTVUPDATEDETAILS_'+app.customernumber);};self.RemoveCountryCode=function(num){num=num.substr(0,3)==dstvApp.countryCode?num.substr(3):num;return num;}
self.SetFocus=function(curr){setTimeout(function(){$(curr).focus();},1000)}
self.checkIsNumeric=function(e){if(!self.IsNumeric(e.key)){e.preventDefault();return false;}}
self.IsNumeric=function(str){return $.isNumeric(str)};self.onRetry=function(){self.showUpdateDetailsFailure=false;self.genericError=false;$(".otp-group>input").val('');$(".update-details-inner").show();self.onEditIconClick();self.onContactEditIconClick();self.update();}
$('#contactupdatemobilenumber').focusout(function(){console.log('Checking : Validate OTP Required ?');if($('#contactupdatemobilenumber').val()==app.customercontactdetails.MobileTel){console.log('OTP validation not Required');app.generateOTP=false;self.update();}else{console.log('OTP validation Required');app.generateOTP=true;}});self.PerformTimer=function(){self.resendTimer=0;$(".verify-otp-btn").siblings('p').find('span').show();if(self.resendTimer==0){self.resendTimer=30;self.update();self.interval=setInterval(function(){if(self.resendTimer==0){self.enableRetry=true;$(".verify-otp-btn").siblings('p').find('span').hide();clearInterval(self.interval);}
else{self.resendTimer-=1;}
self.update()},1000)}}
self.IsValidOTP=function(e){let isNumeric=self.IsNumeric(e.key);let isEnterPress=e.which==13;let isbackpress=e.which==8;if(!isNumeric&&!isEnterPress||e.currentTarget.value){e.preventDefault();$(e.currentTarget).focus();if(!isbackpress&&!isEnterPress)return;}
e.currentTarget.removeAttribute('class')
if(isbackpress&&e.currentTarget.value){e.currentTarget.value="";}
else if(isbackpress&&!e.currentTarget.value){let nextElementSibling=e.currentTarget.previousElementSibling
setTimeout(()=>{nextElementSibling.focus()},50);}
else{if(isEnterPress){$('#verifyOtp').is(':disabled')?"":self.onVerifyOTP();return;}
let nextElementSibling=e.currentTarget.nextElementSibling
setTimeout(()=>{nextElementSibling.focus()},50);}
setTimeout(()=>{self.enableSend=$('#otpBox1').val()&&$('#otpBox2').val()&&$('#otpBox3').val()&&$('#otpBox4').val()?true:false;self.update();},500);self.update();}
self.onClickHere=function(){$(".update-details-section").hide();$(".contact-details-section").show();$('.contact_details_coloums').addClass('active');$('.address_details_coloums').removeClass('active');$(".otp-screen-wrapper").hide();$(".update-details-inner").show();$(mobileNumberTxt).focus();}
self.getEmail=function(email){let newEmail=email;let encodeEmail=newEmail.at(0)+"***";newEmail=email.split('@')[0];encodeEmail=encodeEmail+newEmail.at(newEmail.length-1)+'@'+email.split('@')[1];return encodeEmail;}
self.onRetryOTP=function(){console.log('Retry Generate OTP : Started')
$('#otpBox1').val("");$('#otpBox2').val("");$('#otpBox3').val("");$('#otpBox4').val("");self.updating=true;if(dstvApp.EnableSecurityAuth){let url=`${dstvApp.SecurityAuthBaseUrl}/apigenericotp/OTP/GenerateOTP`;let data={"ClientName":"UpdateContact","BusinessUnit":dstvApp.businessunit,"Channel":dstvApp.channel,"Country":dstvApp.country,"SmartCardNumber":app.smartcard,"CustomerNumber":app.customernumber,"PhoneNumber":{"Code":dstvApp.countryCode,"Number":app.updateContactwithOTP.listOfPhoneNumber.find(p=>p.phoneType.toLowerCase()=='mobile').number}};site.factory.Post(url,data,null,self.generateOTPSuccess,self.generateOTPError,false,false,true,true);}
self.update();}
self.onVerifyOTP=function(){let validOTP=$('#otpBox1').val()&&$('#otpBox2').val()&&$('#otpBox3').val()&&$('#otpBox4').val()?true:false;if(validOTP){console.log("OTP validation : Success");app.generateOTP=false;let opt=$('#otpBox1').val()+$('#otpBox2').val()+$('#otpBox3').val()+$('#otpBox4').val();self.generateOrVerifyOTP(app.generateOTP,Number(opt));}else{console.log("OTP validation : Error");$('.otp-group').children().each(function(i,e){e.value?e.removeAttribute('class'):e.setAttribute("class","invalidotp");});}}
self.generateOrVerifyOTP=function(isGenerateOTP,otp){self.updating=true;self.update();if(dstvApp.EnableSecurityAuth){let url=`${dstvApp.SecurityAuthBaseUrl}/apigenericotp/OTP/GenerateOTP`;let data={"ClientName":"UpdateContact","BusinessUnit":dstvApp.businessunit,"Channel":dstvApp.channel,"Country":dstvApp.country,"SmartCardNumber":app.smartcard,"CustomerNumber":app.customernumber,"PhoneNumber":{"Code":dstvApp.countryCode,"Number":app.updateContactwithOTP.listOfPhoneNumber.find(p=>p.phoneType.toLowerCase()=='mobile').number}};if(isGenerateOTP)
site.factory.Post(url,data,null,self.generateOTPSuccess,self.generateOTPError,false,false,true,true);else{url=`${dstvApp.SecurityAuthBaseUrl}/apigenericotp/OTP/VerifyOTP`;data.OTP=otp;site.factory.Post(url,data,null,self.verifyOTPSuccess,self.verifyOTPError,false,false,true,true);}}}
self.generateOTPSuccess=function(data){$("#otperror").html('');console.log('Generate OTP Success');console.log(data);self.updating=false;app.generateOTP=false;$(".otp-group>input").val('');$(".otp-screen-wrapper").show()
$(".update-details-inner").hide();self.enableRetry=false;self.enableSend=false;self.mobNoEndwith=app.updateContactwithOTP.listOfPhoneNumber.find(p=>p.phoneType.toLowerCase()=='mobile').number.slice(app.updateContactwithOTP.listOfPhoneNumber[0].number.length-3,app.updateContactwithOTP.listOfPhoneNumber[0].number.length);self.email=self.getEmail(app.updateContactwithOTP.email);document.body.scrollTop=0;document.documentElement.scrollTop=0;self.update();self.PerformTimer();}
self.generateOTPError=function(error){$("#otperror").html('');console.log('Generate OTP Fail');document.body.scrollTop=0;document.documentElement.scrollTop=0;self.updating=false;app.generateOTP=false;self.log(error)
$('#updateDetailsModel').addClass('failure');self.showUpdateDetailsFailure=true;$(".update-details-inner").hide();$('.contact-details-section').removeClass('active');$('.update-details-section').removeClass('active');$('.main-top-Details-info').removeClass('active');self.update();}
self.verifyOTPSuccess=function(data){$("#otperror").html('');console.log("Verify OTP : Success");self.updating=true;app.generateOTP=false;self.updateDetailsWithOTP();}
self.verifyOTPError=function(error){console.log("Verify OTP : Error");document.body.scrollTop=0;document.documentElement.scrollTop=0;self.updating=false;app.generateOTP=false;let errormsg=error.responseJSON.Message;if(error.status==403){errormsg=error.responseJSON.Message.includes("Invalid OTP. You have reached the max attempt count.")?langTranslateApp.otpMaxLimit:langTranslateApp.otpNotValid;}else if(error.status==404){errormsg=langTranslateApp.otpExpired;}
$("#otperror").html(errormsg);self.update();}
self.updateDetailsWithOTP=function(){console.log("updateDetailsWithOTP : Startded");let data=app.updateContactwithOTP;if(dstvApp.EnableSecurityAuth){let url=`${dstvApp.SecurityAuthBaseUrl}/apiupdatecontactdetails/api/v1/UpdateContactDetails/UpdateCustomerProfile?country=${dstvApp.country}&BusinessUnit=${dstvApp.businessunit}&Channel=${dstvApp.channel}&customernumber=${app.customernumber}&smartcardnumber=${app.smartcard}`;site.factory.Put(url,data,null,self.onUpdateUserDetailsSuccess,self.onUpdateUserDetailsFailure,true,true,true);}else{let url=`${dstvApp.DSOAPIUrl}apiupdatecontactdetails/api/v1/UpdateContactDetails/UpdateCustomerProfile?country=${dstvApp.country}&BusinessUnit=${dstvApp.businessunit}&Channel=${dstvApp.channel}&customernumber=${app.customernumber}&smartcardnumber=${app.smartcard}`;site.factory.Put(url,data,self.token,self.onUpdateUserDetailsSuccess,self.onUpdateUserDetailsFailure,true);}}})