riot.tag2('tag-buy-airtime','<div class="container" if="{showBuyAirtime}"> <div id="paymentsoverlay" class="row"> <div class="cv-spinner"> <span class="cpspinner"></span></div> </div> <div class="airtime-wrapper clearfix"> <div if="{showAirtimeSection}"> <div class="airtime-msg-wrapper clearfix"> <div class="col-sm-1 text-center"> <i class="icon icon-icon-info icon-announce mt-1"></i> </div> <div class="col-sm-11 generic-alert-text"> <p class="text"><b>Attention:</b> To complete your purchase please follow the steps that will be sent to <b>+{dstvApp.countryCode} {app.customercontactdetails.MobileTel}</b></p> <p class="text"><a href="javascript:void(0)" onclick="{goToUpdateDetails}">Click here</a> to update your contact details.</p> </div> </div> <div class="airtime-accordion-wrapper"> <p class="title">Buy Airtime</p> <p class="text">Select the<b> airtime recipient, a network provider</b> and <b>input the amount you want to recharge for</b></p> <div class="air-time"> <div class="accordion-item"> <div class="accordian-pack accordion_head" id="buyingFor"> Select / Add the recipient <b>{buyingForName}</b> <span class="plusminus">-</span> </div> <div class="accordion_body" style="display: none;"> <div class="list-info-bx"> <a class="selectedSelf" onclick="{onNumberSelection}"> <div class="list-bx clearfix"> <div class="col-md-11 col-sm-10 col-xs-10"> <p class="nameText">Myself</p> <p class="mobileNumberText">(+{dstvApp.countryCode} {app.customercontactdetails.MobileTel})</p> </div> <div class="col-md-1 col-sm-2 col-xs-2"> <div class="iconDiv"><img src="/media/11766/success-tick.svg"></div> </div> </div> </a> <a class="selectedOther hide" onclick="{onNumberSelection}"> <div class="list-bx clearfix"> <div class="col-md-11 col-sm-10 col-xs-10"> <p class="nameText">{otherName}</p> <p class="mobileNumberText">(+{dstvApp.countryCode} {otherMobileNumber})</p> </div> <div class="col-md-1 col-sm-2 col-xs-2"> <div class="iconDiv"><img src="/media/11766/success-tick.svg"></div> </div> </div> </a> <div class="list-bx-two clearfix"> <div class="airtimean"> <div class="accordion-item"> <div class="airtimean accordian-pack-two accordion_head_two"> <span class="plusminus-two pull-left">-</span> <span class="otherNumberHeader">Enter another recipient</span></b> </div> <div class="accordion_body_two" style="display: none;"> <div class="list-bx-three clearfix"> <div class="col-sm-1"> <label class="ar-txt">Name:</label> </div> <div class="col-sm-10"> <div class="airtime-edit-amount"> <div class="airtime-edit-inner-section airtime-edit-inner-section-two airtime-input-one"> <input type="text" max="15" autofocus="" autocomplete="off" class="form-control input-lg focus" id="otherName" name="name" maxlength="15" value=""/><span class="airtime-edit-payment-icon"> <img src="/media/8619/materialicon-1.svg"> </span> <div class="error-payment-msg"></div> </div> </div> </div> <div class="clearfix mb-1"> </div> <div class="col-sm-3"> <label class="ar-txt">Cell Phone No:</label> </div> <div class="col-sm-9"> <div class="airtime-edit-amount"> <div class="airtime-edit-inner-section airtime-edit-inner-section-two"> <input class="form-control input-lg focus" id="otherMobileNo" type="tel" autocomplete="off" class="form-control input-lg focus" id="otherMobileNo" name="" value="" maxlength="10" onkeypress={checkIsNumeric} /><span class="airtime-edit-payment-icon"> <img src="/media/8619/materialicon-1.svg"> </span> <div class="error-payment-msg"></div> </div> </div> </div> </div> <input type="submit" value="Proceed" class="btn text-center addno-submit" onclick="{onProceedClick}" disabled="{!recipientEntered}"> </div> </div> </div> </div> </div> </div> </div> <div class="accordion-item" if="{showNetworkAccordion}"> <div class="accordian-pack accordion_head"> Select a <b>network provider </b> below: <b>{selectedProviderName}</b> <span class="plusminus">-</span> </div> <div class="accordion_body"> <section class="airtimeslider-bx"> <section class="airtimeslider slider"> <div> <a href="javascript:void(0)" onclick="{onNetworkSelection}"> <div class="bx" name="Safaricom"><img src="/media/11649/safaricom.png"/> </div> </a> </div> </section> </section> </div> </div> </div> <div class="accordian-pack accordian-title" if="{showAmountSection}"> Enter <b>airtime amount </b> below: </div> </div> </div> <div class="airtime-amount-wrapper clearfix" if="{showAmountSection}"> <div class="col-sm-8 text-center"> <div class="data-list-input-bx"> <div class="data-list-input-bx"> <select class="data-list-input"> <option value="50">50</option> <option value="250">250</option> <option value="300">300</option> </select> <input id="airtimeEditableAmount" class="data-list-input" type="number" maxlength="15" name="" required="required" value=""> </div> </div> <div class="airtime-txt"> <p> *Minimum amount must be<b> {dstvApp.countrycurrency.toUpperCase()} {minAmount}</b> and maximum<b> {dstvApp.countrycurrency.toUpperCase()} {maxAmount}</b></p> <p><b>Please press "Proceed" & check your phone to continue the purchase.</b></p> <div class="clearfix"></div> </div> </div> <div class="col-sm-4 text-center"> <input type="submit" value="Proceed" class="btn btn-airtime-enable text-center mt-2 mb-2" disabled="{!amountValidated}" onclick="{onShowCostSummary}"> </div> </div> <div id="payment-main-section" class="content-wrapper " if="{showCostSummary}"> <div class="main-top-payment-info"> <button type="button" class="payment-close">X</button> <div id="paymentPage"> <section class="payment-section clearfix"> <div class="package-payment-box"> <div class="cost-bx"> <div class="cost-title">Cost Summary: <span>Top up Airtime</span></div> <div class="cost-txt">Buying For: <a>{selectedBuyingFor}</a></div> </div> <div class="total-amount-pay"> <div class="pay-text">Total amount to pay</div> </div> <div class="edit-amount"> <div class="edit-iner-section"> <span class="countryCode">{dstvApp.countrycurrency.toUpperCase()}</span> <input type="text" autofocus="" autocomplete="off" class="form-control input-lg focus" id="editableAmount" name="signIn_smartCardNumber" maxlength="10" value="{airtimeAmount}"> <span class="edit-payment-icon"> <img src="/media/8619/materialicon-1.svg"> </span> <div class="error-payment-msg"></div> </div> </div> </div> <div class="clearfix"> </div> </section> <section> <!-- Pay Accordion UI Start --> <div class="pay-content-wrapper"> <div class="airtime-pay-wrapper"> <div class="airtime-pay-wrapper-in"> <div class="title">**You are about to make a <b>payment</b>.</br> <b>Please follow</b> the <b>prompts on your phone</b> to complete your payment.</div> <div class="text-center pay-btn-wrapper"><button type="button" class="btn btn-paynow text-uppercase" onclick="{onInitiateUssdPayment}">Continue</button></div> </div> </div> </div> </section> </div> </div> <div class="clearfix"></div> <div class="clearfix"></div> </div> </div> <div class="content-wrapper responseWrapper pay airtime-msg-bx airtime-notice " id="payment-main-section" if="{showNoticeSection}"> <div class="payment-cards-config"> <button type="button" class="payment-close" onclick="{goHome}">X</button> <div class="payment-main-sections pending info"> <div class="icon-img-common"></div> </div> <div class="response-end info"> <h5 if="{!paymentInitSuccess}" class="payment-heading">IMPORTANT NOTICE</h5> <hr class="status-pay"> <div class="AwarenessInfoArea pending 1 " style="padding:0 !important;"> <span if="{!paymentInitSuccess}" class="awareness-top-text">To proceed with the purchase you need to have your<b> phone next to you</b> to access the<b> M-PESA STK Pop-up/USSD</b> dial string.</span></div> </div> </div> <div class="awareness-sub-text-main response-end info"><span class="awareness-sub-text"> Supported network providers â€“ Safaricom.</span> <button if="{!paymentInitSuccess}" class="awareness-activate-btn" id="Cancel" onClick="{initiateBuyAirtime}" style="margin-right: 15px;"><span class="anim-span"></span><span>Continue</span><span class="arrowNow" style="color:#fff;"></span></button> </div> </div></div>','tag-buy-airtime,[riot-tag="tag-buy-airtime"],[data-is="tag-buy-airtime"]{ visibility: visible; display: block; }','',function(opts){var self=this;self.token='';self.loading=true;self.showNoticeSection=false;self.buyingForName='';self.selectedProvider='';self.airtimeAmount=0;self.buyingForMobileNumber=0;self.minAmount=10;self.maxAmount=9999;self.amountValidated=false;self.recipientEntered=false;self.on('mount',function(){if(self.opts.showComponent){console.log('Buy Airtime : In Mount...');site.factory.GetJWT().then(function(token){self.token=token;if(!opts.showNotice){self.initiateBuyAirtime();}else{self.showNotice();}
self.update();});}
$('#otherMobileNo').on('change keyup',function(){var sanitized=$(this).val().replace(/[^0-9]/g,'');$(this).val(sanitized);});$('#otherMobileNo').keyup(function(){$('#otherMobileNo').next(".red").remove();});});self.checkIsNumeric=function(e){if(!self.IsNumeric(e.key)){e.preventDefault();return false;}
else{self.validateInputs();}}
self.IsNumeric=function(str){return $.isNumeric(str)};self.validateAll=function(){let errors=[],mobiNumeber=$('#otherMobileNo').val();errors=validateMobiHomeWorkNumber(mobiNumeber,dstvApp.countryCode,errors,true);return errors;}
function validateMobiHomeWorkNumber(number,countryCode,errors,isMobiNumber){var fieldIdTxt='';fieldIdTxt=isMobiNumber?'#otherMobileNo':'';if(number.length<7||number.length>10){errors.push({msg:langTranslateApp.updateInvalidMobileWorkHomeNumberLength,error:true,fieldId:fieldIdTxt,});return errors;}else{if(isMobiNumber){var numberType=isMobileNumber(number,countryCode,isMobiNumber);if(!numberType.includes("Mobile")){errors.push({msg:langTranslateApp.updateInvalidMobile,error:true,fieldId:fieldIdTxt,});return errors;}
return errors;}}
return errors;}
function isMobileNumber(number,countryCode,isMobiNumber){var phoneUtil=i18n.phonenumbers.PhoneNumberUtil.getInstance();var regionCode=phoneUtil.getRegionCodeForCountryCode(countryCode);var phNumber=phoneUtil.parseAndKeepRawInput(number,regionCode);if(phoneUtil.isValidNumber(phNumber)){var PNT=i18n.phonenumbers.PhoneNumberType;var numberType=phoneUtil.getNumberType(phNumber);if(numberType==PNT.MOBILE){return "Mobile";}else if(numberType==PNT.FIXED_LINE){return "Number is Fixed Line."}else if(numberType==PNT.FIXED_LINE_OR_MOBILE){return "Number is Fixed Line or Mobile";}else if(numberType==PNT.UNKNOWN){return "Unknown Number. Please enter valid number.";}else{return langTranslateApp.updateInvalidMobile;}}else{if(isMobiNumber){return langTranslateApp.updateInvalidMobile;}
$('#otherMobileNo').focus();}}
self.collapseAll=function(){$(".accordion_body").slideUp();$(".accordion_body_two").slideUp();$(".plusminus").text('+');}
self.showNotice=function(){self.showCostSummary=false;self.showBuyAirtime=true;self.showNoticeSection=true;$('tag-more-service').hide();self.update();$("#paymentsoverlay").fadeOut(300);}
self.initiateBuyAirtime=function(){$('tag-more-service').hide();$('html, body').animate({scrollTop:20},1000);self.showNetworkAccordion=false;self.showAmountSection=false;self.showNoticeSection=false;self.showBuyAirtime=true;self.showAirtimeSection=true;self.update();self.collapseAll();self.setAccordionClickEvents();self.preExpandAccordion();$('.iconDiv').hide();self.validateNameAndNumber();document.body.scrollTop=0;document.documentElement.scrollTop=0;}
self.validateNameAndNumber=function(){self.validateInputs();$('#otherName').keyup(function(e){self.validateInputs();});$('#otherMobileNo').keyup(function(e){$('#otherMobileNo').next(".validationErrMsg").remove();self.validateInputs();});}
self.validateInputs=function(){let toValidateName=$('#otherName');let toValidateNo=$('#otherMobileNo');let enteredName=toValidateName.val();let enteredNumber=toValidateNo.val();let empty=enteredName==''||enteredNumber=='';if(!empty)
self.recipientEntered=true;else
self.recipientEntered=false;self.update();}
self.validateAmount=function(){let validAmount=false;$('#airtimeEditableAmount').keyup(function(){self.validateInputAmount();});}
self.validateInputAmount=function(){let toValidateAmount=$('#airtimeEditableAmount'),validAmount=false;let enteredAmount=toValidateAmount.val();if(enteredAmount.length>2){toValidateAmount.data('validAmount',true);}else{toValidateAmount.data('validAmount',false);}
let empty=toValidateAmount.val()=='';if(!empty&&enteredAmount>=self.minAmount&&enteredAmount<=self.maxAmount)
self.amountValidated=true;else
self.amountValidated=false;self.update();}
self.onNumberSelection=function(e){console.log('Buy airtime: Selected myself to buy airtime');self.collapseAll();self.selectedBuyingFor=$(e.currentTarget).find('.nameText')[0].innerText;self.buyingForName='('+self.selectedBuyingFor+')';self.buyingForMobileNumber=$(e.currentTarget).find('.mobileNumberText')[0].innerText;self.buyingForMobileNumber=(self.buyingForMobileNumber).replace(/[(+\s)]/g,'');$('.iconDiv').hide();let selectedElement=e.currentTarget.querySelectorAll(".iconDiv")[0];selectedElement.style.display='block';self.enableNetworkAccordion();self.update();self.setAccordionClickEvents();}
self.enableNetworkAccordion=function(){self.showNetworkAccordion=true;}
self.setAccordionClickEvents=function(){$(".air-time .accordion_head").unbind('click');$(".airtimean .accordion_head_two").unbind('click');$(".plusminus-two").text('+');$(".air-time .accordion_head").click(function(){if($('.accordion_body').is(':visible')){$(".accordion_body").slideUp(300);$(".plusminus").text('+');}
if($(this).next(".accordion_body").is(':visible')){$(this).next(".accordion_body").slideUp(300);$(this).children(".plusminus").text('+');}
else{$(this).next(".accordion_body").slideDown(300);$(this).children(".plusminus").text('-');}});$(".airtimean .accordion_head_two").click(function(){if($('.accordion_body_two').is(':visible')){$(".accordion_body_two").slideUp(300);$(".plusminus-two").text('+');}
if($(this).next(".accordion_body_two").is(':visible')){$(this).next(".accordion_body_two").slideUp(300);$(this).children(".plusminus-two").text('+');}else{$(this).next(".accordion_body_two").slideDown(300);$(this).children(".plusminus-two").text('-');}});$(".accordion_head_two").click(function(){$('html, body').animate({scrollTop:$(".airtime-accordion-wrapper").offset().top},300);});$(".airtimeslider").slick({dots:false,arrows:false,prevArrow:'<button class="slick-prev"><div class="icon-ico-arrow-next"></div></button>',nextArrow:'<button class="slick-next"><div class="icon-ico-arrow-next"></div></button>',infinite:false,slidesToShow:5,slidesToScroll:1,focusOnSelect:true,centerMode:false,responsive:[{breakpoint:1480,settings:{slidesToShow:5,}},{breakpoint:1280,settings:{slidesToShow:5,}},{breakpoint:1024,settings:{slidesToShow:5,}},{breakpoint:600,settings:{slidesToShow:3,}},{breakpoint:480,settings:{slidesToShow:3,}},{breakpoint:320,settings:{slidesToShow:3,}}]});}
self.preExpandAccordion=function(){$(".air-time .accordion_head").click();}
self.onProceedClick=function(){let errors=self.validateAll();if(errors.length!=0){if(errors[0].fieldId=="#otherMobileNo"){$('#otherMobileNo').focus();}
let error=errors[0];errors.forEach(function(error){if($(error.fieldId).closest('div').find('.validationErrMsg').length==0){$(error.fieldId).after('<div class="validationErrMsg">'+error.msg+'</div>');}});return false;}
self.selectedBuyingFor=self.otherName=$('#otherName').val();self.otherMobileNumber=$('#otherMobileNo').val();self.buyingForMobileNumber=dstvApp.countryCode+self.otherMobileNumber;$('.selectedOther').removeClass('hide');self.buyingForName='('+self.otherName+')';$('.iconDiv').hide();$('.selectedOther').find('.iconDiv')[0].style.display='block';if(!self.otherName.trim()=='')
$('.otherNumberHeader')[0].innerText='Edit number';self.enableNetworkAccordion();self.collapseAll();self.update();self.setAccordionClickEvents();}
self.onNetworkSelection=function(e){console.log('Buy Airtime: On netwrok provider selection');let selectedElement=$(e.currentTarget).find('.bx');selectedElement.css('background-color','#FFCC00');self.selectedProvider=selectedElement[0].getAttribute('name');self.selectedProviderName='('+self.selectedProvider+')';self.showAmountSection=true;self.collapseAll();self.update();self.setAmountDropdown();self.validateAmount();}
self.setAmountDropdown=function(){jcf.replaceAll();$('select.data-list-input').focus(function(){$(this).siblings('input.data-list-input').focus();});$('select.data-list-input').change(function(){$(this).siblings('input.data-list-input').val($(this).val());self.validateInputAmount();});$('input.data-list-input').change(function(){$(this).siblings('select.data-list-input').val('');});}
self.onShowCostSummary=function(){self.airtimeAmount=$('#airtimeEditableAmount')[0].value;self.showAirtimeSection=false;window.HandleActiveTab("showPayment");riot.mount('tag-dashboard-payments',{airtimePayment:true,amount:self.airtimeAmount,buyingAirtimeForMobNo:self.buyingForMobileNumber,buyingAirtimeForName:self.selectedBuyingFor});}
self.goToUpdateDetails=function(){window.HandleActiveTab("showMore");riot.mount('tag-update-user-details',{showComponent:true,airtimeUpdateDetails:true});}
self.goHome=function(){window.HandleActiveTab("showAccount");}});