riot.tag2('tag-dash-boxoffice','<div if="{showBoxoffice && !showMore}"><div if="{showBoxofficeRentNow}" class="content-wrapper box-office-wrapper text-center"> <button type="button" class="payment-close" onclick="{backbox}">X</button><div if="{isBoxOfficeCustomer && state == \'renting\'}" class="box-office-inner"><div class="mb-2"> <img src="/media/11148/boxoffice-logo.png" alt="Box Office Logo"></div><p> <b>{langTranslateApp.dashboxofficeScanQrCode}</b> {langTranslateApp.dashboxofficeYourTvscreen} <b>{langTranslateApp.dashboxofficeMobileDevice}</b> {langTranslateApp.dashboxofficeForPVRental}</p><div class="or-divider green-text">{langTranslateApp.dashboxofficeOr}</div><p> <b>{langTranslateApp.dashboxofficeEnterRentalCode}</b> {langTranslateApp.dashboxofficeShownonYou} <b>{langTranslateApp.dashboxofficeTVScreen}</b> {langTranslateApp.dashboxofficeFor} <b>{langTranslateApp.dashboxofficePVRental}</b>.</p><div class="rental-code-input"> <input type="text" class="form-control input-lg focus " id="txtPVRCode" name="rental-code-field" placeholder="Enter rental code here"></div><div class="text-center boxoffice-btn-wrapper"> <button type="button" class="btn btn-green-invert" onclick="{onCancel}">{langTranslateApp.updateCancel}</button> <button type="button" class="btn btn-green" onclick="{onRentNow}">{langTranslateApp.fbkFrmSubmit}</button> </div></div><div if="{isBoxOfficeCustomer && state == \'processing\'}" class="rentnow-loading"><div class="loading-loader loading"><div class="col-sm-12 text-center white"><div class="spinner white"></div><div class="loading-message">{langTranslateApp.dashProcessing}</div></div></div></div><div if="{isBoxOfficeCustomer && state == \'notopup\'}"><div class="mb-2"> <img src="/media/11148/boxoffice-logo.png" alt="Box Office Logo"></div><h2 style="text-transform: none; margin-bottom: 10px !important;">{langTranslateApp.dashNoFundsMessage1}</h2> <br><p style="opacity: unset;">{langTranslateApp.transHistoryPlease} <b>{langTranslateApp.dashBoxOfficeTop}</b> {langTranslateApp.dashboxofficeHottestMoviesDesc}</p><div class="row" style="margin-top: 10px;"><div> <a id="newRentBtn" href="javascript:void(0)" class="btn btn-green" onclick={showTopup}>{langTranslateApp.dashBoxOfficeTopUp} <span class="icon icon-BoxOffice"></span> </a></div></div></div><div if="{isBoxOfficeCustomer && state == \'error\'}"><div class="box-office-inner"><div class="bo-fail-heading"> <img src="/media/11148/boxoffice-logo.png" alt="Box Office Logo" /> <br><h1>{langTranslateApp.dashOhno}</h1><h5>{langTranslateApp.dashRentNowErrorMessage1}</h5><p>{langTranslateApp.dashRentNowErrorMessage2}</p></div><div class="text-center boxoffice-btn-wrapper"> <button type="button" class="btn btn-green" onclick={showRentForm}>{langTranslateApp.dashTryNewCode}</button></div></div></div><div if="{isBoxOfficeCustomer && state == \'errorFromBO\'}"><div class="box-office-inner"><div class="box-office-error"><div class="bo-success-heading"> <img src="/media/11148/boxoffice-logo.png" alt="Box Office Logo" /><h1>{langTranslateApp.dashOhno}</h1></div><p class="success-txt"></p><p>{errorMSG}</p><div class="text-center boxoffice-btn-wrapper"> <button type="button" class="btn btn-green" onclick={showRentForm}>{langTranslateApp.dashTryNewCode}</button></div></div></div></div><div if="{isBoxOfficeCustomer && state == \'success\'}"><div class="box-office-inner"><div class="box-office-success"><div class="bo-success-heading"> <img src="/media/11148/boxoffice-logo.png" alt="Box Office Logo" /><h1>{langTranslateApp.dashRentNowSuccessMessage0}</h1></div><h5>{langTranslateApp.dashboxofficeYourTvandEnjoyMovie}</h5><p class="success-txt">{langTranslateApp.dashRentNowSuccessMessage1}</p><p>{langTranslateApp.dashboxofficeNewRentalCodeVia} <a href="http://bo.dstv.com/" target="_blank">http://bo.dstv.com</a> {langTranslateApp.dashboxofficeWontChangeAgainDesc}</p><div class="text-center boxoffice-btn-wrapper"> <button type="button" class="btn btn-green" onclick={onCancel}>Close</button></div></div></div></div><div if="{!isBoxOfficeCustomer}" class="boxoffice-wc"><div class="mb-2"> <img src="/media/11148/boxoffice-logo.png" alt="Box Office Logo"></div><div><h2 class="bo-welcome-heading">{langTranslateApp.boxOfficeWelcome}</h2><div> <img src="/media/11255/box-office-welcom.png" alt="Box Office Logo"></div><h2 class="bo-welcome-heading">{langTranslateApp.boxOffice1st} <span style="color: #1dbd1d;font-weight: 600;">{langTranslateApp.boxOfficeMoviefree}</span></h2> <a class="btn btn-green" target="_blank" href="http://bo.dstv.com/">{langTranslateApp.paymentsContinue}</a></div></div></div><div if="{showBoxofficeTopup}" class="content-wrapper box-office-wrapper text-center"> <button type="button" class="payment-close" onclick="{backbox}">X</button><div if="{state == \'loadingTopup\'}" class="rentnow-loading"><div class="loading-loader loading"><div class="col-sm-12 text-center white"><div class="spinner white"></div><div class="loading-message">{langTranslateApp.dashboxofficeLoadingTopUP}</div></div></div></div><div if="{state == \'topup\'}" class="box-office-inner"><h1 class="text-uppercase green-text">{langTranslateApp.dashboxofficeInsufficientFunds}</h1><p> <b>{langTranslateApp.dashBoxOfficeTop}</b> {langTranslateApp.dashboxofficeNow} <b>{langTranslateApp.dashboxofficeToProceed}</b> {langTranslateApp.dashboxofficeWithYour} <b>{langTranslateApp.dashboxofficerental}</b></p><div class="amount-options"><p>{langTranslateApp.dashSelectAmountBelow}</p><div class="amount-wrapper text-center"><div class="movieItem text-uppercase"> <label for="one-movie" if="{!app.dualCurrencyApplicable}"><div> <b>{dstvApp.countrycurrency.toUpperCase()+" "+app.topUpAmountList[0]}</b></div> <input class="amount-input" name="boxoffice-movie" type="radio" id="one-movie" value="one movie" amount="{app.topUpAmountList[0]}" onchange="{onSelectAmount}" /> </label> <label for="one-movie" if="{app.dualCurrencyApplicable}"><div> <b>{dstvApp.countrycurrency.toUpperCase()+" "+app.topUpAmountListEtb[0]}</b></div> <input class="amount-input" name="boxoffice-movie" type="radio" id="one-movie" value="one movie" amount="{app.topUpAmountList[0]}" onchange="{onSelectAmount}" /> </label></div><div class="movieItem text-uppercase"> <label for="two-movie" if="{!app.dualCurrencyApplicable}"><div> <b>{dstvApp.countrycurrency.toUpperCase()+" "+app.topUpAmountList[1]}</b></div> <input class="amount-input" name="boxoffice-movie" type="radio" id="two-movie" value="two movie" amount="{app.topUpAmountList[1]}" onchange="{onSelectAmount}" /> </label> <label for="two-movie" if="{app.dualCurrencyApplicable}"><div> <b>{dstvApp.countrycurrency.toUpperCase()+" "+app.topUpAmountListEtb[1]}</b></div> <input class="amount-input" name="boxoffice-movie" type="radio" id="two-movie" value="two movie" amount="{app.topUpAmountList[1]}" onchange="{onSelectAmount}" /> </label></div><div class="movieItem text-uppercase"> <label for="three-movie" if="{!app.dualCurrencyApplicable}"><div> <b>{dstvApp.countrycurrency.toUpperCase()+" "+app.topUpAmountList[2]}</b></div> <input class="amount-input" name="boxoffice-movie" type="radio" id="three-movie" value="three movie" amount="{app.topUpAmountList[2]}" onchange="{onSelectAmount}" /> </label> <label for="three-movie" if="{app.dualCurrencyApplicable}"><div> <b>{dstvApp.countrycurrency.toUpperCase()+" "+app.topUpAmountListEtb[2]}</b></div> <input class="amount-input" name="boxoffice-movie" type="radio" id="three-movie" value="three movie" amount="{app.topUpAmountList[2]}" onchange="{onSelectAmount}" /> </label></div><div class="movieItem text-uppercase"> <label for="four-movie" if="{!app.dualCurrencyApplicable}"><div> <b>{dstvApp.countrycurrency.toUpperCase()+" "+app.topUpAmountList[3]}</b></div> <input class="amount-input" name="boxoffice-movie" type="radio" id="four-movie" value="four movie" amount="{app.topUpAmountList[3]}" onchange="{onSelectAmount}" /> </label> <label for="four-movie" if="{app.dualCurrencyApplicable}"><div> <b>{dstvApp.countrycurrency.toUpperCase()+" "+app.topUpAmountListEtb[3]}</b></div> <input class="amount-input" name="boxoffice-movie" type="radio" id="four-movie" value="four movie" amount="{app.topUpAmountList[3]}" onchange="{onSelectAmount}" /> </label></div><div class="clearfix"></div></div></div><div class="text-center boxoffice-btn-wrapper"> <button type="button" class="btn btn-green-invert" onclick="{onCancel}">{langTranslateApp.updateCancel}</button> <button type="button" class="btn btn-green" onclick="{processTopup}">{langTranslateApp.dashBoxOfficeTop}</button> </div></div></div></div>','tag-dash-boxoffice,[riot-tag="tag-dash-boxoffice"],[data-is="tag-dash-boxoffice"]{ visibility: visible; } tag-dash-boxoffice select,[riot-tag="tag-dash-boxoffice"] select,[data-is="tag-dash-boxoffice"] select{ display: none !important; }','',function(opts){var self=this;self.state='processing';self.isBoxOfficeCustomer=app.IsBOCustomer;self.showBoxoffice=true;self.on('mount',function(){if(opts.showComponent){self.showBoxofficeRentNow=true;$('tag-more-service').hide();if(opts.state&&opts.state=='topup'){self.showTopup();return;}
if(!opts.state&&self.isBoxOfficeCustomer){self.CreateToken();}
self.update();jcf.replaceAll();self.setFocus();$('#txtPVRCode').on("keypress",function(e){if(e.keyCode==13){self.onRentNow();}});}
else{self.showBoxoffice=false;}})
self.on('updated',function(){self.setFocus();})
self.backbox=function(){window.HandleActiveTab('showAccount')}
self.CreateToken=function(){site.factory.GetJWT().then(function(token){self.token=token;self.GetMoviesAndPrices();self.update();})}
self.setFocus=function(){setTimeout(function(){$('#txtPVRCode').focus();},1000);}
self.showTopup=function(){self.showBoxofficeRentNow=false;self.showBoxofficeTopup=true;self.FetchTopUpAmountList();self.update();}
self.processTopup=function(){if(self.selectedAmount){app.boPayment=true;window.dataLayer=window.dataLayer||[];window.dataLayer.push({event:'eec.addToCart',ecommerce:{add:{products:[{id:self.selectedMovieId,name:self.selectedProductName,price:self.selectedAmount.toString(),brand:'DStv',category:'DP Box-office rentals',variant:'',quantity:1}]}}});window.HandleActiveTab("showPayment");app.boPayment=false;riot.mount('tag-dashboard-payments',{boxOfficePayment:true,amount:self.selectedAmount,id:self.selectedMovieId,productName:self.selectedProductName});}}
self.onSelectAmount=function(e){self.selectedAmount=parseFloat(e.currentTarget.getAttribute('amount'))
self.selectedMovieId=e.currentTarget.id;self.selectedProductName="boxoffice-"+e.currentTarget.id;window.dataLayer=window.dataLayer||[];window.dataLayer.push({event:'eec.productClickPaynow',ecommerce:{click:{actionField:{list:'Self Service'},products:[{id:e.currentTarget.id,name:e.currentTarget.name,price:self.selectedAmount.toString(),brand:'DStv',category:'DP Box-office rentals',variant:'',position:'',}]}}});}
self.showRentForm=function(){self.state='renting';self.setFocus();}
self.onRentNow=function(){if(!app.customercontactdetails.MobileTel){site.factory.ShowModelPopupWithCustomButtonText('error','Oops!!','Cell number not linked','We didn\'t find cell number to link this account \n Please add cell number to your account ',false,null,true,'Add Cell Number',self.linkCellNumber);return;}
else{let code=$('#txtPVRCode').val().trim();if(!code){$('#txtPVRCode').focus();return;}
self.state='processing';let data={country:dstvApp.country,businessUnit:dstvApp.businessunit,channel:dstvApp.channel,mobileNumber:dstvApp.countryCode+app.customercontactdetails.MobileTel,rentalCode:code}
if(dstvApp.EnableSecurityAuth){let url=`${dstvApp.SecurityAuthBaseUrl}/apiboxoffice/api/v1/BoxOffice/RentAMovie`;site.factory.Post(url,data,null,self.onRentSuccess,self.onRentError,false,false,true,true);}else{let url=`${dstvApp.DSOAPIUrl}/apiboxoffice/api/v1/BoxOffice/RentAMovie`;site.factory.Post(url,data,self.token,self.onRentSuccess,self.onRentError);}}}
self.onRentSuccess=function(data){if(data&&!data.successfulRental){self.errorMSG=data.responseMessage;self.state='errorFromBO';self.update();return;}
self.state='success';let movieName='';if(data&&data.title)
movieName=data.title
langTranslateApp.dashRentNowSuccessMessage1=langTranslateApp.dashRentNowSuccessMessage1.replace('[MOVIENAME]',movieName)
site.factory.CaptureFeedback('DSTVBOXOFFICERENT_'+app.customernumber);self.update();}
self.onRentError=function(error){try{if(error.status==400)
self.errorMSG=error.responseJSON.Message}
catch(e){self.errorMSG='Something went wrong while processing your request. \n Please try again.'}
self.state='error';self.update();}
self.GetMoviesAndPrices=function(){console.log('Boxoffice : Pulling latest movies and prices...')
if(app.BOMoviePricing){console.log('Boxoffice : Data already loaded.')
self.checkBoxofficeAccount();return;}
if(dstvApp.EnableSecurityAuth){let url=`${dstvApp.SecurityAuthBaseUrl}apiboxoffice/api/v1/BoxOffice/GetTrailersAndUpcomingMovies?Country=${dstvApp.country}&BusinessUnit=${dstvApp.businessunit}&Channel=${dstvApp.channel}`;site.factory.Get(url,null,self.onGetMoviesSuccess,self.onGetMoviesError,false,false,true)}else{let url=`${dstvApp.DSOAPIUrl}apiboxoffice/api/v1/BoxOffice/GetTrailersAndUpcomingMovies?Country=${dstvApp.country}&BusinessUnit=${dstvApp.businessunit}&Channel=${dstvApp.channel}`;site.factory.Get(url,self.token,self.onGetMoviesSuccess,self.onGetMoviesError)}}
self.onGetMoviesSuccess=function(data){console.log('Boxoffice : Pulling latest movies and prices completed')
if(data.movies&&data.movies.length>0){app.BOMoviePricing=data.movies[0].price[0].pricing;self.checkBoxofficeAccount();}
self.update();}
self.onGetMoviesError=function(error){console.log('Boxoffice : Error in pulling latest movies',error);self.update();}
self.checkBoxofficeAccount=function(){console.log('Boxoffice : Checking boxoffice acount balance')
let boAccountBal=app.BOAccount.AccountBalance.Value*-1;if(boAccountBal<app.BOMoviePricing){console.log('Boxoffice : Insufficient balance')
self.state='notopup';}
else{self.state='renting'
console.log('Boxoffice : Sufficient balance')}
self.update();}
self.startBoxOfficeTokenCreation=function(){console.log('Box office: Loading top up amount started')
if(app.topUpAmountList&&app.topUpAmountList.length>0){console.log('Box office: amount already loaded')
self.state='topup'
self.update();}
else{self.state='loadingTopup'
var model={username:app.customerDetails.PersonalDetail.Surname,"smartCardNumber":app.smartcard,"country":dstvApp.country,"businessUnit":dstvApp.businessunit,"deviceId":"","platform":"web","version":""}
site.trigger("postuserdata",dstvApp.EazyMobileAPIURL+'v3/SignIn',"POST",model,self.onTokenCreationSucsess,self.onTokenCreationError);}}
self.onTokenCreationSucsess=function(data,e){if(data&&data.statusCode==200){console.log('Box office: Mobile wrapper token created')
data=data.data;let isBoxOfficeCustomer=data.boxOfficeAccount!=null||data.boxOfficeAccount!=undefined;self.isBoxOfficeCustomer=isBoxOfficeCustomer;site.factory.CaptureUserTokenAndType(app.customernumber,'surname',dstvApp.country,data.token,isBoxOfficeCustomer,data.boxOfficeAccount);self.FetchTopUpAmountList();}
else{self.onTokenCreationError(data);}}
self.onTokenCreationError=function(err){console.log('User token creation failed.');}
self.FetchTopUpAmountList=function(){console.log('Boxoffice : Topup amount list loading...')
if(!(app.topUpAmountList&&app.topUpAmountList.length>0)){let getTopupAmountURL=dstvApp.EazyMobileAPIURL+`v1/BoxOffice/${dstvApp.country}/GetAmountValues`;let settings={async:true,crossDomain:true,url:getTopupAmountURL,method:"GET"}
$.ajax(settings).done(function(response){response?self.OnTopupLoaded(response):self.OnTopupLoadedError();});}
else{console.log('Topup amount already loaded.')
var boImpressionArr=[];for(var i=0;i<app.topUpAmountList.length;i++){var impression={};if(i==0){impression["id"]='one-movie'
impression["name"]='boxoffice-one-movie'}else if(i==1){impression["id"]='two-movie'
impression["name"]='boxoffice-two-movie'}else if(i==2){impression["id"]='three-movie'
impression["name"]='boxoffice-three-movie'}else if(i==3){impression["id"]='four-movie'
impression["name"]='boxoffice-four-movie'}else{}
impression["category"]="DP Box-office rentals";impression["list"]="Self Service";boImpressionArr.push(impression);}
window.dataLayer=window.dataLayer||[];window.dataLayer.push({event:'eec.productImpressionGetnow',ecommerce:{impressions:boImpressionArr}});self.state='topup'
self.update();}}
self.OnTopupLoaded=function(data){if(app.dualCurrencyApplicable){app.topUpAmountList=data.topUpAmountList;app.topUpAmountListEtb=[];for(var i=0;i<app.topUpAmountList.length;i++){app.topUpAmountListEtb.push(Math.round(parseFloat(app.topUpAmountList[i]/dstvApp.DualCurrencyConversionRate)));}}else{app.topUpAmountList=data.topUpAmountList;}
var boImpressionArr=[];for(var i=0;i<app.topUpAmountList.length;i++){var impression={};if(i==0){impression["id"]='one-movie'
impression["name"]='boxoffice-one-movie'}else if(i==1){impression["id"]='two-movie'
impression["name"]='boxoffice-two-movie'}else if(i==2){impression["id"]='three-movie'
impression["name"]='boxoffice-three-movie'}else if(i==3){impression["id"]='four-movie'
impression["name"]='boxoffice-four-movie'}else{}
impression["category"]="DP Box-office rentals";impression["list"]="Self Service";boImpressionArr.push(impression);}
window.dataLayer=window.dataLayer||[];window.dataLayer.push({event:'eec.productImpressionGetnow',ecommerce:{impressions:boImpressionArr}});self.state='topup'
window.SessionSave("app",app);riot.update();console.log('Topup amount list loaded');}
self.onCancel=function(){self.showBoxoffice=false;$('html, body').animate({scrollTop:20},1000);opts.showComponent=false;$('tag-more-service').show();}});