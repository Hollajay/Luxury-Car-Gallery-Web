riot.tag2('tag-dashboard-payments','<div class="full-view-ss"> <div class="content-wrapper {paymentStatus.fullviewclass} pay dvs-pay" id="payment-main-section" if="{!showRecurringScreen && !showTerminatedBouquetScreen && !showAwarenessMsg && !showAirtimePayScreen}"> <div class="payment-cards-config 1"> <div class="main-top-payment-info"> <button type="button" class="payment-close icon-Close_M" onclick="{backpayment}"></button> <div id="paymentPage"> <section class="payment-section clearfix"> <div class="package-payment-box"> <div class="total-amount-pay"> <div class="pay-text">{langTranslateApp.totalAmountToPay}</div> </div> <div class="edit-amount"> <div class="edit-iner-section"> <span class="countryCode">{dstvApp.countrycurrency.toUpperCase()}</span> <input type="text" autofocus autocomplete="off" class="form-control input-lg focus" id="editableAmount" name="signIn_smartCardNumber" maxlength="10" value={AmountToPay()}> <span class="edit-payment-icon"> <img src="/media/8619/materialicon-1.svg"> </span> <div class="error-payment-msg"><span if="{showErrorMsg}" style="color: red;">{errorMsg}</span></div> </div> </div> <div class="due-date"> <div class="due-date-txt">{langTranslateApp.accDueBy} - <span class="blue-txt">{site.factory.GetEazyDateFormat(app.paymentduedetails.properties.dueDate.value)}</span> </div> <div class="viewing-days-left">{langTranslateApp.accViewingdays} - <span class="blue-txt">{app.viewingDaysLeft} {langTranslateApp.balDays}</span> </div> <div class="clearfix"></div> </div> <div class="text-center pay-btn-wrapper"><button type="button" onclick="{OnPayNow}" class="btn btn-paynow text-uppercase">{paymentButtonCaption}</button></div> </div> </section> <section> <!-- Pay Accordion UI Start --> <div class="pay-content-wrapper"> <div class="pay-accordion-main Change-package-section-main clearfix"> <div class="pay-accordion-wrapper package-change-bottom-section"> <div class="accordion-item" if="{!app.dualCurrencyApplicable}"> <div class="accordian-pack accordion_head paysummary"> <span class="plusminus">+</span> <h2 class="acc-left"><b>{langTranslateApp.dashPayment}</b> {langTranslateApp.dashPaySummary}</h2> </div> <div class="accordion_body" style="display: none;"> <div if="{!opts.showmaxPayment}" class="Pay-summary"> <div class="Payment-showmax"> <div class="payment-summary-main"> <div class="Payment-summary-title"> <div class="overflow-quotes"> <div class="clearfix"></div> <div each="{quotes, index in app.qouteLineItems.Quotes}" style="margin-bottom: 10px;"> <div class="quotes" style="padding-bottom: 5px;font-size: 16px; font-weight: 300;" if="{quotes.Id}"> <span>{langTranslateApp.paymentSummaryQoute}</span> <span class="quote-number">{quotes.Id}</span></div> <div class="quotes-details"> <div each="{lineItem, index in quotes.LineItems}" class="hover"> <span class="Payment-heading-info main">{getNewPackageName(lineItem.InvoiceText)} </span> <span class="tooltips" style="text-align:left">{getFormattedDate(lineItem.StartDate)} - {getFormattedDate(lineItem.EndDate)}</span> <span class="holder-name title" if="{!app.isMauritius}">{lineItem.Amount.CurrencyCode+" "+lineItem.Amount.Value}</span><span class="holder-name title" if="{app.isMauritius}">{lineItem.Amount.LocalPrice.Currency+" "+lineItem.Amount.LocalPrice.Amount}</span> </div> </div> <div class="clearfix"></div> </div> <div class="clearfix"></div> <div style="margin-top:-20px"><br></div> </div> <div class="amount-details" style="padding-top:5px;border-bottom: 1px solid;"><span class="Payment-heading-info">{langTranslateApp.paymentSummaryACB}<span if="{app.isMauritius}" class="holder-name">{app.qouteLineItems.AccountBalance.LocalPrice.Currency+" "+Math.abs(app.qouteLineItems.AccountBalance.LocalPrice.Amount)}</span> </span> <span if="{!app.isMauritius}" class="holder-name">{app.qouteLineItems.AccountBalance.CurrencyCode+" "+Math.abs(app.qouteLineItems.AccountBalance.Value)}</span></div> </div> </div> <div class="clearfix"></div> <div class="Payment-summary-bottom"><span class="total">{ (app.qouteLineItems.AmountToPay.Value > 0 ? langTranslateApp.totalAmountToPay : langTranslateApp.paymentSummaryAACB)}</span><span class="heading-price"><span if="{!app.isMauritius}">{app.qouteLineItems.AccountBalance.CurrencyCode}</span><span if="{app.isMauritius}">{app.qouteLineItems.AmountToPay.LocalPrice.Currency}</span> <span class="" id="txtval_namechanged" if="{!app.isMauritius}">{Math.abs(app.qouteLineItems.AmountToPay.Value || 0.00)}</span><span class="" id="txtval_namechanged" if="{app.isMauritius}">{Math.abs(app.qouteLineItems.AmountToPay.LocalPrice.Amount || 0.00)}</span></span></div> </div> </div> <div if="{opts.showmaxPayment}" class="Pay-summary showmax-payment-flow"> <div class="Payment-showmax"> <div class="payment-summary-main"> <div class="Payment-summary-title"> <div class="overflow-quotes"> <div class="clearfix"></div> <div style="margin-bottom: 10px;"> <div class="quotes" style="padding-bottom: 5px;font-size: 16px; font-weight: 300;" if="{opts.showmaxQoute.Quote.Id}"> <span>{langTranslateApp.paymentSummaryQoute}</span> <span class="quote-number">{opts.showmaxQoute.Quote.Id}</span></div> <div class="quotes-details"> <div each="{lineItem, index in opts.showmaxQoute.Quote.LineItems}" class="hover"> <span class="Payment-heading-info main">{getNewPackageName(lineItem.InvoiceText)} </span> <span class="holder-name title" style="margin-top:0px">{dstvApp.countrycurrency.toUpperCase()+" "+lineItem.Amount}</span> </div> </div> <div class="clearfix"></div> </div> <div class="clearfix"></div> <div style="margin-top:-20px"><br></div> </div> <div class="amount-details"><span class="Payment-heading-info">{langTranslateApp.paymentSummaryQouteTotal} </span> <span class="holder-name">{dstvApp.countrycurrency.toUpperCase()+" "+opts.showmaxQoute.Quote.QuoteAmount.toFixed(2)}</span></div> <div class="amount-details" style="bpadding-top:5px;;border-bottom: 1px solid;"><span class="Payment-heading-info">{langTranslateApp.paymentSummaryACB} </span> <span class="holder-name">{dstvApp.countrycurrency.toUpperCase()+" "+opts.showmaxQoute.Quote.AccountBalance.toFixed(2)}</span></div> </div> </div> <div class="clearfix"></div> <div class="Payment-summary-bottom"><span class="total">{langTranslateApp.totalAmountToPay}</span><span class="heading-price"><span>{dstvApp.countrycurrency.toUpperCase()}</span> <span class="" id="txtval">{opts.showmaxQoute.Payment.Amount.toFixed(2) || 0.00}</span></span></div> </div> </div> </div> </div> <div class="accordion-item"> <div class="accordian-pack accordion_head"> <span class="plusminus">+</span> <h2 class="acc-left"><b>{langTranslateApp.dashTransaction}</b> {langTranslateApp.dashHistory}</h2> </div> <div class="accordion_body" style="display: none;"> <div class=""> <tag-transaction-history></tag-transaction-history> </div> </div> </div> <div class="accordion-item"> <div class="accordian-pack accordion_head"> <span class="plusminus">+</span> <h2 class="acc-left"><b>{langTranslateApp.dashMoreWord}</b> {langTranslateApp.dashPayServices}</h2> </div> <div class="accordion_body" style="display: none;"> <div class=""> <div class="self-service-slider self-service-main-content"> <div class="self-service-content" if="{!app.isCurrDVSSmartcard}"> <a href="javascript:void(0);" onclick="{SelfServiceClick}" action="ADDSHOWMAX"> <div class="ssItem first"> <div class="clearfix"> <div class="content one"> <div class="iconDiv"><img class="show-max-img-icons" src="/media/11395/showmax_logo-w-3.svg"></div> <span class="cards-heading">{langTranslateApp.add} <b>{langTranslateApp.addShowmax}</b> {langTranslateApp.boxOfficeTo} {langTranslateApp.dashPayYour} <span class="cards-heading">{langTranslateApp.loginHeader2} {langTranslateApp.loginHeader3}</span></span> </div> <div class="btnDiv" onclick="{SelfServiceClick}" action="ADDSHOWMAX"> <span class="btn btn-primary"> <!--<span class="heading">{app.showmaxCardCaption}</span>--><span class="heading"><b>{langTranslateApp.add}</b> {langTranslateApp.addShowmax}</span> </span> </div> </div> </div> </a> </div> <div class="self-service-content" if="{!app.isCurrDVSSmartcard && !app.isLiberia}"> <a href="javascript:void(0);" onclick="{SelfServiceClick}" action="RENTMOVIES"> <div class="ssItem second"> <div class="clearfix"> <div class="content one"> <div class="iconDiv"><img class="show-max-img-icons show" src="/media/11394/boxoffice-logo.png"></div> <span class="cards-heading">{langTranslateApp.dashPayTheLatest} <span class="cards-heading"><b>{langTranslateApp.dashBlockbuster}</b></span> </span> </div> <div class="btnDiv" onclick="{SelfServiceClick}" action="RENTMOVIES"> <span class="btn btn-primary"> <!--<span class="heading">Rent</span>--><span class="heading"><b>{langTranslateApp.dashRent}</b> {langTranslateApp.dashboxofficeNow}</span> </span> </div> </div> </div> </a> </div> <div class="self-service-content"> <a target="blank" href="{dstvApp.DstvNowURL}"> <div class="ssItem second third"> <div class="clearfix"> <div class="content one"> <div class="iconDiv"><img class="show-max-img-icons show" src="/media/2173/dstv_logo.png"></div> <span class="cards-heading">{langTranslateApp.dashTVON} <span class="cards-heading"><b>{langTranslateApp.dashTHEGO}</b></span> </span> </div> <div class="btnDiv" onclick="" action=""> <span class="btn btn-primary"> <!--<span class="heading">Rent</span>--><span class="heading"><b>{langTranslateApp.watch}</b> {langTranslateApp.dashboxofficeNow}</span> </span> </div> </div> </div> </a> </div> </div> </div> </div> </div> <div class="clearfix"></div> </div> </div> </div> <!-- Pay Accordion UI Ends --> </section> </div> <div class="alert-msg" id="errorMessage"> <div class=""> <span class="icon-icon-warning"></span> <span class="error-wrong-msg">{langTranslateApp.paymentErrorMessageTitle}</span> <span if="{!genericError}" class="error-note">{langTranslateApp.paymentErrorMessageDescription}</span> <span if="{genericError}" class="error-note">{langTranslateApp.genericTechnicalIssueMsg1} <u><a class="payments_errContactUs" href="{dstvApp.ContactUsURL}" onclick="{window.RedirectTargetOrgin}" target="blank">{langTranslateApp.subMenuContactUs}</a></u> {langTranslateApp.genericTechnicalIssueMsg2}</span> <div class="clearfix"> <a href="javascript:void(0)" class="btn anim-btn btn-default ok-btn close" onclick="{closePaymentDialog}">{langTranslateApp.rewardsBack}</a> </div> </div> </div> </div> <div class="payment-main-sections {paymentStatus.class}" if="{paymentStatus.show}"> <div class="icon-img-common"><i class="fa fa-spinner fa-pulse fa-2x fa-fw"></i></div> </div> <div class="response-end {paymentStatus.class}" if="{paymentStatus.show}"> <h5 class="payment-heading" if="{paymentStatus.show}"> {paymentStatus.heading.toLowerCase()} </h5> <hr class="status-pay"> <div class="AwarenessInfoArea {paymentStatus.class}" style="padding:0 !important;"> <span if="{paymentStatus.class == \'pending\'}" class="awareness-top-text"><b>{langTranslateApp.paymentsMsg1}</b></span> <span if="{paymentStatus.class == \'pending\'}" class="awareness-top-text">{langTranslateApp.paymentsMsg6} <b>{langTranslateApp.paymentsMsg7}</b></span><span paymentStatus.class = \'cancalrecurringsuccess\' class="awareness-top-text" id="2"><b>{langTranslateApp.paymentsMsg1}</b></span> <span if="{paymentStatus.class == \'cancalrecurringsuccess\'}" class="awareness-top-text" id="3"> Recurring has <b>Cancelled</b></span> <span if="{paymentStatus.class == \'success\'}" class="awareness-top-text"><b>{langTranslateApp.paymentsMsg1} </b>{langTranslateApp.paymentsMsg2}</span> <span if="{paymentStatus.class == \'success\'}">{langTranslateApp.paymentsMsg3} <b>{langTranslateApp.paymentsMsg4}</b></span> <span if="{paymentStatus.class == \'failed\'}" class="awareness-top-text">{langTranslateApp.paymentsMsg8} <b>{langTranslateApp.paymentsMsg9} </b>{langTranslateApp.paymentsMsg10}</span> <p if="{showmaxPaymentStatus && showMessage}" class="showmax-message longmessage">To finish Showmax setup, please create or sign in to a Showmax account.</p> <div class="dppinnerwrap details {paymentStatus.class}"> <div class="batched"> <div class="field-title"> {langTranslateApp.paymentsTransactionId} <div class="dtls-colon pull-right">:</div> </div> <div class="field-value">{paymentStatus.transactionId}</div> <div class="field-title" if="{paymentStatus.amountDue}"> {langTranslateApp.paymentsAmount} <div class="dtls-colon pull-right">:</div> </div> <div class="field-value" if="{paymentStatus.amountDue}">{paymentStatus.currency} &nbsp; {paymentStatus.amountDue}</div> <div class="field-title"> {langTranslateApp.paymentsStatus} <div class="dtls-colon pull-right">:</div> </div> <div class="field-value status">{(paymentStatus.status=="Undefined" || paymentStatus.status=="undefined") ? langTranslateApp.inComplete : paymentStatus.heading}</div> <div style="clear:both"></div> <div class="field-title"> {langTranslateApp.paymentsDate} <div class="dtls-colon pull-right">:</div> </div> <div class="field-value date">{paymentStatus.date}</div> <div class="field-title" if="{localPrice && dstvApp.DualCurrencyCountryList.includes(dstvApp.countryabbreviation)}"> {langTranslateApp.localPaymentsAmount} <div class="dtls-colon pull-right">:</div> </div> <div class="field-value" if="{localPrice && dstvApp.DualCurrencyCountryList.includes(dstvApp.countryabbreviation)}">{paymentStatus.localCurrency} &nbsp; {paymentStatus.localAmountDue}</div> <div class="clearfix"></div> </div> </div> <div class="ctn-banner-main" if="{paymentStatus.class == \'success\'}"> <div class="ctn-banner"> <div if="{!showMovieAddonCard}" class="ctn-banner-wrapper" style="background-image: url({dstvApp.targetDomain+paymentCTAContent.PayCardCTAImage}); center"> <a target="_blank" href="javascript:void(0)" onclick="{OnPayCtaClick}"> <div class="slide-content"> <div class="ctn-bottom">{paymentCTAText} <span class="arrow-ctn"></span></div> </div> </a> </div> <div if="{showMovieAddonCard}" class="backcard-packageItem {selectedAddOnCode}"> <i class="icon-pack icon-{selectedAddOnCode}"></i> <div class="backcardprice"><span if="{!app.dualCurrencyApplicable}" class="price-value">{dstvApp.countrycurrency.toUpperCase()} {selectedAddonPrice}</span><span if="{app.dualCurrencyApplicable}" class="price-value">{dstvApp.countrycurrency.toUpperCase()} {app.selectedCurrentAddOnDetails.DualCurrencyCurrentAddOnPrice}</span></div> <div class="bottomBar">{langTranslateApp.pkgNewPackageTitle}</div> <div class="backgroundimg"></div> </div> </div> <div class="clearfix"></div> </div> </div> </div> </div> <div class="clearfix"></div> <div class="awareness-sub-text-main response-end {paymentStatus.class}" if="{paymentStatus.show}"> <p if="{paymentStatus.class == \'failed\'}" class="processing">{langTranslateApp.paymentsFailedMsg}</p> <span if="{paymentStatus.class == \'success\' || paymentStatus.class == \'pending\'|| paymentStatus.class == \'cancalrecurringsuccess\'}" class="awareness-sub-text">{langTranslateApp.paymentsMsg5}</span> <button class="awareness-activate-btn {paymentStatus.class}" id="Cancel" if="{paymentStatus.class != \'success\' && paymentStatus.class != \'cancalrecurringsuccess\'}" onClick="{closePaymentDialog}" style="margin-right: 15px;"><span class="anim-span"></span><i class="fa fa-times cross" style="float: left; line-height: 25px; font-size: larger;"></i><span>{langTranslateApp.updateCancel}</span></button><button class="awareness-activate-btn {paymentStatus.class}" id="Done" if="{(paymentStatus.class == \'success\' || paymentStatus.class == \'cancalrecurringsuccess\') && !showmaxPaymentStatus}" onClick="{closePaymentDialog}"><span class="anim-span"></span><span>{langTranslateApp.updateDone.toUpperCase()}</span><span class="arrowNow" style="color:#000;"></span></button><button class="btn btn-white anim-btn payment-status-btn showmax-payment-status-btn" id="Done" if="{showmaxPaymentStatusReconnect}" onClick="{onAddShowmax}"><span class="anim-span"></span><span style="color:#fff;">{langTranslateApp.addShowmax}</span><span class="arrowNow" style="color:#fff;"></span></button><button class="btn btn-white anim-btn payment-status-btn showmax-payment-status-btn " id="Done" if="{showmaxPaymentStatus}" onClick="{onAddShowmax}"><span class="anim-span"></span><span style="color:#fff;">{langTranslateApp.dashContinueToShowmax}</span><span class="arrowNow" style="color:#fff;"></span></button><button class="awareness-activate-btn {paymentStatus.class}" id="Refresh" if="{paymentStatus.class == \'pending\'}" onClick="{getPaymentStatus}"><span class="anim-span"></span><span if="{!fetchingPaymentStatus}"><span> {langTranslateApp.payRefresh}</span> <i class="fa fa-repeat" style="float: right; line-height: 25px; font-size: larger;"></i></span><span if="{fetchingPaymentStatus}"><span> {langTranslateApp.payRefreshing}</span><i class="fa fa-repeat fa-spin" style="float: right; line-height: 25px; font-size: larger;"></i></span></button><button class="awareness-activate-btn {paymentStatus.class}" id="Refresh" if="{paymentStatus.class == \'failed\'}" onClick="{onRetry}"><span class="anim-span"></span><span if="{!fetchingPaymentStatus}"><span> {langTranslateApp.paymentsRetry}</span> <i class="fa fa-repeat" style="float: right; line-height: 25px; font-size: larger;"></i></span></button> </div> <div class="clearfix"></div> <div if="{PaymentCardsList}"> <div class="make-payment-bank {paymentStatus.class}" if="{paymentStatus.show}"> <div class="update-details-wrapper more-details-wrapper payment-info clearfix" if="{paymentStatus.class == \'failed\' || paymentStatus.class == \'pending\'}"> <div class="row"> <div class="col-lg-12"> <div class="mb-2 font-weight-300">This might interest you</div> </div> <div class="payments-slider"> <div class="sub-section" each="{item in paymentUmbracoContent}"> <div class="add-card" style="background-image: url({dstvApp.targetDomain+item.properties.Backimgpay});"> <div class="add-img-bx" style="background-image: url({dstvApp.targetDomain+item.properties.Frontimgpay});"></div> <div class="title-one"> <span>{item.properties.Subheadingpay}</span></div> <a href="{item.properties.Payurl}" onclick="{window.RedirectTargetOrgin}" target="_blank"> <div class="add-card-bottom"> <span>{item.properties.Bottomheadingpay}</span></div> </a> </div> </div> </div> </div> </div> </div> </div> </div> <div class="content-wrapper {paymentStatus.fullviewclass} pay pay-bg" id="payment-main-section" if="{showAirtimePayScreen}"> <div class="payment-cards-config 2" if="{showAirtimeSummary}"> <div class="main-top-payment-info"> <button type="button" class="payment-close" onclick="{backpayment}">X</button> <div id="paymentPageAirtime"> <section class="payment-section clearfix"> <div class="package-payment-box package-payment-box-ht"> <div class="cost-bx"> <div class="cost-title">Cost Summary: <span>Top up Airtime</span></div> <div class="cost-txt">Buying For: <a>{buyingAirtimeForName}</a></div> </div> <div class="total-amount-pay"> <div class="pay-text">Total amount to pay</div> </div> <div class="edit-amount"> <div class="edit-iner-section"> <span class="countryCode">{dstvApp.countrycurrency.toUpperCase()}</span> <input type="text" autofocus="" autocomplete="off" class="form-control input-lg focus" id="editableAmount" name="signIn_smartCardNumber" maxlength="10" value="{airtimeAmount}"><!--<span class="edit-payment-icon"> <img src="/media/8619/materialicon-1.svg"> </span>--> <div class="error-payment-msg"></div> </div> </div> </div> <div class="clearfix"></div> </section> <!-- Pay Accordion UI Start --> <div class="pay-content-wrapper"> <div class="airtime-pay-wrapper"> <div class="airtime-pay-wrapper-in text-left"> <div class="title">**You are about to make a <b>payment</b> of {dstvApp.countrycurrency.toUpperCase()} {airtimeAmount}.<br /> <b>Please follow</b> the <b>prompts on your phone</b> to complete your payment.</div> <img src="/media/11765/hand.png" /> <div class="text-center pay-btn-wrapper"><button type="button" class="btn btn-cancelnow text-uppercase" onclick="{onBack}">Back <span class="arrowNow cancel"></span></button><button type="button" class="btn btn-paynow text-uppercase" onclick="{onInitiateUssdPayment}">Continue <span class="arrowNow cancel"></span></button></div> </div> </div> </div> </div> </div> <div class="clearfix"></div> <div class="clearfix"></div> </div> <div class="content-wrapper responseWrapper pay airtime-msg-bx" id="payment-main-section" if="{showNoticeSection}"> <div class="payment-cards-config 3"> <button type="button" class="payment-close" onclick="{backpayment}">X</button> <div class="payment-main-sections {ussdPaymentStatus.class}"> <div class="icon-img-common"></div> </div> <div class="response-end {ussdPaymentStatus.class}"> <h5 if="{paymentInitSuccess}" class="payment-heading">{ussdPaymentStatus.heading.toUpperCase()}</h5> <hr class="status-pay"> <div class="AwarenessInfoArea {ussdPaymentStatus.class}" style="padding:0 !important;"><span if="{paymentInitSuccess && ussdPaymentStatus.class == \'success\'}" class="awareness-top-text">Your purchase is<b> successful.</b></span><span if="{paymentInitSuccess && ussdPaymentStatus.class == \'pending\'}" class="awareness-top-text">We are busy processing your transaction.</br> <b> Please wait.</b></span><span if="{paymentInitSuccess && ussdPaymentStatus.class == \'failed\'}" class="awareness-top-text">Your transaction has<b> failed.</b></span> </div> </div> </div> <div class="clearfix"></div> <div class="awareness-sub-text-main response-end {ussdPaymentStatus.class}"><span if="{paymentInitSuccess && ussdPaymentStatus.class == \'success\'}" class="awareness-sub-text">**Thank you for using MyDStv.</span><span if="{paymentInitSuccess && ussdPaymentStatus.class == \'failed\'}" class="awareness-sub-text">**Please try again in<b> 5 minutes.</b></span><span if="{paymentInitSuccess && ussdPaymentStatus.class == \'pending\'}" class="awareness-sub-text">**These changes could take up to a few minutes to reflect.</span><button class="awareness-activate-btn {ussdPaymentStatus.class}" id="Done" if="{ussdPaymentStatus.class == \'success\'}" onClick="{closePaymentDialog}"><span class="anim-span"></span><span>{langTranslateApp.updateDone.toUpperCase()}</span><span class="arrowNow" style="color:#000;"></span></button><button if="{!paymentInitSuccess}" class="awareness-activate-btn" id="Cancel" onClick="{initiateBuyAirtime}" style="margin-right: 15px;"><span class="anim-span"></span><span>Continue</span><span class="arrowNow" style="color:#fff;"></span></button><button if="{paymentInitSuccess && ussdPaymentStatus.class == \'pending\'}" class="awareness-activate-btn {ussdPaymentStatus.class}" id="btnRefreshUssd" onClick="{onRefreshUssdStatus}"><span class="anim-span"></span><span if="{!fetchingUssdPaymentStatus}"><span> {langTranslateApp.payRefresh}</span> <i class="fa fa-repeat" style="float: right; line-height: 25px; font-size: larger;"></i></span><span if="{fetchingUssdPaymentStatus}"><span> {langTranslateApp.payRefreshing}</span><i class="fa fa-repeat fa-spin" style="float: right; line-height: 25px; font-size: larger;"></i></span></button><button if="{paymentInitSuccess && ussdPaymentStatus.class == \'failed\'}" class="awareness-activate-btn {ussdPaymentStatus.class}" id="Cancel" onClick="{closePaymentDialog}"><span class="anim-span"></span><span>{langTranslateApp.updateCancel}</span><span class="arrowNow" style="color:#000;"></span></button><button if="{paymentInitSuccess && ussdPaymentStatus.class == \'failed\'}" class="awareness-activate-btn" id="Retry" onClick="{onInitiateUssdPayment}" style="margin-right: 15px;"><span class="anim-span"></span><span>Retry</span><span class="arrowNow" style="color:#fff;"></span></button></div> </div> <div class="" style="z-index: 9999;" if="{checkingStatus}"> <div class="fix-errors-loader-bg"> <div class="loading-loader loading"> <div class="col-sm-12 text-center white"> <div class="spinner white"></div> <div class="loading-message">Checking Status...</div> </div> </div> </div> </div> </div> <div if="{showAwarenessMsg}" class="AwarenessSection" id="awarenessPopup"> <div class="container-fluid main-section awareness"> <div class="popup AwarenessPopup content-wrapper"> <div class="text-center"><img src="/media/11347/3d-verification.svg" class="awareness-icon"></div> <div class="top-info-awareness">{langTranslateApp.awareness3dHeaderText1} {langTranslateApp.awareness3dHeaderText2}</div> <hr class="status-pay" /> <div class="AwarenessInfoArea"> <div class="awareness-top-text"><b class="bold">{langTranslateApp.awareness3dMsg1} </b>{langTranslateApp.awareness3dMsg2} <b class="bold">{langTranslateApp.awareness3dMsg3} </b>{langTranslateApp.awareness3dMsg4} <b class="bold">{langTranslateApp.awareness3dMsg5}</b></div> <div class="awareness-top-text">{langTranslateApp.awareness3dMsg6}</div> <div class="clearfix"></div> </div> </div> <div class="awareness-sub-text"> <b>{langTranslateApp.awareness4dMsg1}</b> {langTranslateApp.awareness4dMsg2} <b>{langTranslateApp.awareness4dMsg3}</b> <div class="awareness-activate-btn payment security"><a class="payment security" href="javascript:void(0)" onclick="{processPayment}">{langTranslateApp.paymentsContinue} <span class="arrowNow"></span></a></div> </div> </div> </div> <div id="paymentsoverlay" class="row"> <div class="cv-spinner"> <span class="cpspinner"></span> </div> </div> <div class="recurring-intro content-wrapper" if="{showRecurringScreen && !showTerminatedBouquetScreen && !showAwarenessMsg}"> <div class="col-md-6 main-image"><img src="/media/9289/payu-main.png" alt="PayU Recurring Payment"></div> <div class="col-md-6 main-text"> <h1 class="sectionTitle"></h1> <p>{langTranslateApp.dashIntroducesRecurringPayments}</p> <h2>{langTranslateApp.dashRecurringPayments}</h2> <div style="text-align: center;margin-bottom: 10px;font-size: 22px;"><span style="margin-right: 10px;">With</span><img src="/media/9519/payu.png" style="width: 100px;"></div> <p if="{showSetUpRecurringOption}"><button onclick={SetupReccuringPayment}>{langTranslateApp.dashSetuprecurrngPayment}</button></p> <p if="{showOnceoffOption}"><button onclick={SetupReccuringPayment}>{langTranslateApp.dashOnceoffPayment}</button></p> </div> <div class="clearfix"></div> </div> <div class=" " id="terminatedBouquet" if="{showTerminatedBouquetScreen}"> <div class="bouquet-content"> <div class="popup bouquet"> <div class="row"> <div class="main-tex"> <h4 class="bouquetsubheading"> {langTranslateApp.dashDiscontinuedPackages}</h4> <span class="bouquettext">{langTranslateApp.dashChangePackageViewExperience}</span> <div class="bouquet-img"><img src="/media/9771/bouquet_termination.png"><a class="bouquetbutton"><button href="javascript(void);" onclick={loadChangePackage}>{langTranslateApp.pkgChangePackage} <span class="icon-icon-next"> </span></button></a></div> </div> </div> </div> </div> </div></div>','','',function(opts){var self=this;self.smartcard=app.smartcard;self.paymentButtonCaption=langTranslateApp.subMenuPayNow;self.noOnlinePayment=dstvApp.NoOnlinePaymentCountryList.includes(dstvApp.countryabbreviation);self.showSetUpRecurringOption=opts.showSetUpRecurringOption==undefined?true:opts.showSetUpRecurringOption;self.showOnceoffOption=opts.showOnceoffOption==undefined?true:opts.showOnceoffOption;self.PaymentCardsList=dstvApp.PaymentCardCountryList.includes(dstvApp.countryabbreviation);var amountDue='';var editedAmount='';var amountToProcess='';var boSelectedMovieId='';var boProductName='';self.newWin='';self.paymentStatus={};self.ussdPaymentStatus={};self.disablePayNow=false;self.genericError=false;self.showErrorMsg=false;self.buttonCaption='Watch Now';self.showAwarenessMsg=false;self.isPaymentCompleted=false;self.editIconClicked=false;self.packages=app.smartcards;self.paymentSummaryShowmax=false;self.preventDuplicateFlag=false;self.paymentInitSuccess=false;self.ussdPayStatusInitiated=false;self.refreshRequested=false;self.checkingStatus=false;if(!(app.selectedCurrentPackageDetails)&&!(app.selectedCurrentAddOnDetails)&&app.selectedCurrentPackageDetails!=undefined&&app.currentSmartcardPackage.primaryService!=undefined){app.selectedCurrentPackageDetails=app.currentSmartcardPackage.primaryService
app.selectedCurrentPackageDetails.PackageCode=app.currentSmartcardPackage.primaryService.productCode;app.selectedCurrentPackageDetails.PackageName=app.currentSmartcardPackage.primaryService.serviceName;app.selectedCurrentPackageDetails.PackagePrice=app.currentSmartcardPackage.primaryService.price;app.selectedCurrentPackageDetails.PackageDesc=app.currentSmartcardPackage.primaryService.description;}
self.on('before-mount',function(){self.GenerateJWT();});if(app.accountsInfo&&app.accountsInfo[0]&&app.accountsInfo[0].AccountBalance){if(app.accountsInfo.filter(d=>d.AccountType=='DStvRes')[0]!=undefined)
self.availableAccountBalance=app.accountsInfo.filter(d=>d.AccountType=='DStvRes')[0].AccountBalance.Value;if(app.accountsInfo.filter(d=>d.AccountType=='DStvComm')[0]!=undefined)
self.availableAccountBalance=app.accountsInfo.filter(d=>d.AccountType=='DStvComm')[0].AccountBalance.Value;if(dstvApp.DualCurrency&&dstvApp.DualCurrencyCountryList.includes(dstvApp.countryabbreviation)){if(app.accountsInfo.filter(d=>d.AccountType=='DStvRes')[0]!=undefined)
self.availableAccountBalanceDualCurrency=app.accountsInfo.filter(d=>d.AccountType=='DStvRes')[0].AccountBalance.LocalPrice.Amount.toString();if(app.accountsInfo.filter(d=>d.AccountType=='DStvComm')[0]!=undefined)
self.availableAccountBalanceDualCurrency=app.accountsInfo.filter(d=>d.AccountType=='DStvComm')[0].AccountBalance.LocalPrice.Amount.toString();}}
else{self.availableAccountBalance='NA';}
self.on('mount',function(){riot.mount('tag-transaction-history',{showComponent:true});if(self.noOnlinePayment){if(dstvApp.configPackagesCountryList.includes(dstvApp.countryabbreviation)){self.waystopayURL=dstvApp.languageAbbreviation=='pt'?dstvApp.dstvUrl+window.culture+'/pagar/como-pagar/':dstvApp.dstvUrl+window.culture+'/pay/how-to-pay/';}else{self.waystopayURL=window.culture+(dstvApp.languageAbbreviation=='pt'?'/formas-de-pagamento':'/ways-to-pay');}
self.paynowCaption=langTranslateApp.dashboardHowToPay;}
if(dstvApp.DualCurrencyCountryList.includes(dstvApp.countryabbreviation)&&dstvApp.countryabbreviation!=='mu'){self.fetchConversionFactor();}
self.OnKeyUp()
$('#errorMessage').hide();self.paymentStatus.show=false;if(app.showTerminatedBouquetScreen){self.showTerminatedBouquetScreen=true;self.showRecurringScreen=false;self.update();}
else if(self.opts.showRecurringScreen){self.showRecurringScreen=true;self.update();}
else if(opts.changePackagePayment||opts.boxOfficePayment||opts.movieAddonPayment){amountToProcess=opts.amount;boSelectedMovieId=opts.id;boProductName=opts.productName;$('#paymentModal').modal('show');$('#paymentPage').hide();self.showAwarenessPopup();}
if(opts.showmaxPayment||opts.showmaxChangePackagePayment||opts.payReconnectShowmax||opts.paySmartcardReconnectShowmax||opts.reconnect){if(opts.paySmartcardReconnectShowmax||opts.payReconnectShowmax){self.paymentSummaryShowmax=true;self.dueAmountToShow=self.AmountToPay();}
else{self.dueAmountToShow=amountToProcess=opts.amount;if(app.dualCurrencyApplicable)
self.dueAmountToShow=amountToProcess=opts.dualCurrencyAmount;self.smartcard=opts.smartcardNumber?opts.smartcardNumber:app.smartcard;$("#editableAmount").val(amountToProcess);$("input").prop('disabled',true);self.paymentSummaryShowmax=true;}
self.update();}
if(app.qouteLineItems&&app.qouteLineItems.Quotes&&app.qouteLineItems.Quotes.length&&app.qouteLineItems.Quotes[0].LineItems){app.qouteLineItems.Quotes[0].LineItems=app.qouteLineItems.Quotes[0].LineItems.reverse().sort(function(a,b){a=a.StartDate.split(' ')[0].split('-').reverse().join('');b=b.StartDate.split(' ')[0].split('-').reverse().join('');return a>b?1:a<b?-1:0;});self.lineItemPresent=app.qouteLineItems.Quotes[0].LineItems.length>0}
if(opts.airtimePayment){self.showAirtimePayScreen=true;self.showAirtimeSummary=true;self.airtimeAmount=opts.amount;self.buyingAirtimeForMobNo=opts.buyingAirtimeForMobNo;self.buyingAirtimeForName=opts.buyingAirtimeForName;self.update();$("input").prop('disabled',true);}
self.backpayment=function(){if(app.isVIVR){window.close();return;}
window.HandleActiveTab('showAccount')}
$('.edit-payment-icon').click(function(){if($('#editableAmount').val()==""||$('#editableAmount').val()==null){return false;}
else{$('#editableAmount').prop('readonly',false);$('#editableAmount').focus();self.editIconClicked=true;}
self.update();});$("#editableAmount").keypress(function(e){var amount='';var isParsed=false;if((this.value).indexOf('.')>-1){amount=this.value;}
else{amount=parseFloat(this.value).toFixed(4);isParsed=true;}
if(app.dualCurrencyApplicable&&dstvApp.countryabbreviation=='et'&&e.which==46){return false;}
else if((e.which!=8&&e.which!=0&&e.which!=46&&this.value.trim()==""&&(e.which<48||e.which>57))||(e.which!=8&&e.which!=0&&e.which!=46&&this.value.trim()!==""&&(e.which<48||e.which>57))){return false;}
var number=amount.split('.');if(number.length>1&&e.which==46&&!isParsed){return false;}
if(amount=="NaN"&&this.value!=""){return false;}
if((amount.indexOf('.')!=-1)&&(amount.substring(amount.indexOf('.')).length>2)&&($(this)[0].selectionStart>=amount.length-2))
{return false;}
if(amount){self.disablePayNow=amount<=0?true:false;}
self.update();return true;});$('#paymentModal').on('hidden.bs.modal',function(){console.log('Payment Suit: On closing...')
if(self.tokenGenerated&&self.isPaymentCompleted){site.factory.CaptureFeedback('DSTVPAYNOW_'+app.customernumber);self.tokenGenerated=false;self.GetAmountToPay();}})
$("#editableAmount").keyup(function(){self.OnKeyUp();});$('.pay-package-dtls').hide();$('.main-packagelist-section').click(function(){$('.pay-package-dtls').hide();$('.main-packagelist-section').removeClass("active-card");$(this).addClass("active-card");$(this).addClass("visited-card");$(this).next(".pay-package-dtls").slideDown("fast");});$(document).ready(function(){self.setAccordionClick();});setTimeout(function(){self.setAccordionClick();},1500);self.getPaymentCardCtaContent();});self.InitializePaymentSlider=function(){$(".payments-slider").not('.slick-initialized').slick({dots:true,arrows:true,prevArrow:'<button class="slick-prev"><span class="icon-ico-arrow-next"></span></button>',nextArrow:'<button class="slick-next"><span class="icon-ico-arrow-next"></span></button>',infinite:true,slidesToShow:3,slidesToScroll:1,focusOnSelect:true,responsive:[{breakpoint:1480,settings:{slidesToShow:3,}},{breakpoint:1280,settings:{slidesToShow:2,}},{breakpoint:1024,settings:{slidesToShow:2,}},{breakpoint:600,settings:{slidesToShow:1.5,}},{breakpoint:480,settings:{slidesToShow:1.3,}},{breakpoint:320,settings:{slidesToShow:1.3,}}]});}
self.getAvailablePaymentContent=function(){fetch(dstvApp.targetDomain+window.culture+"/api-services-payment/payment_cards/ujson?children=true&select=headerpay,backimgpay,frontimgpay,subheadingpay,bottomheadingpay,payurl&resolveMedia=backimgpay,frontimgpay&cdv="+(new Date().getTime())).then(response=>response.json()).then(commits=>self.onGetAvailablePaymentSuccess(commits));}
self.onGetAvailablePaymentSuccess=function(data){console.log('Payment : Success in fetching Payment Umbraco content');self.paymentUmbracoContent=data.entities;self.update();self.InitializePaymentSlider();}
self.getPaymentCardCtaContent=function(){fetch(dstvApp.targetDomain+"/api-services-cta/api-payments-cta/ujson?select=payCardCTAImage,payCardCTATextEnglish,payCardCTATextPortuguese&resolveMedia=payCardCTAImage&cdv="+(new Date().getTime())).then(response=>response.json()).then(commits=>self.onGetPaymentCardCtaContent(commits));}
self.onGetPaymentCardCtaContent=function(data){console.log('Payment : Success in fetching Payment Success Card CTA Umbraco content');self.paymentCTAContent=data.properties;self.paymentCTAText=dstvApp.languageAbbreviation=='en'?self.paymentCTAContent.PayCardCTATextEnglish:self.paymentCTAContent.PayCardCTATextPortuguese;self.update();}
self.OnPayCtaClick=function(){self.paymentCTAUrl=dstvApp.ConnectSignInUrl+'?utm_source=dstvafrica&utm_medium=paymentsuccess';window.open(self.paymentCTAUrl,'_blank');}
self.OnPayNow=function(e){if(opts.boxOfficePayment){window.dataLayer=window.dataLayer||[];window.dataLayer.push({event:'eec.addToCart',ecommerce:{add:{products:[{id:boSelectedMovieId,name:boProductName,price:amountToProcess.toString(),brand:'DStv',category:'DP Box-office rentals',variant:'',quantity:1}]}}});}else{}
if(self.noOnlinePayment)
window.RedirectTargetOrgin(e,self.waystopayURL);else{if(app.amounttopayloaded)
self.validateEditedAmount();}}
self.setAccordionClick=function(){if(!self.preventDuplicateFlag){$(".pay-accordion-wrapper .accordion_head").off().click(function(){if($('.accordion_body').is(':visible')){$(".accordion_body").slideUp(300);$(".plusminus").text('+');}
if($(this).next(".accordion_body").is(':visible')){$(this).next(".accordion_body").slideUp(300);$(this).children(".plusminus").text('+');}else{$(this).next(".accordion_body").slideDown(300);$(this).children(".plusminus").text('-');}});self.preventDuplicateFlag=true;$(".accordion-item .paysummary").click();}}
self.GenerateJWT=function(){site.factory.GetJWT().then(function(token){self.token=token;});}
self.fetchConversionFactor=function(){$("#paymentsoverlay").fadeIn(300);if(dstvApp.EnableSecurityAuth){let converCurrencyUrl=dstvApp.SecurityAuthBaseUrl+`/apicurrency/api/v1/Currency?Country=${dstvApp.country}&ToCurrency=ETB`;site.factory.Get(converCurrencyUrl,'',self.onFetchConversionFactorSuccess,self.onFetchConversionFactorError,false,false,true)}else{site.factory.GetJWT().then(function(token){self.token=token;let converCurrencyUrl=dstvApp.DSOAPIUrl+`/apicurrency/api/v1/Currency?Country=${dstvApp.country}&ToCurrency=ETB`;site.factory.Get(converCurrencyUrl,'',self.onFetchConversionFactorSuccess,self.onFetchConversionFactorError);});}}
self.onFetchConversionFactorSuccess=function(data){console.log('Payments New : On Currency conversion success');$("#paymentsoverlay").fadeOut(300);self.conversionFactor=data.conversionFactor;}
self.onFetchConversionFactorError=function(err){console.log('Payments New : On Currency conversion error');$("#paymentsoverlay").fadeOut(300);$('#paymentPage').hide();$('#errorMessage').show();}
self.AmountToPay=function(){if(app.dualCurrencyApplicable)
return(app.paymentduedetails.properties.amountToPayEtb.value<0||app.paymentduedetails.properties.amountToPayEtb.value==null)?0:app.paymentduedetails.properties.amountToPayEtb.value;return(app.paymentduedetails.properties.amountToPay.value<0||app.paymentduedetails.properties.amountToPay.value==null)?0:app.paymentduedetails.properties.amountToPay.value;}
self.OnKeyUp=function(){self.disablePayNow=self.GetTextboxAmount()<=0?true:false;self.update();}
self.GetTextboxAmount=function(){let editableAmount=$("#editableAmount").val()
return editableAmount;}
self.SetPaymentSummayPayable=function(){let editableAmount=$("#editableAmount").val()
let txtval=parseFloat(editableAmount||0).toFixed(2)
$("#txtval").text(txtval)}
self.IsRecurringPaymentApplicable=function(){return dstvApp.RecurringPaymentCountries.includes(dstvApp.countryabbreviation);}
self.validateEditedAmount=function Pay(){let paymentCurrency=dstvApp.countrycurrency;if(dstvApp.DualCurrencyCountryList.includes(dstvApp.countryabbreviation)){paymentCurrency=dstvApp.DualCurrencyPaymentCurrency.filter(x=>x.country==dstvApp.countryabbreviation)[0].currency;}
if(paymentCurrency.toLowerCase().trim()!==dstvApp.countrycurrency.toLowerCase().trim()){amountDue=app.paymentduedetails.properties.amountToPayEtb.value?app.paymentduedetails.properties.amountToPayEtb.value:0;}
else{amountDue=app.paymentduedetails.properties.amountToPay.value?app.paymentduedetails.properties.amountToPay.value:0;}
editedAmount=parseFloat($('#editableAmount')[0].value);if(isNaN(editedAmount.toFixed())){return false;}
if(editedAmount.toFixed(2)!==amountDue.toFixed(2)||editedAmount<1){let paymentCurrency=dstvApp.countrycurrency;if(dstvApp.DualCurrencyCountryList.includes(dstvApp.countryabbreviation)){paymentCurrency=dstvApp.DualCurrencyPaymentCurrency.filter(x=>x.country==dstvApp.countryabbreviation)[0].currency;}
if(paymentCurrency.toLowerCase().trim()!==dstvApp.countrycurrency.toLowerCase().trim()){amountToProcess=editedAmount.toFixed(2);self.isAmountEdited=true;self.convertCurrencyAndPay();}
else{amountToProcess=editedAmount.toFixed(2);self.isAmountEdited=true;if(amountToProcess<1){self.showErrorMsg=true;self.errorMsg=langTranslateApp.paymentsMoreThanOneMsg+' '+paymentCurrency.toUpperCase();self.update();return false;}
else{self.showErrorMsg=false;}
self.update();self.checkForRecurringPayment();}}
else{amountDue=app.paymentduedetails.properties.amountToPay.value;amountToProcess=amountDue.toFixed(2);self.checkForRecurringPayment();}
if(app.selectedCurrentPackageDetails!=undefined){window.dataLayer=window.dataLayer||[];window.dataLayer.push({event:'eec.addToCart',ecommerce:{add:{products:[{id:app.selectedCurrentPackageDetails?app.selectedCurrentPackageDetails.PackageCode:app.selectedCurrentAddOnDetails.AddOnCode,name:app.selectedCurrentPackageDetails?app.selectedCurrentPackageDetails.PackageDesc.toLowerCase().toLowerCase().replaceAll(new RegExp('dStv|bouquet|e36|w/afr|is20|add-on|standalone|e/afr| ','gi'),'').trim():app.selectedCurrentAddOnDetails.AddOnDesc.toLowerCase().replaceAll(new RegExp('dStv|bouquet|e36|w/afr|is20|standalone|e/afr|add-on| ','gi'),'').trim(),price:amountToProcess,brand:'DStv',category:app.currentSelectedPackage==undefined?'DP Subscriptions':app.selectedCurrentPackageDetails?'DP Change Package':'DP Add-on',variant:'',quantity:1}]}}});}}
self.checkForRecurringPayment=function(){if(self.IsRecurringPaymentApplicable()){self.showRecurringScreen=true;self.update();}
else if(dstvApp.SkipPayAwarenessCountryList.includes(dstvApp.countryabbreviation)){self.showRecurringScreen=false;self.showAwarenessMsg=false;self.processPayment();self.update();}
else
self.showAwarenessPopup();}
self.showAwarenessPopup=function(){self.showRecurringScreen=false;self.showAwarenessMsg=true;self.update();}
self.SetupReccuringPayment=function(){if(!self.isAmountEdited)
amountToProcess=app.paymentduedetails.properties.amountToPay.value;self.showAwarenessPopup();}
self.convertCurrencyAndPay=function(){let currency=dstvApp.countrycurrency;if(dstvApp.countryabbreviation=='et'){currency='USD';}
if(self.conversionFactor){amountToProcess=parseFloat(amountToProcess*self.conversionFactor).toFixed(2);if(amountToProcess<1){self.errorMsg=langTranslateApp.paymentsMoreThanOneMsg+' '+currency;self.showErrorMsg=true;return false;}
else{self.showErrorMsg=false;}
self.update();self.checkForRecurringPayment();}}
self.processPayment=function(){self.newWin=window.open('','_blank');let html="";let msg="Please wait..."
if(dstvApp.languageAbbreviation=='pt')
msg='Por favor, espere...'
html=`<html> <head> <meta name="viewport" content="width=device-width, initial-scale=1.0"> <style>@media only screen and (max-width: 667px) { .payment-gif .payment-heading-gif{font-size:20px !important;}.payment-gif #payment-loader-gif { background-size: 70% !important;}}</style> </head> <body class="payment-gif" style="background: #000;"> <div id="payment-loader-gif" style="text-align:center; position: relative; left: 0px; top: 0px; bottom: 0px; right:0px; width: 100%; height: 50%; z-index: 99999999; background: url('/media/11518/mydstv-loader.gif') center no-repeat; background-size: 30%;"> </div> <div class="clearfix"></div> <div class="payment-heading-gif" style="display: block; text-align:center;position: relative; z-index: 9999999999; margin-top: -5%;"> <div style="color:#fff">Initiating payment, Please wait...</div> </div> </body></html>`;self.newWin.document.write(html);let currency=dstvApp.countrycurrency;let vendorType=dstvApp.PaymentVendorType[0];if(dstvApp.DualCurrency&&dstvApp.DualCurrencyCountryList.includes(dstvApp.countryabbreviation)){currency=dstvApp.DualCurrencyPaymentCurrency.filter(x=>x.country==dstvApp.countryabbreviation)[0].currency;vendorType=dstvApp.countrycurrency=="usd"?dstvApp.PaymentVendorType[1]:dstvApp.PaymentVendorType[2];}
$("#paymentsoverlay").fadeIn(300);$("#paymentsoverlay").css('display','content')
let paymentType='DstvPayment';let prodUserKey='';if(opts.showmaxPayment){paymentType='ShowmaxPayment';prodUserKey=app.showmaxAddOnDetails.name;}
else if(opts.boxOfficePayment){paymentType='BoxOffice';}
let account='';let accountInfo='';let productNamesPrices='';if(paymentType=='BoxOffice'){account=app.accounts.filter(x=>x.AccountType=="Box Office");accountInfo=app.accountsInfo?app.accountsInfo.filter(x=>x.AccountType=="Box Office"):[];productNamesPrices="Box Office"+":"+amountToProcess;}
else{if(app.accounts.filter(x=>x.AccountType=="DStvRes")!=undefined){account=app.accounts.filter(x=>x.AccountType=="DStvRes");accountInfo=app.accountsInfo?app.accountsInfo.filter(x=>x.AccountType=="DStvRes"):[];productNamesPrices=app.currentPackageFullName+":"+app.MonthlyPrice;}else{account=app.accounts.filter(x=>x.AccountType=="DStvComm");accountInfo=app.accountsInfo?app.accountsInfo.filter(x=>x.AccountType=="DStvComm"):[];productNamesPrices=app.currentPackageFullName+":"+app.MonthlyPrice;}}
let accNumber=account[0]?account[0].AccountNumber:null;let accBalance=accountInfo[0]?accountInfo[0].AccountBalance.Value:null;let payDueDate=accountInfo[0]?accountInfo[0].DueDate:null;let amtToPay=accountInfo[0]?accountInfo[0].AmountToPay.Value:null;if(opts.boxOfficePayment){window.dataLayer=window.dataLayer||[];window.dataLayer.push({event:'eec.checkout',ecommerce:{checkout:{actionField:{step:1},products:[{id:boSelectedMovieId,name:boProductName,price:amountToProcess.toString(),brand:'DStv',category:'DP Box-office rentals',variant:'',quantity:1}]}}});}else{if(app.selectedCurrentPackageDetails!=undefined){window.dataLayer=window.dataLayer||[];window.dataLayer.push({event:'eec.checkout',ecommerce:{checkout:{actionField:{step:1},products:[{id:app.selectedCurrentPackageDetails?app.selectedCurrentPackageDetails.PackageCode:app.selectedCurrentAddOnDetails.AddOnCode,name:app.selectedCurrentPackageDetails?app.selectedCurrentPackageDetails.PackageDesc.toLowerCase().replaceAll(new RegExp('dStv|bouquet|e36|w/afr|is20|standalone|e/afr|add-on| ','gi'),'').trim():app.selectedCurrentAddOnDetails.AddOnDesc.toLowerCase().replaceAll(new RegExp('dStv|bouquet|e36|w/afr|is20|standalone|e/afr|add-on| ','gi'),'').trim(),price:amountToProcess.toString(),brand:'DStv',category:app.currentSelectedPackage==undefined?'DP Subscriptions':app.selectedCurrentPackageDetails?'DP Change Package':'DP Add-on',variant:'',quantity:1}]}}});}}
self.reqBodyPaymentService={"country":dstvApp.country,"businessUnit":dstvApp.businessunit,"channel":dstvApp.channel,"currency":currency,"customerNumber":app.customernumber,"smartCardNumber":app.viewSubscriptionResponse[0].smartcardNumber,"firstName":app.customerDetails.PersonalDetail.FirstName,"name":app.customerDetails.PersonalDetail.Surname,"accountNumber":accNumber,"amount":amountToProcess,"productUserKey":prodUserKey,"paymentType":paymentType,"backUrl":"","successReturnURL":"","failureReturnURL":"","bypassPaymentSuite":true,"LanguageCode":dstvApp.languageAbbreviation,"accountBalance":accBalance,"dueDate":payDueDate,"productNamesPrices":productNamesPrices,"amountToPay":amtToPay,"vendorType":vendorType};if(dstvApp.EnableSecurityAuth){site.factory.Post(`${dstvApp.SecurityAuthBaseUrl}${dstvApp.DSOPaymentServiceURL}`,self.reqBodyPaymentService,null,self.onPaymentProcessSuccess,self.onPaymentProcessError,false,false,true,true);}else{site.factory.GetJWT().then(function(token){self.token=token;site.factory.Post(`${dstvApp.DSOAPIUrl}${dstvApp.DSOPaymentServiceURL}`,self.reqBodyPaymentService,self.token,self.onPaymentProcessSuccess,self.onPaymentProcessError);});}
site.factory.trackData('PAYMENTS-REQ',self.reqBodyPaymentService,null)}
self.onPaymentProcessSuccess=function(data){console.log('Payment Suit: Payment process successful');self.tokenGenerated=true;if(data){self.showRecurringScreen=false;self.showAwarenessMsg=false;self.update();let dppRedirectUrl=data.redirectUrl;$('#errorMessage').hide();$('#paymentPage').hide();self.newWin.location=dppRedirectUrl+'?viewingDaysLeft='+app.viewingDaysLeft+'&_ga='+$.cookie('_ga');self.transactionId=data.transactionId;setTimeout(()=>{self.getPaymentStatus()},1000)}
else{console.log('Payment Suit: Error after successful DSOPaymentServiceURL call');}
site.factory.trackData('PAYMENTS-RES',null,data)}
self.onPaymentProcessError=function(err){self.tokenGenerated=true;self.showRecurringScreen=false;self.showAwarenessMsg=false;self.update();$("#paymentsoverlay").fadeOut(300);$('#paymentPage').hide();$('#errorMessage').show();console.log('Error on DSO Payment process');let html="";let msg="Something went wrong!"
if(dstvApp.languageAbbreviation=='pt')
msg='Algo deu errado!'
if(err.responseJSON&&err.responseJSON.StatusCode==500){self.genericError=true;self.update();}
html=`<html><head></head><body><div style="text-align: center;background: #190303d1;color: white;"><div style=" box-shadow: 0px 0px 6px grey; padding: 50px; display: block;"><img src="https://www.dstvafrica.com/media/4674/error-icon.png" style="margin-bottom: 20px;"><br><div>${msg}</div></div></div></body></html>`
self.newWin.document.body.innerHTML=''
self.newWin.document.write(html);site.factory.trackData('PAYMENTS-RES',null,err)}
self.getPaymentStatus=function(){console.log('Payment Status : Fetching payment status...');if(!self.isPaymentSuiteOpen()){console.log('Payment Status : Payment suite is closed.');return;}
self.fetchingPaymentStatus=true;self.update();if(dstvApp.EnableSecurityAuth){let url=`${dstvApp.SecurityAuthBaseUrl}${dstvApp.DSOPaymentServiceURL}?Country=${dstvApp.country}&BusinessUnit=${dstvApp.businessunit}&Channel=${dstvApp.channel}&TransactionId=${self.transactionId}`;site.factory.Get(url,null,self.onGetPaymentStatusSuccess,self.onGetPaymentStatusError,false,false,true);}else{let url=`${dstvApp.DSOAPIUrl}${dstvApp.DSOPaymentServiceURL}?Country=${dstvApp.country}&BusinessUnit=${dstvApp.businessunit}&Channel=${dstvApp.channel}&TransactionId=${self.transactionId}`;site.factory.Get(url,self.token,self.onGetPaymentStatusSuccess,self.onGetPaymentStatusError);}}
self.onGetPaymentStatusSuccess=function(d){console.log('Payment Status : '+d.status);console.log('Payment Status : Fetching completed');$('html, body').animate({scrollTop:20},1000);self.isPaymentCompleted="success"==d.status.toLowerCase();self.fetchingPaymentStatus=false;self.paymentStatus.message=d.message;self.paymentStatus.status=d.status;self.paymentStatus.date=site.factory.GetEazyDateFormat(d.date);self.paymentStatus.amountDue=d.amountDue;self.paymentStatus.currency=dstvApp.countrycurrency.toUpperCase();self.paymentStatus.transactionId=d.transactionId;self.showmaxPaymentStatusReconnect=false;self.showmaxPaymentStatus=false;self.showmaxIconVisible=false;self.showMessage=false;self.localPrice=d.localPrice;self.statusMsg='';self.showMovieAddonCard=false;if(dstvApp.countryabbreviation=='et'){self.paymentStatus.currency='USD';}
if(self.localPrice){self.paymentStatus.localCurrency=self.localPrice.currency.toUpperCase();self.paymentStatus.localAmountDue=self.localPrice.amount;}
d.status=d.status.toLowerCase();if((d.status!='undefined'&&d.status!='in_progress')||self.newWin.closed){$("#paymentsoverlay").fadeOut(300);$('#paymentPage').hide();self.paymentStatus.show=true
self.update();}
if(d.status&&opts.movieAddonPayment){self.showMovieAddonCard=true;self.selectedAddOnCode=app.selectedCurrentAddOnDetails?app.selectedCurrentAddOnDetails.AddOnCode:null;self.selectedAddonPrice=app.selectedCurrentAddOnDetails?app.selectedCurrentAddOnDetails.AddOnPrice:null;}
if(d.status=='success'){self.paymentStatus.class="success";self.paymentStatus.fullviewclass='responseWrapper';self.paymentStatus.heading=langTranslateApp.paymentsSuccessStatusMsg;self.newWin.close();if(opts.payReconnectShowmax||opts.showmaxChangePackagePayment){self.showmaxPaymentStatusReconnect=true;$("#paymentsoverlay").fadeIn(300);setTimeout(function(){self.onAddShowmax();},5000);}
if(opts.showmaxPayment||opts.paySmartcardReconnectShowmax){self.showmaxPaymentStatus=true;self.showmaxIconVisible=true;$("#paymentsoverlay").fadeIn(300);setTimeout(function(){self.onAddShowmax();},5000);}
if(opts.showmaxPayment){self.showMessage=true;self.buttonCaption='Create Profile';}
else{self.showMessage=false;}
if(opts.boxOfficePayment){window.dataLayer=window.dataLayer||[];window.dataLayer.push({currencyCode:dstvApp.countrycurrency,event:'eec.purchase',paymentPlatform:'Pay At',paymentMethod:d.vendorName,ecommerce:{purchase:{actionField:{id:d.transactionId,affiliation:'',revenue:d.amountDue.toString(),tax:'',shipping:'',coupon:'',},products:[{id:boSelectedMovieId,name:boProductName,price:d.amountDue.toString(),brand:'DStv',category:'DP Box-office rentals',variant:'',quantity:1}]}}});}else{if(app.selectedCurrentPackageDetails!=undefined){window.dataLayer=window.dataLayer||[];window.dataLayer.push({currencyCode:dstvApp.countrycurrency,event:'eec.purchase',paymentPlatform:'Pay At',paymentMethod:d.vendorName,ecommerce:{purchase:{actionField:{id:d.transactionId,affiliation:'',revenue:d.amountDue.toString(),tax:'',shipping:'',coupon:'',},products:[{id:app.selectedCurrentPackageDetails.PackageCode,name:app.selectedCurrentPackageDetails.PackageDesc.toLowerCase().replaceAll(new RegExp('dStv|bouquet|e36|w/afr|is20|standalone|e/afr|add-on| ','gi'),'').trim(),price:d.amountDue.toString(),brand:'DStv',category:app.currentSelectedPackage==undefined?'DP Subscriptions':'DP Change Package',variant:'',quantity:1,price:'',}]}}});}}
self.update();if(!opts.payReconnectShowmax&&!opts.showmaxChangePackagePayment&&!opts.showmaxPayment&&!opts.paySmartcardReconnectShowmax)
site.factory.CaptureFeedback('DSTVPAYNOW_'+app.customernumber);}
else if(d.status=='pending'){self.paymentStatus.class="pending";self.paymentStatus.fullviewclass='responseWrapper';self.paymentStatus.heading=langTranslateApp.paymentsPendingStatusMsg;if(opts.payReconnectShowmax||opts.showmaxChangePackagePayment||opts.showmaxPayment){self.showmaxIconVisible=true;}
self.InitializePaymentSlider();}
else if(d.status=='recurringsuccess'){self.paymentStatus.class="cancalrecurringsuccess";self.paymentStatus.fullviewclass='responseWrapper';self.paymentStatus.heading="Cancel Recurring";if(opts.payReconnectShowmax||opts.showmaxChangePackagePayment||opts.showmaxPayment){self.showmaxIconVisible=true;}
self.InitializePaymentSlider();}
else{self.paymentStatus.class="failed";self.paymentStatus.fullviewclass='responseWrapper';self.paymentStatus.heading=langTranslateApp.paymentsFailedStatusMsg;self.showmaxPaymentError=true;if(d.status=='failure'){self.newWin.close();if(!opts.payReconnectShowmax&&!opts.showmaxChangePackagePayment&&!opts.showmaxPayment&&!opts.paySmartcardReconnectShowmax)
site.factory.CaptureFeedback('DSTVPAYNOW_'+app.customernumber);}
if(opts.payReconnectShowmax||opts.showmaxChangePackagePayment||opts.showmaxPayment){self.showmaxIconVisible=true;}
if(opts.boxOfficePayment){window.dataLayer=window.dataLayer||[];window.dataLayer.push({event:'paymentFailure',ecommerce:{failure:{actionField:{paymentMethod:d.vendorName,payatTranId:d.transactionId,digiapiExternalRe:'',digiapiResponseMsg:d.message,payatReferenceNum:d.transactionId,},products:[{id:boSelectedMovieId,name:boProductName.toString().replace(/ /g,""),price:amountToProcess.toString(),brand:'DStv',category:'DP Box-office rentals',variant:'',quantity:1,}]}}});}else{window.dataLayer=window.dataLayer||[];window.dataLayer.push({event:'paymentFailure',ecommerce:{failure:{actionField:{paymentMethod:d.vendorName,payatTranId:d.transactionId,digiapiExternalRe:'',digiapiResponseMsg:d.message,payatReferenceNum:d.transactionId,},products:[{id:app.selectedCurrentPackageDetails?app.selectedCurrentPackageDetails.PackageCode:app.selectedCurrentAddOnDetails.AddOnCode,name:app.selectedCurrentPackageDetails?app.selectedCurrentPackageDetails.PackageName.toString().replace(/ /g,""):app.selectedCurrentAddOnDetails.AddOnName.toString().replace(/ /g,""),price:d.amountDue.toString(),brand:'DStv',category:app.selectedCurrentPackageDetails?'DP Change Package':'DP Add-on',variant:'',quantity:1,}]}}});}
self.InitializePaymentSlider();}
self.update();if(!self.newWin.closed&&(d.status=='pending'||d.status=='undefined'||d.status=='in_progress'))
setTimeout(function(){console.log('Payment Status : Retrying started...');self.getPaymentStatus(d.transactionId);},4000)}
self.onGetPaymentStatusError=function(error){console.log('Payment Status : Error while fetching payment status');console.log(error);self.fetchingPaymentStatus=false;self.update();}
self.GetAmountToPay=function(){console.log('Fetch Amount to Pay : fetch amount to pay...')
if(dstvApp.EnableSecurityAuth){let url=`${dstvApp.SecurityAuthBaseUrl}atp/api/v1/AmountToPay?country=${dstvApp.country}&customerNumber=${app.customernumber}&BusinessUnit=${dstvApp.businessunit}&Channel=${dstvApp.channel}`;site.factory.Get(url,null,self.onGetAmountToPaySuccess,self.onGetAmountToPayError,false,true,true);}else{let url=`${dstvApp.DSOAPIUrl}atp/api/v1/AmountToPay?country=${dstvApp.country}&customerNumber=${app.customernumber}&BusinessUnit=${dstvApp.businessunit}&Channel=${dstvApp.channel}`;site.factory.Get(url,self.token,self.onGetAmountToPaySuccess,self.onGetAmountToPayError)}}
self.onGetAmountToPaySuccess=function(data){console.log('Fetch Amount to Pay : fetch amount to pay completed')
app.paymentduedetails.properties.dueDate={value:data.DueDate.split('T')[0]};app.paymentduedetails.properties.amountToPay={value:Math.round(data.TotalAmountToPay.Value*100)/100}
app.paymentduedetails.properties.currencyCode={value:data.TotalAmountToPay.CurrencyCode}
app.BOAccount=data.Accounts.filter(x=>x.AccountType=="Box Office")[0];app.IsBOCustomer=app.BOAccount&&Object.keys(app.BOAccount).length>0
app.accounts=data.Accounts.map(x=>({AccountNumber:x.AccountNumber,AccountType:x.AccountType}))
app.accountsInfo=data.Accounts;app.primaryaccountnumber=data.Accounts.filter(x=>x.IsDefault)[0].AccountNumber;window.SessionSave("app",app);self.update();}
self.onGetAmountToPayError=function(err){console.log('Fetch Amount to Pay : error while fetching amount to pay')}
self.loadChangePackage=function(){if(app.noServicesLoaded){riot.mount('tag-model-for-showmax-upgrade',{showmodel:true})}else{$('#paymentModal').modal('hide');$('#changepackageModal').modal('show');$('.changePackModel').show();let packageName=app.smartcards.filter(x=>x.SerialNumber==app.smartcard)[0].primaryService?app.smartcards.filter(x=>x.SerialNumber==app.smartcard)[0].primaryService.serviceName:null;riot.mount('tag-change-package-new',{showmodal:true,smartcard:app.smartcard,packageName:packageName});}}
self.closePaymentDialog=function(){if(app.isVIVR){window.close();return;}
$('#errorMessage').hide();$('#paymentPage').hide();$('#paymentModal').modal('hide');app.forceReload=true;window.HandleActiveTab("showAccount");}
self.onRetry=function(){if(self.showmaxPaymentError){self.newWin.close();self.newWin='';self.processPayment();}
else
self.showPaymentSuite();}
self.showPaymentSuite=function(){$("#paymentsoverlay").fadeOut(300);$('#paymentPage').show();self.paymentStatus.show=false;self.update();}
self.isPaymentSuiteOpen=function(){return $('#payment-main-section').is(':visible');}
self.onAddShowmax=function(){$('#paymentModal').modal('hide');if(opts.showmaxPayment){window.HandleActiveTab("showMore");riot.mount('tag-showmax-atb',{paySuccessCreateAccount:true,showComponent:true});}
else{window.HandleActiveTab("showMore");riot.mount('tag-showmax-atb',{paySuccessAddShowmax:true,showComponent:true});}}
self.onReconnectShowmax=function(){$('#paymentModal').modal('hide');window.HandleActiveTab("showMore");riot.mount('tag-showmax-atb',{paySuccessReconnectShowmax:true,showComponent:true});}
self.SelfServiceClick=function(e){let action=e.currentTarget.attributes["action"].value;switch(action){case 'ADDSHOWMAX':console.log(action);window.HandleActiveTab("showMore")
$('#more-tab-showmax-section').show();riot.mount('tag-showmax-card',{showComponent:true});break;case 'RENTMOVIES':console.log(action);window.HandleActiveTab("showMore")
riot.mount('tag-dash-boxoffice',{showComponent:true});break;default:console.log(action);break;}}
self.keyGen=function(keyLength){let i,key="",characters="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789";let charactersLength=characters.length;for(i=0;i<keyLength;i++){key+=characters.substr(Math.floor((Math.random()*charactersLength)+1),1);}
return key;}
self.onInitiateUssdPayment=function(){console.log('Buy Airtime: Initiating USSD Payment');$("#paymentsoverlay").fadeIn(300);let guid=self.keyGen(32);self.reqBody={"Country":dstvApp.country,"MSISDN":dstvApp.countryCode+app.customercontactdetails.MobileTel,"Vendor":"buyairtime","Amount":self.airtimeAmount,"AccountNumber":self.buyingAirtimeForMobNo,"SmartcardNumber":app.smartcard,"Package":"airtime","BusinessUnit":dstvApp.businessunit,"CustomerNumber":app.customernumber,"CustomerName":app.customername,"PaymentType":"USSDPayment","ReferenceID":guid,"TransactionID":guid,"Vouchercode":" ","MNO":"63902","Channel":dstvApp.channel,"BankName":null,"BankId":null,"pin":null,"VendorPaymentReferenceId":null,"FromTelecom":null,"ToTelecom":null,"IsHardwareRequest":false,"IsAirtimeRequest":true,"IsCustomerLoggedIn":true,"HardwareRequestId":null}
window.dataLayer=window.dataLayer||[];window.dataLayer.push({event:'eec.addToCart',ecommerce:{add:{products:[{id:guid,name:'',price:self.airtimeAmount,brand:'DStv',category:'DP Airtime',variant:'',quantity:1}]}}});self.url=dstvApp.DSOAPIUrl+`/ussdpaymentapi/api/Payment/Payment`;if(dstvApp.EnableSecurityAuth){self.url=dstvApp.SecurityAuthBaseUrl+`/ussdpaymentapi/api/Payment/Payment`;site.factory.Post(self.url,self.reqBody,null,self.onUssdPaySuccess,self.onUssdPayError,false,false,true,true);}else{self.url=dstvApp.DSOAPIUrl+`/ussdpaymentapi/api/Payment/Payment`;site.factory.Post(self.url,self.reqBody,self.token,self.onUssdPaySuccess,self.onUssdPayError);}}
self.onUssdPaySuccess=function(data){console.log('Buy Airtime: On USSD Payment success');$("#paymentsoverlay").fadeOut(300);$('html, body').animate({scrollTop:20},1000);self.showAirtimeSummary=false;if(data){self.id=data.id;self.transactionId=data.transactionId;self.statusCode=data.status;self.responseMessage=data.responseMessage;}
if(self.statusCode&&self.statusCode==200){self.paymentInitSuccess=true;self.update();}
self.update();window.HandleActiveTab('showAccount')}
self.onUssdPayError=function(err){console.log('Buy Airtime: On USSD Payment error');$("#paymentsoverlay").fadeOut(300);}
self.monitorUssdPayStatus=function(){console.log('USSD Payment Status : Fetching payment status...');self.reqBody={"transactionID":self.transactionId,"country":dstvApp.country,"channel":dstvApp.channel,"businessUnit":dstvApp.businessunit,"id":self.id}
self.checkingStatus=true;self.fetchingUssdPaymentStatus=true;self.update();self.url=dstvApp.DSOAPIUrl+`/ussdpaymentapi/api/Payment/CheckPaymentStatus`;if(dstvApp.EnableSecurityAuth){self.url=dstvApp.SecurityAuthBaseUrl+`/ussdpaymentapi/api/Payment/CheckPaymentStatus`;site.factory.Post(self.url,self.reqBody,null,self.ussdPayStatusSuccess,self.ussdPayStatusError,false,false,false,true);}else{self.url=dstvApp.DSOAPIUrl+`/ussdpaymentapi/api/Payment/CheckPaymentStatus`;site.factory.Post(self.url,self.reqBody,self.token,self.ussdPayStatusSuccess,self.ussdPayStatusError);}}
self.ussdPayStatusSuccess=function(data){console.log('USSD Payment Status : '+data.status);console.log('USSD Payment Status : Fetching completed');$('html, body').animate({scrollTop:20},1000);self.fetchingUssdPaymentStatus=false;self.checkingStatus=false;self.ussdPaymentStatus.status=data.status;self.ussdPaymentStatus.transactionId=data.transactionId;self.ussdPaymentStatus.id=data.id;self.ussdPaymentStatus.message=data.responseMessage.toLowerCase();if(self.ussdPaymentStatus.message=='success'){self.ussdPaymentStatus.class="success";self.ussdPaymentStatus.fullviewclass='responseWrapper';self.ussdPaymentStatus.heading='success';window.dataLayer=window.dataLayer||[];window.dataLayer.push({currencyCode:dstvApp.countrycurrency,event:'eec.purchase',paymentPlatform:'Pay At',paymentMethod:'USSD',ecommerce:{purchase:{actionField:{id:data.transactionId,affiliation:'',revenue:'',tax:'',shipping:'',coupon:'',},products:[{id:'',name:'',price:self.airtimeAmount,brand:'DStv',category:'DP Airtime',variant:'',quantity:1}]}}});}else if(self.ussdPaymentStatus.message=='pending'){self.ussdPaymentStatus.class="pending";self.ussdPaymentStatus.fullviewclass='responseWrapper';self.ussdPaymentStatus.heading='processing';}else if(self.ussdPaymentStatus.message=='failure'){self.ussdPaymentStatus.class="failed";self.ussdPaymentStatus.fullviewclass='responseWrapper';self.ussdPaymentStatus.heading='unsuccessful';window.dataLayer=window.dataLayer||[];window.dataLayer.push({event:'paymentFailure',ecommerce:{failure:{actionField:{paymentMethod:'USSD',payatTranId:data.transactionId,digiapiExternalRe:'',digiapiResponseMsg:data.responseMessage,payatReferenceNum:data.transactionId,},products:[{id:'',name:'',price:self.selectedAmount,brand:'DStv',category:'DP Airtime',variant:'',quantity:1,}]}}});}
self.update();if(self.refreshRequested)
return;if(self.ussdPaymentStatus.message=='pending'&&app.ssActiveTab=='showPayment'){setTimeout(function(){console.log('Payment Status : Retrying started...');self.monitorUssdPayStatus();},20000)}}
self.ussdPayStatusError=function(err){console.log('USSD Payment Status : Error while fetching payment status');console.log(err);self.checkingStatus=false;}
self.disableRefreshButton=function(){console.log('Buy Airtime: Refresh button disabled');$("#btnRefreshUssd").attr('disabled','disabled');$("#btnRefreshUssd").addClass('disable-refresh');}
self.enableRefreshButton=function(){console.log('Buy Airtime: Refresh button enabled');$("#btnRefreshUssd").removeClass('btn-hidden disable-refresh');$("#btnRefreshUssd").removeAttr('disabled');}
self.onRefreshUssdStatus=function(){console.log('Buy Airtime: Get Ussd Payment status on Refresh click started..');self.refreshRequested=true;self.disableRefreshButton();setTimeout(function(){self.enableRefreshButton();},20000)
self.monitorUssdPayStatus();}
self.onBack=function(){window.HandleActiveTab("showMore");riot.mount('tag-buy-airtime',{showComponent:true,showNotice:false});}
self.getFormattedDate=function(dateString){return site.factory.GetEazyDateFormat(dateString.split(' ')[0].split('-').reverse().join('-'))}
self.getNewPackageName=function(dateString){self.showpackageName=dstvApp.packages.filter((e,i)=>{return dateString.includes(e.properties.Name)})
let countryArray=dstvApp.newPackageNamesApplicable.find(p=>p[dstvApp.countryabbreviation])
if(countryArray){self.selectedPackageCode=self.showpackageName[0].properties.Code
var wordsToRemove=['Compact','Compact Pluse','Family','Access'];let expStr=wordsToRemove.join("|");if(Object.keys(countryArray[dstvApp.countryabbreviation]).includes(self.selectedPackageCode)){return dateString.replace(new RegExp('\\b('+expStr+')\\b','gi'),'  ').replace(/\s{2,}/," "+dstvApp.newPackageNamesApplicable[0].rw[self.selectedPackageCode].split(' ')[0]+" ");}
return dateString}else{return dateString}}})