riot.tag2('tag-transaction-history','<div if="{showTransactionHistory && !showMore}" id="transactionHistorySection" class="transaction-history-wrapper content-wrapper clearfix"> <div class="transaction-history-inner"> <h2 class="text-center">{langTranslateApp.payPaymentHistory}</h2> <div class="transaction-history-top row"> <div class="transaction-history-top-left col-xs-6"> <div>{langTranslateApp.transHistoryShowing}</div> <h3>180 <span class="light-blue-txt">{langTranslateApp.transHistoryDays}</span></h3> </div> <div class="transaction-history-top-right col-xs-6"> {langTranslateApp.transHistoryCustomerMSG} </div> </div> <div class="row pay-history-details"> <div if="{app.accounts != undefined}"> <div class="form-group"> <fieldset> <select type="text" class="form-control" onchange="{changeacc}" id="change-account" name="change-account"> <option if="{app.accounts != undefined}" each="{account, index in app.accounts}" id="account-{account.AccountNumber}" value="{account.AccountNumber}" class="custom-class">{account.AccountType+" - "+account.AccountNumber}</option> </select> </fieldset> </div> </div> <!--<div class="Pay-history-transaction"> <div class="col-lg-4 col-md-4 col-sm-4 col-xs-4"><input type="radio" name="optradio" onclick="{changetransactioncount}" value="10" checked>10 {langTranslateApp.payTrans}</div> <div class="col-lg-4 col-md-4 col-sm-4 col-xs-4"><input type="radio" name="optradio" onclick="{changetransactioncount}" value="20">20 {langTranslateApp.payTrans}</div> <div class="col-lg-4 col-md-4 col-sm-4 col-xs-4"><input type="radio" name="optradio" onclick="{changetransactioncount}" value="30">30 {langTranslateApp.payTrans}</div> </div>--> <div class="col-sm-3 col-md-2"> <div if="{false}"> <div data-is="tag-select" type="select" selectoptions="{pagesize.pages}" onchangeevent="{changeacc}" cls="custom-class" label="Page Size" defaultoption="Select" value="{numberperpage}" val="{numberperpage}" name="pagesize"></div> </div> </div> </div> <div if="{tagstate == \'loaded\'}" class="transaction-table table-responsive"> <table if="{formproperties !=undefined && formproperties.length > 0}" id="tblTransactionHistory" class="table table-borderless"> <thead> <tr> <th>{langTranslateApp.payDate}</th> <th>{langTranslateApp.payDescription}</th> <th>{langTranslateApp.payTransactionNum}</th> <th>{langTranslateApp.payAmount}</th> </tr> </thead> <tbody> <tr each="{lineitem in formproperties}" class="line-item"> <td>{site.factory.GetEazyDateFormat(lineitem.creationDate)}</td> <td>{(lineitem.transactionType)}</td> <td>{(lineitem.transactionNumber)}</td> <td align="right" if="{!app.dualCurrencyApplicable}">{dstvApp.countrycurrency.toUpperCase()} {Math.abs(lineitem.amount)}</td> <td align="right" if="{app.dualCurrencyApplicable}">{lineitem.localPrice.currency.toUpperCase()} {Math.abs(lineitem.localPrice.amount)}</td> </tr> </tbody> </table> <table id="tblNoRecords" class="table" if="{formproperties !=undefined && formproperties.length == 0}"> <thead> <tr class="record1"> <th width="20%">{langTranslateApp.payDate}</th> <th>{langTranslateApp.payDescription}</th> <th>{langTranslateApp.payTransactionNum}</th> <th align="right" width="20%" class="text-right">{langTranslateApp.payAmount}</th> </tr> </thead> <tr> <td if="{selectedaccountnumber.length == 0}" colspan="4">{langTranslateApp.payNotTransact}</td> <td if="{selectedaccountnumber.length != 0}" colspan="4">{langTranslateApp.notransactions}</td> </tr> </table> </div> <div class="relative blue-loading" if="{tagstate == \'loading\'}" style="min-height: 400px;"> <div class="loading-loader loading"> <div class="col-sm-12 text-center"> <div class="spinner"></div> <div class="loading-message" style="color: #00aeee!important;">{langTranslateApp.LoadingTransactionHistory}</div> </div> </div> </div> <div class="details_btn" style="top: 0px;" if="{tagstate == \'loaded\'}"><button type="button" class="save_details_btn" onclick="{back}">{langTranslateApp.loginBack}</button></div> </div></div>','tag-transaction-history,[riot-tag="tag-transaction-history"],[data-is="tag-transaction-history"]{ visibility: visible; } tag-transaction-history select,[riot-tag="tag-transaction-history"] select,[data-is="tag-transaction-history"] select{ display: none !important; }','',function(opts){var self=this;self.model={};self.numberperpage=10;self.transactioncount=180;self.selectedaccountnumber=app.primaryaccountnumber;self.PropertyConfig={};self.tagstate="loaded";self.formproperties={};self.url=dstvApp.DSOAPIUrl+`/apipaymenthistory/api/v1/PaymentHistory?Country=${dstvApp.country}&BusinessUnit=${dstvApp.businessunit}&Channel=dstvafrica&CustomerNumber=${app.customernumber}&AccountNumber=${app.primaryaccountnumber}`;self.on('before-mount',function(){});self.on('mount',function(){if(opts.showComponent){self.showTransactionHistory=true;$('tag-more-service').hide();setTimeout(function(){$('#change-account').val(app.primaryaccountnumber);jcf.refreshAll();},500)
self.search();jcf.replaceAll();}
else{self.showTransactionHistory=false;}});self.changeacc=function(e){var trackObj={};if(e.target.name=="change-account"){if(self.selectedaccountnumber===e.target.value)
return;self.selectedaccountnumber=e.target.value;trackObj.SelectedAccountNumber=self.selectedaccountnumber;}
else if(e.target.name=="page"){self.selectedpage=parseInt(e.target.value);}
else if(e.target.name=="pagesize"){self.numberperpage=parseInt(e.target.value);trackObj.pagesize=self.numberperpage;}
self.search();}
self.changetransactioncount=function(e){self.transactioncount=e.target.value;self.search();}
self.getTransactionHistory=function(){if(app.customernumber){self.tagstate="loading";if(dstvApp.EnableSecurityAuth){let url=dstvApp.SecurityAuthBaseUrl+`/apipaymenthistory/api/v1/PaymentHistory?Country=${dstvApp.country}&BusinessUnit=${dstvApp.businessunit}&Channel=dstvafrica&CustomerNumber=${app.customernumber}&AccountNumber=${app.primaryaccountnumber}`;site.factory.Get(url,null,self.successInitialPostCallback,self.errorPostCallback,false,true,true);}else{site.factory.GetJWT().then(function(token){self.token=token;let url=dstvApp.DSOAPIUrl+`/apipaymenthistory/api/v1/PaymentHistory?Country=${dstvApp.country}&BusinessUnit=${dstvApp.businessunit}&Channel=dstvafrica&CustomerNumber=${app.customernumber}&AccountNumber=${app.primaryaccountnumber}`;site.factory.Get(url,self.token,self.successInitialPostCallback,self.errorPostCallback);});}}
self.update();}
self.successInitialPostCallback=function(data){if(data){self.tagstate="loaded";self.formproperties=data;self.account=app.primaryaccountnumber;self.update();jcf.replaceAll();console.log(data);}}
self.successPostCallback=function(data){if(data){self.tagstate="loaded";self.formproperties=data;self.account=app.primaryaccountnumber;self.update();}}
self.errorPostCallback=function(data){if(data){self.tagstate="loaded";self.formproperties=[];console.log(data);}
self.update();console.log("error Post Callback");}
self.search=function(){self.tagstate="loading";let customerNumber='';if(self.selectedaccountnumber!=''&&self.selectedaccountnumber!=undefined){customerNumber=app.customernumber;}
if(dstvApp.EnableSecurityAuth){let url=dstvApp.SecurityAuthBaseUrl+`/apipaymenthistory/api/v1/PaymentHistory?Country=${dstvApp.country}&BusinessUnit=${dstvApp.businessunit}&CustomerNumber=${customerNumber}&Channel=dstvafrica&AccountNumber=${self.selectedaccountnumber}&PageSize=${self.transactioncount}`;site.factory.Get(url,null,self.successPostCallback,self.errorPostCallback,false,true,true);}else{site.factory.GetJWT().then(function(token){self.token=token;let url=dstvApp.DSOAPIUrl+`/apipaymenthistory/api/v1/PaymentHistory?Country=${dstvApp.country}&BusinessUnit=${dstvApp.businessunit}&CustomerNumber=${customerNumber}&Channel=dstvafrica&AccountNumber=${self.selectedaccountnumber}&PageSize=${self.transactioncount}`;site.factory.Get(url,self.token,self.successPostCallback,self.errorPostCallback);});}
self.update();}
self.back=function(){self.showTransactionHistory=false;window.HandleActiveTab('showMore')
$('tag-more-service').show();}})